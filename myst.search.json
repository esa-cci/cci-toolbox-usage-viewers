{"version":"1","records":[{"hierarchy":{"lvl1":"cci-toolbox-usage-viewers"},"type":"lvl1","url":"/","position":0},{"hierarchy":{"lvl1":"cci-toolbox-usage-viewers"},"content":"https://​esa​-cci​.github​.io​/cci​-toolbox​-usage​-viewers/","type":"content","url":"/","position":1},{"hierarchy":{"lvl1":"Changes in 1.5.2 (in development)"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes","position":0},{"hierarchy":{"lvl1":"Changes in 1.5.2 (in development)"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes","position":1},{"hierarchy":{"lvl1":"Changes in 1.5.2 (in development)"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5-2-in-development","position":2},{"hierarchy":{"lvl1":"Changes in 1.5.2 (in development)"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5-2-in-development","position":3},{"hierarchy":{"lvl1":"Changes in 1.5.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5-1","position":4},{"hierarchy":{"lvl1":"Changes in 1.5.1"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5-1","position":5},{"hierarchy":{"lvl1":"Changes in 1.5.1","lvl2":"Operations"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations","position":6},{"hierarchy":{"lvl1":"Changes in 1.5.1","lvl2":"Operations"},"content":"Updated operations reduce, statistics, anomaly_internal, and tseries_mean\nto version 1.1 each by adding a parameter apply_spatial_weighting. This parameter\ncauses that when computing the mean (or, depending on the operation another statistical\nmeasure) it is considered that cells cover less area the further away they are from the\nequator. See issue #38.\n\nFixed newly added operations normalise_vars and standardise_vars","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations","position":7},{"hierarchy":{"lvl1":"Changes in 1.5"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5","position":8},{"hierarchy":{"lvl1":"Changes in 1.5"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-5","position":9},{"hierarchy":{"lvl1":"Changes in 1.5","lvl2":"Operations"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations-1","position":10},{"hierarchy":{"lvl1":"Changes in 1.5","lvl2":"Operations"},"content":"Added operation normalise_vars to normalise variables of a dataset\n\nAdded operation standardise_vars to standardise variables of a dataset\n\nAdded operation pairwise_var_correlation to compute correlation between\nsingle variables of two datasets\n\nAdded operation pixelwise_group_correlation to compute correlation between\nvariable_ensembles from two datasets\n\nAll new operations are documented in the documentation’s API reference.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations-1","position":11},{"hierarchy":{"lvl1":"Changes in 1.5","lvl2":"Data Access"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#data-access","position":12},{"hierarchy":{"lvl1":"Changes in 1.5","lvl2":"Data Access"},"content":"Added support for reading from and writing to KML","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#data-access","position":13},{"hierarchy":{"lvl1":"Changes in 1.4"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-4","position":14},{"hierarchy":{"lvl1":"Changes in 1.4"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-4","position":15},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Operations"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations-2","position":16},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Operations"},"content":"Added function execute_operations which allows to run one or more\ninput datasets on one or more operations, effectively allowing to\nset up an operation chain.\n\nAdded operation for gapfilling\n\nAdded operation for performing fourier analysis on time series\n\nProvided example for reprojection as notebook\n\nProvided example for filtering as notebook","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#operations-2","position":17},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Data Access"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#data-access-1","position":18},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Data Access"},"content":"Provided guideline for accessing OGC Web Services as notebooks\n\nProvided guideline for accessing CMIP and Obs4MIPs data from ESGF\n\nSupport reading and writing vectordatacubes","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#data-access-1","position":19},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Enhancements"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#enhancements","position":20},{"hierarchy":{"lvl1":"Changes in 1.4","lvl2":"Enhancements"},"content":"Allow searching for operations with specific tags\n\nAllow writing xarray dataarrays as png or geotiff images\n\nAllow writing xarray datarrays as sequence of images\n\nAllow writing xarray datasets as single geotiff image\n\nAdded reporting module to allow reporting errors (including demo notebook)","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#enhancements","position":21},{"hierarchy":{"lvl1":"Changes in 1.3.2"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3-2","position":22},{"hierarchy":{"lvl1":"Changes in 1.3.2"},"content":"Maintenance release to handle changes from external package","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3-2","position":23},{"hierarchy":{"lvl1":"Changes in 1.3.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3-1","position":24},{"hierarchy":{"lvl1":"Changes in 1.3.1"},"content":"Added new operation statistics to compute statistics for a dataset","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3-1","position":25},{"hierarchy":{"lvl1":"Changes in 1.3"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3","position":26},{"hierarchy":{"lvl1":"Changes in 1.3"},"content":"Made Python 3.10 the minimal supported version\n\nImproved error handling of coregistration op\n\nAdded function to list ecv datasets of titles\n\nRevised list of operations\n\nFixed bug where list_ecv_datasets would return false positives\n\nUpdated installation guide in documentation","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-3","position":27},{"hierarchy":{"lvl1":"Changes in 1.2"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-2","position":28},{"hierarchy":{"lvl1":"Changes in 1.2"},"content":"Added dockerfile to run the ESA CCI Toolbox in a GitHub Codespace,\nallowing users to use the toolbox and in particular Jupyter Notebooks\non GitHub. A dedicated readme file with instructions is in the .devcontainer\nsub-folder.\n\nIntroduced user_examples section in notebooks folder, where example\nnotebooks from users can be collected.\n\nChanged toolbox to use external xcube-cci package for access to the ODP and\nremoved redundant modules in the toolbox. This change has no functional effect\non the toolbox, as together with the xcube-cci package it can be used as\nbefore.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-2","position":29},{"hierarchy":{"lvl1":"Changes in 1.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-1","position":30},{"hierarchy":{"lvl1":"Changes in 1.1"},"content":"Support numpy >= 2.0 and pydap >= 3.4\n\nAutomatically publish packages on pypi at release\n\nImproved support of vector data cubes\n\nSupport HR LC data\n\nAdded user functions for regions:\n\nget_land_mask:  Gets a land mask for a dataset.\n\nget_regions_mask: Gets a regions mask for a dataset.\n\nmake_regions_dataset: Rasterize country and continent polygons into a\ngrid provided by a template dataset.\n\nmask_dataset_by_land: Masks out non-land-pixels of a dataset.\n\nmask_dataset_by_regions: Masks out pixels of a dataset which are not in\none of the specified regions.\n\nAdded notebooks:\n\nESA CCI Toolbox Vector Data Cube Access: Explaining the handling of\nvector data cubes\n\nUsing the ESA CCI Toolbox with the xcube Viewer: Explaining how to access\nthe xcube viewer from within a Jupyter Notebook\n\nExtended documentation by a section on how to configure an xcube server to\nserve data from the ESA CCI Toolbox","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-1","position":31},{"hierarchy":{"lvl1":"Changes in 1.0.2"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0-2","position":32},{"hierarchy":{"lvl1":"Changes in 1.0.2"},"content":"Updated list of dataset states\n\nImproved dependencies\n\nAdapted coregistration to work with latest version of xarray","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0-2","position":33},{"hierarchy":{"lvl1":"Changes in 1.0.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0-1","position":34},{"hierarchy":{"lvl1":"Changes in 1.0.1"},"content":"Pinned numpy to <2.0, as numpy 2.0 causes errors","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0-1","position":35},{"hierarchy":{"lvl1":"Changes in 1.0"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0","position":36},{"hierarchy":{"lvl1":"Changes in 1.0"},"content":"Added operations:\n\nadd_dataset_values_to_geodataframe:\nAdds values from a dataset to a geodataframe\n\nas_geodataframe: Ensures a dataframe is a geodataframe\n\nto_dataframe: Converts a dataset to a dataframe\n\nto_dataset: Converts a dataframe to a dataset\n\nanimate_map: Creates a geographic map animation\n\nplot: Create a 1D/line or 2D/image plot\n\nplot_contour: Create a contour plot\n\nplot_hist: Creates a histogram of a variable\n\nplot_line: Creates a 1D/line plot\n\nplot_map: Creates a geographic map plot\n\nplot_scatter: Creates a scatter plot of two variables\n\nThe ESA CCI Toolbox now also affords opening the following datasets:\n\nAs xarray datasets:\n\nesacci.ICESHEETS.unspecified.L4.SEC.multi-sensor.multi-platform.UNSPECIFIED.0-1.greenland_sec_saral_altika\n\nesacci.ICESHEETS.yr.Unspecified.SEC.SIRAL.CryoSat-2.UNSPECIFIED.2-2.greenland_sec_cryosat_2yr\n\nesacci.ICESHEETS.yr.Unspecified.SEC.SIRAL.CryoSat-2.UNSPECIFIED.2-2.greenland_sec_cryosat_5yr\n\nesacci.SEALEVEL.mon.IND.MSL.multi-sensor.multi-platform.MERGED.2-0.r1\n\nesacci.SEALEVEL.mon.L4.MSLA.multi-sensor.multi-platform.MERGED.2-0.r1\n\nAs geodataframes:\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.AATSR.Envisat.AATSR-ENVISAT-ENS.v2-6.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.AATSR.Envisat.ADV.2-31.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.AATSR.Envisat.ORAC.04-01.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.AATSR.Envisat.SU.4-3.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.ATSR-2.ERS-2.ADV.2-31.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.ATSR-2.ERS-2.ORAC.04-01.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.ATSR-2.ERS-2.SU.4-3.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AER_PRODUCTS.multi-sensor.multi-platform.ATSR2-ENVISAT-ENS.v2-6.r1\n\nesacci.AEROSOL.satellite-orbit-frequency.L2P.AOD.MERIS.Envisat.MERIS_ENVISAT.2-2.r1\n\nesacci.ICESHEETS.unspecified.Unspecified.CFL.multi-sensor.multi-platform.UNSPECIFIED.v3-0.greenland\n\nesacci.ICESHEETS.unspecified.Unspecified.GLL.multi-sensor.multi-platform.UNSPECIFIED.v1-3.greenland\n\nAs vector data cubes:\n\nesacci.ICESHEETS.yr.Unspecified.GMB.GRACE-instrument.GRACE.UNSPECIFIED.1-2.greenland_gmb_mass_trends\n\nesacci.ICESHEETS.yr.Unspecified.GMB.GRACE-instrument.GRACE.UNSPECIFIED.1-3.greenland_gmb_mass_trends\n\nesacci.ICESHEETS.yr.Unspecified.GMB.GRACE-instrument.GRACE.UNSPECIFIED.1-4.greenland_gmb_mass_trends\n\nesacci.ICESHEETS.yr.Unspecified.GMB.GRACE-instrument.GRACE.UNSPECIFIED.1-5.greenland_gmb_mass_trends\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-0.r1\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.ASA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.BENGUELA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.CARIBBEAN\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.GULFSTREAM\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.HUMBOLDT\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.MED_SEA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.NE_ATL\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.N_INDIAN\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.SE_AFRICA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.SE_ASIA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.S_AUSTRALIA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.WAFRICA\n\nesacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.r1\n\nIn addition, the FIRE pixel datasets can be read. However, as they are\nsubdivided by regions, they do not appear in the toolbox as single datasets,\nbut as one dataset per region:\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_1\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_2\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_3\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_4\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_5\n\nesacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel~AREA_6\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_1\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_2\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_3\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_4\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_5\n\nesacci.FIRE.mon.L3S.BA.multi-sensor.multi-platform.SYN.v1-1.pixel~AREA_6\nAs for the Sentinel-2 FIRE pixel dataset\nesacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.v1-1.pixel, it is\nsplit into one dataset per region, e.g.,esacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.v1-1.pixel~h45v23\nAs for esacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.2-0.pixel,\nit is additionally split per variable:\n\nesacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.2-0.pixel~h32v14-fv2.0-CL\n\nesacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.2-0.pixel~h32v14-fv2.0-JD\n\nesacci.FIRE.mon.L3S.BA.MSI-(Sentinel-2).Sentinel-2A.MSI.2-0.pixel~h32v14-fv2.0-LC","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-1-0","position":37},{"hierarchy":{"lvl1":"Changes in 0.4.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-4-1","position":38},{"hierarchy":{"lvl1":"Changes in 0.4.1"},"content":"Updated list of dataset states\n\nFixed internal build process","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-4-1","position":39},{"hierarchy":{"lvl1":"Changes in 0.4"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-4","position":40},{"hierarchy":{"lvl1":"Changes in 0.4"},"content":"Added store aliases esa-cci and esa-cci-zarr and renamed default stores to have\nthe same names.\n\nEnsure default stores will always be included in store registry.\n\nUpdated documentation\n\nAdded opener \"datafame:geojson:esa-cdc\" to esa-cci data store.\nThe following datasets can now be opened:\n\nesacci.GHG.satellite-orbit-frequency.L2.CH4.SCIAMACHY.Envisat.IMAP.v7-2.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CH4.TANSO-FTS.GOSAT.EMMA.ch4_v1-2.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CH4.TANSO-FTS.GOSAT.OCFP.v2-1.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CH4.TANSO-FTS.GOSAT.OCPR.v7-0.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CH4.TANSO-FTS.GOSAT.SRFP.v2-3-8.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CO2.SCIAMACHY.Envisat.BESD.v02-01-02.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CO2.SCIAMACHY.Envisat.WFMD.v4-0.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CO2.TANSO-FTS.GOSAT.EMMA.v2-2c.r1\n\nesacci.GHG.satellite-orbit-frequency.L2.CO2.TANSO-FTS.GOSAT.SRFP.v2-3-8.r1\n\nesacci.SEAICE.satellite-orbit-frequency.L2P.SITHICK.RA-2.Envisat.NH.2-0.r1\n\nesacci.SEAICE.satellite-orbit-frequency.L2P.SITHICK.RA-2.Envisat.SH.2-0.r1\n\nesacci.SEAICE.satellite-orbit-frequency.L2P.SITHICK.SIRAL.CryoSat-2.NH.2-0.r1\n\nesacci.SEAICE.satellite-orbit-frequency.L2P.SITHICK.SIRAL.CryoSat-2.SH.2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.AltiKa.SARAL.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.GFO-RA.GFO.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.Poseidon-2.Jason-1.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.Poseidon-3.Jason-2.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.RA-2.Envisat.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.RA.ERS-1.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.RA.ERS-2.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.SIRAL.CryoSat-2.UNSPECIFIED.v2-0.r1\n\nesacci.SEALEVEL.satellite-orbit-frequency.L1.UNSPECIFIED.SSALT.Topex-Poseidon.UNSPECIFIED.v2-0.r1\nAlso added notebook that opens one of these datasets.\n\nAdded new data store esa-cci-kc\n(and corresponding xcube data store esa-cci-kc) that allows performant\naccessing of selected datasets of the ESA Climate Data Centre using a\nZarr view of the original NetCDF files. This approach is made possible by\nusing the \n\nkerchunk package. Also\nadded new Notebook that demonstrates usage of the new data store.\n\nAdded operations:\n\naggregate_statistics:\nAggregates data frame columns into statistical measures\n\nanomaly_external: Calculates anomaly with external reference data\n\nanomaly_internal: Calculates anomaly using a dataset’s mean\n\narithmetics: Applies arithmetic operations\n\nclimatology: Creates a ‘mean over years’ dataset\n\ndata_frame_max: Selects a data frame’s maximum record\n\ndata_frame_min: Selects a data frame’s minimum record\n\ndata_frame_subset: Creates a variable or spatial subset of a dataframe\n\ndiff: Calculates the difference of two datasets\n\nfind_closest: Find data frame records closest to a given location\n\nquery: Query records from a dataframe\n\nreduce: Reduces a dataset’s variables\n\ntemporal_aggregation: Aggregates a dataset","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-4","position":41},{"hierarchy":{"lvl1":"Changes in 0.3"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-3","position":42},{"hierarchy":{"lvl1":"Changes in 0.3"},"content":"Integrated operation framework\n\nAdded operations:\n\nadjust_spatial_attrs: Adjusts global spatial attributes\n\nadjust_temporal_attrs: Adjusts global temporal attributes\n\ncoregister: Coregisters two datasets\n\ndetect_outliers: Detect outliers in a dataset\n\nmerge: Merges up to four datasets into one\n\nnormalize: Normalises geo- and time-coding\n\nresample: Resamples a dataset to a new resolution\n\nsubset_spatial: Creates a spatial subset\n\nsubset_temporal: Creates a temporal subset\n\nsubset_temporal_index: Creates a temporal subset based on indices\n\ntseries_point: Extracts a time series for a point\n\ntseries_mean: Extracts a time series for a dataset’s mean\n\nAdded functionality to manage operations:\n\nget_op\n\nget_op_meta_info\n\nlist_operations\n\nAdded functionality to manage data:\n\nadd_local_store\n\nadd_store\n\nfind_data_store\n\nget_output_store_id\n\nget_store\n\nget_search_params\n\nget_supported_formats\n\nlist_datasets\n\nlist_ecvs\n\nlist_ecv_datasets\n\nlist_stores\n\nopen_data\n\nremove_store\n\nsearch\n\nset_output_store\n\nwrite_data\n\nIntegrated implementation of data stores into ESA Climate Toolbox\n\nExtended Documentation with descriptions of newly added API","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-3","position":43},{"hierarchy":{"lvl1":"Changes in 0.2.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-2-1","position":44},{"hierarchy":{"lvl1":"Changes in 0.2.1"},"content":"Minor packaging update","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-2-1","position":45},{"hierarchy":{"lvl1":"Changes in 0.2"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-2","position":46},{"hierarchy":{"lvl1":"Changes in 0.2"},"content":"Added documentation\n\nAdded example notebooks\n\nFixed registration of xcube plugins\n\nAdjusted names","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-2","position":47},{"hierarchy":{"lvl1":"Changes in 0.1"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-1","position":48},{"hierarchy":{"lvl1":"Changes in 0.1"},"content":"Added registrations of esa-cdc and  esa-climate-data-centre to access\ndata store with data from ESA Climate Data Centre","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/changes#changes-in-0-1","position":49},{"hierarchy":{"lvl1":"ESA CCI Toolbox"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox"},"content":"\n\n\n\n\n\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#esa-cci-toolbox","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox"},"content":"The ESA CCI Toolbox is designed to provide access to CCI data from the ESA\nOpen Data Portal.\nAlso, it contains functions to operate on this data.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#esa-cci-toolbox","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Installation into a new environment with conda"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-a-new-environment-with-conda","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Installation into a new environment with conda"},"content":"The ESA CCI Toolbox and all necessary dependencies are available\non \n\nconda-forge, and can be installed using the\n\n\nconda package manager.\nThe conda package manager itself can be obtained in the \n\nminiconda\ndistribution.\nOnce conda is installed, the ESA CCI Toolbox can be installed like this:$ conda create --name ect --channel conda-forge esa-climate-toolbox\n$ conda activate ect\n\nThe name of the environment may be freely chosen.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-a-new-environment-with-conda","position":5},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl3":"Installation into an existing environment with conda","lvl2":"Installation into a new environment with conda"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-an-existing-environment-with-conda","position":6},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl3":"Installation into an existing environment with conda","lvl2":"Installation into a new environment with conda"},"content":"The ESA CCI Toolbox can also be installed into an existing conda\nenvironment.\nTo do so, execute this command with the existing environment activated:$ conda install --channel conda-forge esa-climate-toolbox\n\nAny necessary dependencies will be installed or updated if they are not already\ninstalled in a compatible version.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-an-existing-environment-with-conda","position":7},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl3":"Installation into an existing environment from the repository","lvl2":"Installation into a new environment with conda"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-an-existing-environment-from-the-repository","position":8},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl3":"Installation into an existing environment from the repository","lvl2":"Installation into a new environment with conda"},"content":"If you want to install the ESA CCI Toolbox directly from the git repository\n(for example in order to use an unreleased version or to modify the code),\nyou can do so as follows:$ git clone https://github.com/esa-cci/esa-climate-toolbox.git\n$ cd esa-climate-toolbox\n$ conda env create\n$ conda activate ect\n$ pip install -e .","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#installation-into-an-existing-environment-from-the-repository","position":9},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Testing"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#testing","position":10},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Testing"},"content":"You can run the unit tests for the ESA CCI Toolbox by executing$ pytest\n\nin the esa-climate-toolbox repository.\n\nTo create a test coverage report, you can usecoverage run --include='esa-climate-toolbox/**' --module pytest\ncoverage html\n\nThis will write a coverage report to htmlcov/index.html.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#testing","position":11},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Use"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#use","position":12},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Use"},"content":"Jupyter notebooks demonstrating the use of the ESA CCI Toolbox can be found\nin the notebooks/ subdirectory of the repository.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#use","position":13},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Releasing"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#releasing","position":14},{"hierarchy":{"lvl1":"ESA CCI Toolbox","lvl2":"Releasing"},"content":"To release the esa-climate-toolbox, please follow the steps outlined in the\n\n\nxcube Developer Guide.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/readme#releasing","position":15},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#esa-cci-toolbox-finding-data","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"content":"This notebook shows the usage of some covenience functions that have been setup to further facilitate the handling of the stores and the use of the ESA CCI Toolbox. A thorough description can be found here: \n\nhttps://​esa​-climate​-toolbox​.readthedocs​.io​/en​/latest​/api​_reference​.html​#datasets​-and​-datastores. To see how you can actually open data using these stores, see notebooks 2-5.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe functions provided here serve the purpose to get an overview about data and from which data store to get it from. They also serve to look for Essential Climate Variables. We may start by listing all that are provided by the ESA CCI Toolbox.\n\nfrom esa_climate_toolbox.core import list_ecvs\n\nlist_ecvs()\n\n\n\nNow that we see what the toolbox can offer, we can find datasets for one ecv, e.g., WATERVAPOUR.\n\nfrom esa_climate_toolbox.core import list_ecv_datasets\n\nlist_ecv_datasets(\"LC\")\n\n\n\nThe result consists of a list of tuples, where the first value is a data id and the second value the name of the store that provides access to the data. For information on how to access the stores specifically, using the xcube store framework, see notebooks 2 to 5. Here, we continue with listing all the stores that are registered in the system.\n\nfrom esa_climate_toolbox.core import list_stores\n\nlist_stores()\n\n\n\nYou will see default stores (and maybe some you have added yourself). You can also ask for a store by asking for a specific dataset id.\n\nfrom esa_climate_toolbox.core import find_data_store\n\nfind_data_store(ds_id=\"esacci.WATERVAPOUR.mon.L3S.TCWV.multi-sensor.multi-platform.TCWV_land_05deg.3-2.r1\")\n\n\n\nThe result consists of the name of the store as well as the python object itself.\nWe could also get it by just asking for its name.\n\nfrom esa_climate_toolbox.core import get_store\n\nget_store(\"esa-cci\")\n\n\n\nWe can also ask for the data of a store:\n\nfrom esa_climate_toolbox.core import list_datasets\n\nlist_datasets(\"esa-cci-zarr\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#esa-cci-toolbox-finding-data","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Adding your own stores"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#adding-your-own-stores","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Adding your own stores"},"content":"You may also define your own stores. This can come in handy when you want to combine your own data with the data from the toolbox.\nYou may add store to locally hosted data like this:\n\nfrom esa_climate_toolbox.core import add_local_store\n\nadd_local_store(\n    root=\"/path/to/my/data/\",\n    store_id=\"my_real_local_store\",\n    includes=\"aero*.nc\",\n    read_only=True,    \n    persist=False\n)\n\n\n\nThe root specifies the path to the data that shall be served by the store. The store_id defines by which name the store is registered in the system. With includes you can specify a pattern to determine what data shall be served, read_only causes that the store does not permit write operations, and if you would set persist to true, the store will be saved and available in your next session.\nOf course, we can always also remove a store. Don’t worry, this only deletes the registry entry. No real data is deleted.\n\nfrom esa_climate_toolbox.core import remove_store\n\nremove_store(\"my_real_local_store\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#adding-your-own-stores","position":5},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Writing data to stores"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#writing-data-to-stores","position":6},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Writing data to stores"},"content":"When you have created a new dataset, you might want to save it somewhere. For that, you can use this command:\n\nfrom esa_climate_toolbox.core import write_data\n\n# write_data(data, store_id=\"my_real_local_store\")\n\n\n\nWe leave this open for now, as we don’t want to actually write data now. Note that to write data, you need to define a store and make sure it is not read_only (see above). If you know you want your output in the same place, you can set a default output store:\n\nfrom esa_climate_toolbox.core import set_output_store\n\nadd_local_store(\n    root=\"/path/to/my/data/\",\n    store_id=\"my_real_local_store\",\n    includes=\"aero*.nc\",\n    read_only=True,    \n    persist=False\n)\nset_output_store(\"my_real_local_store\")\n\n\n\nLet’s check this is really the output store:\n\nfrom esa_climate_toolbox.core import get_output_store_id\n\nget_output_store_id()\n\n\n\nGreat! You are set to use these functions for making use of the toolbox. See the other notebooks to find out how to open datasets and use operations. Also, see the API for more detailed information on the functions described here: \n\nhttps://​esa​-climate​-toolbox​.readthedocs​.io​/en​/latest​/api​_reference​.html​#datasets​-and​-datastores.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-finding-data#writing-data-to-stores","position":7},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf","position":0},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf","position":1},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#accessing-obs4mips-and-cmip-data-via-esgf","position":2},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"content":"This notebook demonstrates how to access CMIP6 and Obs4MIPs data using the \n\nintake-esgf package.\n\nTo run this notebook, you’ll need to install intake-esgf. You can install it using the following command:conda install -c conda-forge intake-esgf\n\nAlternatively, you can follow the \n\nofficial documentation for more installation details and usage instructions.\n\nimport intake_esgf\n\n\n\nThe catalog can be configured by following the instructions outlined in the \n\nintake-esgf configuration documentation. This allows you to set up indices that provide access to specific datasets.\n\nFor instance, the following example demonstrates how to access the Lawrence Livermore National Laboratory (LLNL) Solr index, which supports a wide range of ESGF datasets. By configuring the index in this way, you can easily query and retrieve the data you need from the ESGF network.\n\nRefer to the \n\nconfiguration guide for more details on setting up additional data sources or modifying the existing configuration to suit your needs.\n\nintake_esgf.conf.set(indices={\"esgf-node.llnl.gov\":True})\n\n\n\nThe following cell shows which projects are supported.\n\nintake_esgf.supported_projects()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#accessing-obs4mips-and-cmip-data-via-esgf","position":3},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access CMIP Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#access-cmip-data","position":4},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access CMIP Data"},"content":"In this section, we show how to access the ‘temperature at surface’ (tas) dataset from CMIP6 (Coupled Model Intercomparison Project). CMIP6 provides various climate model simulations, including tas data for different time periods and scenarios.\n\ncat = intake_esgf.ESGFCatalog()\n\n\n\nWe can query datasets using the search method, as demonstrated in the cell below.\n\ncat.search(\n    project=\"CMIP6\",\n    variable_id=\"tas\",\n    experiment_id=\"historical\",\n    source_id=\"CanESM5\",\n    member_id=\"r1i1p1f1\",\n    table_id=\"Amon\",\n)\n\n\n\n\n\nUsing the to_dataset_dict method, we can load the selected data into a dictionary, with each value containing an xarray.Dataset.\n\ndsd = cat.to_dataset_dict()\n\n\n\n\n\ndsd[\"tas\"]\n\n\n\nIn the following cell, we calculate the mean temperature over time, convert it to degrees Celsius, and plot the global surface temperature variable.\n\nds_plot = dsd[\"tas\"][\"tas\"].mean(dim=\"time\") - 273.15\nds_plot.plot(cmap=\"bwr\", vmin=-40, vmax=40)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#access-cmip-data","position":5},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access obs4MIPS"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#access-obs4mips","position":6},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access obs4MIPS"},"content":"In this section, we show how to access the ‘temperature at surface’ (tas) dataset from obs4MIPS (Observations for Model Intercomparison Projects). obs4MIPS is a project that provides observational datasets for comparison with climate model outputs.\n\nWe first use the search method to get the desired dataset.\n\ncat.search(\n    project=\"obs4MIPs\",\n    institution_id=\"ECMWF\",\n    variable_id=\"tas\",\n)\n\n\n\n\n\nWe load the search results into a dictionary and extract the xarray.Dataset containing the data in the subsequent cell.\n\ndsd = cat.to_dataset_dict()\n\n\n\ndsd[\"tas\"]\n\n\n\nIn the following cell, we calculate the mean temperature over time, convert it to degrees Celsius, and plot the global surface temperature variable.\n\nds_plot = dsd[\"tas\"][\"tas\"].mean(dim=\"time\") - 273.15  \nds_plot.plot(cmap=\"bwr\", vmin=-40, vmax=40)\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf#access-obs4mips","position":7},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#esa-cci-toolbox-data-tree-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"content":"Some of the data from the Open Data Portal is provided through the Toolbox in the form of DataTrees. DataTrees are basically a collection of datasets, where each dataset may be accessed through an identifier. This structure is applied to all gridded data that is subdivided into regions. As each of these region-specific datasets is a standard dataset, all toolbox operations can be applied to them.\n\nThis notebook shall serve to show what CCI datasets are concerned and how they can be opened.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nWe start, as usual, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nWe list the available data types of the store to make sure ‘datatree’ is included in the list.\n\ncci_store.get_data_types()\n\n\n\nAs datatrees are provided, we can ask which datasets are actually provided in this form.\n\nlist(cci_store.get_data_ids(data_type=\"datatree\"))\n\n\n\nSo, datatrees are provided for three ECVs: FIRE, LC, and VEGETATION. To fully show the use of datatrees, we will open FIRE and VEGETATION data.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#esa-cci-toolbox-data-tree-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening FIRE Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#opening-fire-data","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening FIRE Data"},"content":"\n\nWe start with opening one of the FIRE datasets.\n\nfire_dataset = \"esacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel\"\n\n\n\nAs first step, we have a look at the potential opener parameters.\n\ncci_store.get_open_data_params_schema(fire_dataset)\n\n\n\nOne entry that we don’t see when opening datasets of other type is the property place_names. If we extend this, we see a listing of Areas 1 to 6. Each of these identifiers stands for a different area. We can either open the data tree with all areas or pass a subset of this list as a parameter to only retrieve the area we are interested in. This will also increase performance.\n\nplaces = [\"AREA_1\"]\n\n\n\nfire_dt = cci_store.open_data(\n    fire_dataset,\n    place_names=places\n)\nfire_dt\n\n\n\nWe can see which datasets are available by asking for its keys.\n\nlist(fire_dt.keys())\n\n\n\nAs expected, it is the place(s) we had requested. We can now retrieve a dataset from any of the keys.\n\nds = fire_dt.get(places[0]).to_dataset()\nds\n\n\n\nAnd, of course, we can open and plot any of the data variables:\n\nds.CL.isel({\"time\": -6, \"x\": slice(25500, 26500), \"y\": slice(13500, 14500)}).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#opening-fire-data","position":5},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening VEGETATION Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#opening-vegetation-data","position":6},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening VEGETATION Data"},"content":"\n\nWe continue by opening a VEGETATION data set. What’s particular about this dataset is that it offers a lot of different sites, as becomes apparent from looking at the places in the schema properties\n\nvegetation_ds = \"esacci.VEGETATION.5-days.L3S.VP_PRODUCTS.VEGETATION.SPOT-5.MERGED.v1-0.r1\"\n\n\n\ncci_store.get_open_data_params_schema(vegetation_ds)\n\n\n\nWe can pick any of those sites and use them to open the data tree.\n\nplaces = [\"site_00001_ABRACOS_HILL\", \"site_00021_BASKIN\"]\n\n\n\nabracos = cci_store.open_data(\n    vegetation_ds,\n    place_names=places\n)\nabracos\n\n\n\nAgain, we see check that the correct places are provided.\n\nlist(abracos.keys())\n\n\n\nWe now open one of these datasets.\n\nds = abracos.get(places[0]).to_dataset()\nds\n\n\n\nWe see that this dataset has only a small extent spatially, but provides a long time series, so we do not plot an area, but pick the time series for one of the grid cells.\n\nds.LAI.isel(lat=1, lon=1).plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-data-trees#opening-vegetation-data","position":7},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-general-data-access","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-general-data-access","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-general-data-access#esa-cci-toolbox-data-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"content":"The aim of this notebook is to show how to query for all the data sets provided by the ESA CCI Toolbox.\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe ESA CCI Toolbox is based on xcube. It provides dedicated stores to access data from the ESA Open Data Portal (ODP). To access the store, we can use the following import.\n\nfrom xcube.core.store import new_data_store\n\n\n\nNow we can acces the ESA Open Data Portal store. We may request it by ‘esa-cci’.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nWe can check what types of data it provides.\n\ncci_store.get_data_types()\n\n\n\nAll provided data are datasets. So, let’s have a look what data sets are available.\n\ndatasets = cci_store.get_data_ids()\nlist(datasets)\n\n\n\nThis might have been a bit much. In case you are looking for particular data sets, you can search for them. You can list which search options are available:\n\ncci_store.get_search_params_schema()\n\n\n\nThe parameters are listed under properties. start_date, end_date and bbox are standard search parameters that are also used by other stores. cci_attrs lists additional parameters that are specific for the cci store (again, listed under properties). Of these, let’s use ecv and frequency.\n\ncci_attrs = dict(\n    ecv='AEROSOL', \n    frequency='month'\n)\n\n[descriptor.data_id for descriptor in cci_store.search_data(cci_attrs=cci_attrs)]\n\n\n\n‘esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1’ sounds interesting. Let’s get more information about that one.\n\ncci_store.describe_data('esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid')\n\n\n\nFinally, we can have a look at which openers are provided by this store.\n\ncci_store.get_data_opener_ids()\n\n\n\nHere is how you can view which parameters can be used when you want to open a particular dataset (both parameters are optional).\n\ncci_store.get_open_data_params_schema(data_id='esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid', opener_id='dataset:zarr:cciodp')\n\n\n\nGreat! Now we are all set to open some cubes.\n\nds = cci_store.open_data(data_id='esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid', opener_id='dataset:zarr:cciodp')\nds\n\n\n\nds.isel(time=263).burned_area.plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-general-data-access#esa-cci-toolbox-data-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-data-access-with-subsets","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-data-access-with-subsets","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-data-access-with-subsets#esa-cci-toolbox-data-access-with-parameters","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"content":"This notebook shows how to open data cubes from the ESA Open Data Portal for a given time range and region:\n\nA temporarily regular cube with aggregated CCI data that fall into equal-size time periods;\n\nWe start with necessary imports.\n\nfrom xcube.core.store import new_data_store\nimport IPython.display\nimport shapely\n\n\n\nNow we can create the store.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nFor this demo, we are using the dataset with the id ‘esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1’. Here is its metadata:\n\ncci_store.describe_data('esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1')\n\n\n\nWe are focussing on Africa, so we define a bounding box accordingly.\n\nx1 = -23.40  # degree\ny1 = -40.40  # degree\nx2 = 57.40  # degree\ny2 = 40.40  # degree\n\nbbox = (x1, y1, x2, y2)\n\n\n\nVisualize the bounding box. If you don’t see anything, please refer to \n\nEx0-DCFS-Setup.\n\nIPython.display.GeoJSON(shapely.geometry.box(*bbox).__geo_interface__)\n\n\n\nOur time range covers data from 1997: 1997-01-01 to 1997-12-01\n\n\n\nNow to open the dataset. You may check its metadata first to make sure that your parameters are valid.\n\ncci_store.get_open_data_params_schema(data_id='esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1', opener_id='dataset:zarr:cciodp')\n\n\n\nSelect any valid combination from the paramater in properties above. The only mandatory parameter is the data_id. If you leave any parameter out, all available values will be considered.\n\ncube = cci_store.open_data('esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1',\n                           variable_names=['absorbing_aerosol_index'],\n                           bbox=bbox,\n                           time_range=['2005-01-01', '2005-12-31'])\ncube\n\n\n\nWe may visualize the cube’s time coordinates:\n\ncube.time.diff(dim='time').plot.line()\n\n\n\nAnd finally, display the results:\n\ncube.absorbing_aerosol_index.sel(time='2005-04-15 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-data-access-with-subsets#esa-cci-toolbox-data-access-with-parameters","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data#esa-cci-toolbox-vector-data-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"content":"The ESA CCI Toolbox also provides access to data that is not provided on a structured grid. This data is provided in the form of geopandas geodataframes rather than xarray datasets.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nFor this notebook, we start as before, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nThe data in question are AEROSOL, GHG, ICESHEETS, RIVER DISCHARGE (RD), SEAICE, and SEALEVEL datasets in satellite-orbit-frequency. Let’s search for ICESHEETS datasets.\n\ndescriptors = cci_store.search_data(\n    data_type=\"geodataframe\",\n    cci_attrs=dict(\n        ecv=\"ICESHEETS\"\n    )\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\nWe have a closer look at the first one.\n\ndescriptors[0]\n\n\n\nWe can now open the dataframe, just like we would open any other dataset. For dataframes, all data is read in immediately when displaying frame. As we want to avoid long waiting times, we ask for a temporal subset by applying a time range.\n\nicesheets_df = cci_store.open_data(\n    \"esacci.ICESHEETS.unspecified.Unspecified.CFL.multi-sensor.multi-platform.UNSPECIFIED.v3-0.greenland\",\n    time_range=(\"2014-10-01\", \"2014-10-15\")\n)\n\n\n\nNow we may view the actual frame.\n\nicesheets_df\n\n\n\nIf you now plot the dataframe, you will see that all loaded entries are included.\n\nicesheets_df.plot()\n\n\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data#esa-cci-toolbox-vector-data-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access","lvl2":"Reading River Discharge Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data#reading-river-discharge-data","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access","lvl2":"Reading River Discharge Data"},"content":"\n\nWith River Discharge Data, there is a particularity, as it supports requesting by placenames. We can see this from the dataset’s descriptor.\n\ndescriptors = cci_store.search_data(\n    data_type=\"geodataframe\",\n    cci_attrs=dict(\n        ecv=\"RD\"\n    )\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\ndescriptors[0]\n\n\n\nUnder '‘open_params_schema/properties/place_names’ you can find a list of place names that you can ask for when opening the dataset. You can also omit the parameter if you wish to get the data for all rivers (this would take some time to load).\n\nghg_df = cci_store.open_data(\n    \"esacci.RD.satellite-orbit-frequency.L3S.WL.multi-sensor.multi-platform.MERGED.v1-1.r1\",\n    place_names=[\"GARONNE_GARONNE_LAMAGISTERE\", \"PO_PO_PIACENZA\"]\n)\nghg_df\n\n\n\nWe may now plot the data.\n\nghg_df.plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data#reading-river-discharge-data","position":5},{"hierarchy":{"lvl1":"Access to Zarr Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-zarr-access","position":0},{"hierarchy":{"lvl1":"Access to Zarr Data"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-zarr-access","position":1},{"hierarchy":{"lvl1":"Access to Zarr Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-zarr-access#access-to-zarr-data","position":2},{"hierarchy":{"lvl1":"Access to Zarr Data"},"content":"Some datasets from the Open Data Portal have been migrated to the Zarr format. This allows for faster opening and processing, so it makes sense to check whether data is provided in the Zarr format first.\n\nThe data is available via store abbreviation ‘cci-zarr-store’.\n\nfrom xcube.core.store import new_data_store\n\n\n\nzarr_store = new_data_store('esa-cci-zarr')\n\n\n\nAgain, let’s see what data sets are available.\n\ndatasets = zarr_store.list_data_ids()\ndatasets\n\n\n\nlen(datasets)\n\n\n\nThe names are similar but different to the ones from the Climate Toolbox store.\nWe can have a look at a dataset’s metadata to find out more about it.\n\nzarr_store.describe_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\n\n\n\nCubes can easily be opened from the store like this:\n\ncube = zarr_store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\ncube\n\n\n\nSubsets of the data may easily be created like this:\n\nsub_cube = cube.sel({\n    'lat': slice(40.40, -40.40),\n    'lon': slice(-23.40, 57.40),\n    'time': slice('2000-01-01', '2000-12-31')\n    }\n)\nsub_cube\n\n\n\n... and we can plot the data.\n\nsub_cube.sm.sel(time='2000-07-01 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-zarr-access#access-to-zarr-data","position":3},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-kerchunk-access","position":0},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-kerchunk-access","position":1},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-kerchunk-access#access-to-data-in-netcdf-format-viewed-as-zarr","position":2},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"content":"Some datasets offered by the Open Data Portal are provided via\n\n\nreferences format\nas specified by the \n\nkerchunk\npackage. This allows accessing to the original NetCDF data files with\nan I/O performance comparable to \n\nZarr.\n\nThe data is available via store identifier ‘cci-kerchunk-store’.\n\nfrom xcube.core.store import new_data_store\n\n\n\nkerchunk_store = new_data_store('esa-cci-kc')\n\n\n\nAgain, let’s see what data sets are available.\n\ndatasets = kerchunk_store.list_data_ids()\ndatasets\n\n\n\nThe names are similar but different to the ones from the Climate Toolbox store.\nWe can have a look at a dataset’s metadata to find out more about it.\n\nkerchunk_store.describe_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-19781101-20211231-fv07.1-kr1.1')\n\n\n\nCubes can easily be opened from the store like this:\n\ncube = kerchunk_store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-19781101-20211231-fv07.1-kr1.1')\ncube\n\n\n\nSubsets of the data may easily be created like this:\n\nsub_cube = cube.sel({\n    'lat': slice(40.40, -40.40),\n    'lon': slice(-23.40, 57.40),\n    'time': slice('2000-01-01', '2000-12-31')\n    }\n)\nsub_cube\n\n\n\n... and we can plot the data.\n\nsub_cube.sm.sel(time='2000-07-01 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-kerchunk-access#access-to-data-in-netcdf-format-viewed-as-zarr","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data-cubes","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data-cubes","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data-cubes#esa-cci-toolbox-vector-data-cube-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"content":"The ESA CCI Toolbox also provides access to data that is provided in the form of vector data cubes. These can be thought of as a hybrid between data cubes and vector data. It is a data cube where the spatial locations are not identified through a structured grid, but distinct geometries.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nFor this notebook, we start as before, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nThe data in question are ICESHEETS and SEALEVEL datasets. We can find the vector data cubes by specifying their data type.\n\ndescriptors = cci_store.search_data(\n    data_type=\"vectordatacube\",\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\nWe have a closer look at the first sea level dataset.\n\ndescriptors[4]\n\n\n\nNow, we can open the dataset to see what the vector data cube looks like.\n\nsl_ds = cci_store.open_data(\n    \"esacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.ASA\"\n)\n\nsl_ds\n\n\n\nWe see that the resulting dataset has a geometry coordinate which consists of single points. We may plot a variable which only has a single geometric dimension like this:\n\nimport geopandas as gpd\ngdf = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"local_sla_trend\"]].to_dataframe())\ngdf.plot(column=\"local_sla_trend\")\n\n\n\n\n\nWe may also plot variables which have values along the temporal dimension. We can do so like this:\n\ngdf2 = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"sla\", \"nbmonth\"]].to_dataframe())\ngdf2.xs(\"2019-09-16 00:00:00\", level=\"nbmonth\").plot(column=\"sla\")\n\n\n\n\n\nsl_ds = cci_store.open_data(\n    \"esacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.ASA\"\n)\ngdf = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"local_sla_trend\"]].to_dataframe())\ngdf.plot(column=\"local_sla_trend\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-vector-data-cubes#esa-cci-toolbox-vector-data-cube-access","position":3},{"hierarchy":{"lvl1":"Access to WCS data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-reading-wcs-data","position":0},{"hierarchy":{"lvl1":"Access to WCS data"},"content":"The CEDA data server at \n\nhttps://​data​.cci​.ceda​.ac​.uk/ provides access via the OGC Web Coverage Service (WCS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WCS from the CEDA server, using \n\nOWSLib as the client.\n\nIf owslib is not already installed in the Python environment, uncomment the following cell to install it with mamba.\n\n# ! mamba install --yes owslib\n\n\n\nImport some required libraries, including OWSLib as the WCS client.\n\nfrom owslib.wcs import WebCoverageService\nimport xarray as xr\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\n%matplotlib inline\nimport matplotlib.pyplot as plt\n\n\n\nDefine a simple convenience class CciWcs to manage the web service.\n\nclass CciWcs:\n\n    def __init__(self, dataset_id: str):\n        self.service = WebCoverageService(\n            f\"https://data.cci.ceda.ac.uk/thredds/wcs/{dataset_id}?service=WCS&version=1.0.0\",\n            version=\"1.0.0\"\n        )\n        \n    def coverage(self, data_id: str, bbox: tuple[float]) -> xr.Dataset:\n        coverage = self.service.getCoverage(\n          identifier=data_id,\n          bbox=bbox,\n          format=\"NetCDF3\",\n          timeout=600\n        )\n        with open(\"coverage.nc\", \"wb\") as fh:\n            fh.write(coverage.read())\n        return xr.open_dataset(\"coverage.nc\")\n\n\n\nList the available ECVs.\n\nlist_ecvs()\n\n\n\nList the available datasets for the Land Surface Temperature (LST) ECV.\n\nprint(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"LST\"))))\n\n\n\nSelect a dataset from the list and store its name in a variable for use in the following steps.\n\nds_id = \"esacci.LST.mon.L3S.LST.multi-sensor.multi-platform.IRCDR.2-00.DAY\"\n\n\n\nCreate a local representation of the WCS service for the selected dataset.\n\ncciwcs = CciWcs(ds_id)\n\n\n\nList the data variables available from this service.\n\nlist(cciwcs.service.contents.keys())\n\n\n\nSelect the lst variable from the list and store its name in a variable.\n\ndata_id = \"lst\"\n\n\n\nCheck the bounding box for the selected dataset and variable; we can see that it is of global extent.\n\ncciwcs.service.contents[data_id].boundingBoxWGS84\n\n\n\nFor a quick demonstration with a small amount of data, request a coverage for a small sub-region and return it as a xarray dataset.\n\nds = cciwcs.coverage(\n    data_id=\"lst\",\n    bbox=(9.7, 53.3, 10.3, 53.5)\n)\n\n\n\nShow some of the metadata for the returned coverage.\n\nds\n\n\n\nUse the coverage data to plot a map of land surface temperature for a specific point in time.\n\nds.lst.isel(time=100).plot.imshow()\n\n\n\nUse the coverage data to plot a graph of land surface temperature against time for a specific location.\n\nds.lst.sel(lat=53.4, lon=10.0, method=\"nearest\").plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-reading-wcs-data","position":1},{"hierarchy":{"lvl1":"Access to WMS data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-reading-wms-data","position":0},{"hierarchy":{"lvl1":"Access to WMS data"},"content":"The CEDA data server at \n\nhttps://​data​.cci​.ceda​.ac​.uk/ provides access via the OGC Web Map Service (WMS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WMS from the CEDA server, using \n\nOWSLib as the client.\n\nIf owslib is not already installed in the Python environment, uncomment the following cell to install it with mamba.\n\n# ! mamba install --yes owslib\n\n\n\nImport some required libraries, including OWSLib as the WMS client.\n\nfrom owslib.wms import WebMapService\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\nfrom IPython.display import Image\n\n\n\nList the available ECVs.\n\nlist_ecvs()\n\n\n\nList the available datasets for the cloud ECV.\n\nprint(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"CLOUD\"))))\n\n\n\nSelect a dataset from the list and store its name in a variable for use in the following steps.\n\nds_id = \"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\"\n\n\n\nCreate a local representation of the WMS service for the selected dataset.\n\nwms_url = f\"https://data.cci.ceda.ac.uk/thredds/wms/{ds_id}?service=WMS&version=1.3.0\"\nwms = WebMapService(wms_url, version=\"1.3.0\", timeout=600)\n\n\n\nList the data variables available from this service.\n\nlist(wms.contents)\n\n\n\nSelect the iwp (ice water path) variable from the list and store its name in a variable.\n\ndata_id = \"iwp\"\n\n\n\nCheck the bounding box for the selected dataset and variable; we can see that it is of global extent.\n\nwms.contents[data_id].boundingBox\n\n\n\nCheck what times are available, filtering to the year 2011.\n\n[t for t in wms[data_id].timepositions if t.startswith(\"2011\")]\n\n\n\nRequest a map for the chosen dataset and variable from the WMS server, selecting a time from the list above and a bounding box covering latitudes from 80°S to 50°N, then display the map in the notebook.\n\nresponse = wms.getmap(\n    layers=[\"iwp\"],\n    styles=[\"boxfill/rainbow\"],\n    size=[800, 600],\n    srs=\"EPSG:4326\",\n    bbox=[-180.0, -80.0, 180.0, 50.0],\n    format=\"image/png\",\n    time=\"2011-12-01T00:00:00.000Z\"\n)\n\nImage(response.read())\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-reading-wms-data","position":1},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-using-xcube-viewer","position":0},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-using-xcube-viewer","position":1},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-using-xcube-viewer#using-the-esa-cci-toolbox-with-the-xcube-viewer","position":2},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"content":"The xcube viewer is an easy way to display gridded data. In this notebook, we show how the viewer can be started from a notebook and how cci datasets can be added to it.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe viewer requires datasets. For this notebook, we will access them from the Zarr store and the regular store.\n\nfrom xcube.core.store import new_data_store\n\nzarr_store = new_data_store('esa-cci-zarr')\ncci_store = new_data_store('esa-cci')\n\n\n\nIf you want, you can execute the following lines to see which datasets are available. For now, this part is in a comment as we do not want to print all the datasets for reasons of readability.\n\n# zarr_store.list_data_ids()\n\n\n\n# cci_store.list_data_ids()\n\n\n\nFrom the Zarr store, we pick a snow dataset.\n\nsnow_ds = zarr_store.open_data('ESACCI-L3C_SNOW-SWE-1979-2020-fv2.0.zarr')\nsnow_ds\n\n\n\nFrom the cci store, we pick an aerosol dataset. However, let’s just use a subset here, to see how it will look in the viewer.\n\nx1 = -23.40  # degree\ny1 = -40.40  # degree\nx2 = 57.40  # degree\ny2 = 40.40  # degree\nbbox = (x1, y1, x2, y2)\n\naerosol_ds = cci_store.open_data(\n    'esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1',\n    variable_names=['absorbing_aerosol_index'],\n    bbox=bbox,\n    time_range=['2005-01-01', '2005-12-31']\n)\naerosol_ds\n\n\n\nNow that we have the datasets assembled, we can start the viewer. We import it from xcube like this:\n\nfrom xcube.webapi.viewer import Viewer\n\n\n\nviewer = Viewer()\n\n\n\nNext, we add the datasets.\n\nviewer.add_dataset(snow_ds)\n\n\n\nviewer.add_dataset(aerosol_ds)\n\n\n\nNow that the viewer is set up, we can ask for information about it. With the following command, we get the links for the server and the viewer. The server is responsible for serving the datasets. You may take the link and use it with any running viewer. However, it is directly plugged into the viewer instance which you can open from its link.\n\nviewer.info()\n\n\n\nAlternatively, you can open the viewer in a notebook cell:\n\nviewer.show()\n\n\n\n... and there you go. You can learn more about the usage of the viewer here: \n\nhttps://​xcube​.readthedocs​.io​/en​/latest​/viewer​.html . You may add any datasets, but not geodataframes or vector data cubes. To keep the viewer usable, we advise against adding too many or too large datasets.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-using-xcube-viewer#using-the-esa-cci-toolbox-with-the-xcube-viewer","position":3},{"hierarchy":{"lvl1":"Failure reporting in the ESA Climate Toolbox"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-failure-reporting","position":0},{"hierarchy":{"lvl1":"Failure reporting in the ESA Climate Toolbox"},"content":"The ESA Climate Toolbox provides a mechanism whereby unrecoverable failures can be reported automatically to an external server. The user must explicitly consent to this data sharing before it can be activated.\n\nThis notebook demonstrates the mechanism by setting up a simple local reporting server, which receives failure reports and writes them to a file. The notebook then activates automated failure reporting and deliberately raises an error from the toolbox. Finally, the server’s log file is shown to demonstrate that the report was received and logged.\n\nImport some necessary classes and modules, including the FailureReporter class.\n\nimport datetime\nimport json\nimport pathlib\nfrom http.server import BaseHTTPRequestHandler\nfrom http.server import HTTPServer\nimport multiprocessing\nfrom esa_climate_toolbox.util.reporting import FailureReporter\n\n\n\nDefine a minimal server which will receive failure reports, and start it in the background.\n\nlog_path = pathlib.Path(\"server-log.txt\")\n\nclass ReportRequestHandler(BaseHTTPRequestHandler):\n\n    def do_POST(self):\n        self.send_response(200)\n        self.send_header(\"Content-Type\", \"text/plain\")\n        self.end_headers()\n        content_length = int(self.headers.get(\"Content-Length\", 0))\n        content = self.rfile.read(content_length).decode(\"utf-8\")\n        data = json.loads(content)\n        with open(log_path, \"a\") as fh:\n            fh.write(datetime.datetime.now(datetime.UTC).isoformat() + \"\\n\")\n            for k, v in data.items():\n                fh.write(k + \":\\n\")\n                fh.write(\"\\n\".join(v) if isinstance(v, list) else str(v) + \"\\n\")\n            fh.write(\"\\n\")\n        self.wfile.write(\"OK\".encode(\"utf-8\"))\n\nserver = HTTPServer((\"127.0.0.1\", 9898), ReportRequestHandler)\n\ndef start_server():\n    server.serve_forever()\n\nlog_path.unlink(missing_ok=True)\nprocess = multiprocessing.Process(target=start_server)\nprocess.start()\n\n\n\nCreate and activate a FailureReporter, which will automatically detect and report any unhandled exceptions involving the ESA Climate Toolbox. The URL of the server which receives the reports can be passed as a parameter or using the environment variable ESA_CLIMATE_TOOLBOX_FAILURE_REPORTING_SERVER_URL. The user is asked for their explicit consent before the reporter is activated.\n\nreporter = FailureReporter(\"http://localhost:9898\")\nreporter.activate()\n\n\n\n\n\n\n\nNow test the functionality. The FailureReporter class provides a method called raise_error to deliberately trigger an error within the toolbox code for testing purposes.\n\nFailureReporter.raise_error()\n\n\n\n\n\nFor comparison, trigger an exception not involving the climate toolbox. This will still be reported in the notebook, but will not be reported to the server.\n\n1 / 0\n\n\n\nShow the contents of the server’s log file. Note that the exception from the climate toolbox is logged, but the other exception is not.\n\nwith open(log_path, \"r\") as fh:\n    for line in fh.readlines():\n        print(line, end=\"\")\n\n\n\nShut down the server.\n\nprocess.kill()\nserver.socket.close()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-failure-reporting","position":1},{"hierarchy":{"lvl1":"Performance tests"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-performance","position":0},{"hierarchy":{"lvl1":"Performance tests"},"content":"This notebook makes some time measurements of climate toolbox operations.\n\nImport some necessary libraries.\n\nimport xarray as xr\nfrom xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom esa_climate_toolbox.core import find_data_store, get_store, list_datasets\n%matplotlib inline\nimport matplotlib.pyplot as plt\n\n\n\nSelect a suitable dataset of global extent for the tests.\n\ndsname = \"esacci.LST.yr.L3C.LST.multi-sensor.multi-platform.SSMI_SSMIS.v2-33.ASC\"\n\n\n\nFind the store that contains the dataset.\n\nstore_name, store = find_data_store(ds_id=dsname)\n\n\n\nCheck the accepted parameters for opening this dataset.\n\nstore.get_open_data_params_schema(dsname)\n\n\n\nOpen a dataset for the full global extent and the year 2020, containing the variables lst and lst_uncertainty.\n\nds = store.open_data(\n    dsname,\n    variable_names=[\"lst\", \"lst_uncertainty\"],\n    time_range=[\"2020-01-01\", \"2020-12-31\"],\n    bbox=[-180, -90, 180, 90]\n)\n\n\n\nShow the dataset’s metadata.\n\nds\n\n\n\nFor demonstration and testing purposes, resample the dataset to a higher resolution, corresponding to a cell size of slightly under 10 × 10 km at the equator. (Longitudinal resolution increases with increasing latitude.)\n\nsource_gm = GridMapping.from_dataset(ds)\n\n\n\ntarget_gm = source_gm.scale(3)\n\n\n\nds_resampled = resample_in_space(ds, source_gm=source_gm, target_gm=target_gm)\n\n\n\nds_resampled\n\n\n\nWrite the dataset to a Zarr archive in local storage, in the same directory as this notebook.\n\nzarr_path = \"lst-global-10km.zarr\"\nds_resampled.to_zarr(zarr_path, mode=\"w\")\n\n\n\nMeasure and display the time required to ingest the data from Zarr into an xarray dataset.\n\n%%time\nds_zarr = xr.open_zarr(zarr_path)\n\n\n\nMeasure and display the time required to apply a dummy algorithm (doubling all values) to the ingested dataset.\n\n%%time\nds_processed = ds_zarr + ds_zarr\n\n\n\nMeasure and display the time required to plot the lst variable of the ingested and processed dataset.\n\n%%time\nds_processed.squeeze().lst.plot.imshow()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-performance","position":1},{"hierarchy":{"lvl1":"Finding Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-finding-operations","position":0},{"hierarchy":{"lvl1":"Finding Operations"},"content":"This notebook serves to show how operations can be detected and how information about these operations can be shown.\n\nfrom IPython.display import JSON\n\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.core import list_operations\n\n\n\nOperations of the ESA Climate Toolbox can be listed by calling the list_operations command.\n\nlist_operations()\n\n\n\nTo get information about the required input parameters, you can ask for an operation’s meta info and see its inputs. Under outputs, you will find what you will get from applying the operation.\n\nJSON(get_op_meta_info('coregister'))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-finding-operations","position":1},{"hierarchy":{"lvl1":"Usage of Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations","position":0},{"hierarchy":{"lvl1":"Usage of Operations"},"content":"This notebook serves to show how operations provided by the toolbox can be applied.\nFor this purpose, the following aspects are covered:\n\nAccess to ESA CCI Ozone and Cloud data (Atmosphere Mole Content of Ozone and Cloud Cover)\n\nGeometric adjustments (coregistration)\n\nSpatial (point, polygon) and temporal subsetting\n\nVisualisation of time series\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations","position":1},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Ingest data and create datasets"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#ingest-data-and-create-datasets","position":2},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Ingest data and create datasets"},"content":"\n\nfrom IPython.display import JSON\n\nfrom xcube.core.store import new_data_store\n\nimport esa_climate_toolbox.ops as ops\n\nfrom esa_climate_toolbox.core import get_op\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.util.monitor import ConsoleMonitor\n\n\n\nFirst, read in the ESA Climate Data Centre Data Store.\n\ndata_store = new_data_store('esa-climate-data-centre')\n\n\n\nOpen an ozone dataset (see Notebook 1-ECT_General_Data_Access to find which options you have).\n\nozone_ds = data_store.open_data('esacci.OZONE.mon.L3.NP.multi-sensor.multi-platform.MERGED.fv0002.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\nozone_ds\n\n\n\nOpen a cloud dataset next.\n\ncloud_ds = data_store.open_data('esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\ncloud_ds\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#ingest-data-and-create-datasets","position":3},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Filter datasets to select the desired variables"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#filter-datasets-to-select-the-desired-variables","position":4},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Filter datasets to select the desired variables"},"content":"\n\nThe datasets are rather large, so we opt to make datasets that have only the variable we are interested in. The select_var op may be used for that.\n\nJSON(get_op_meta_info('select_var'))\n\n\n\nsvar_op = get_op('select_var')\n\n\n\nWe choose the variable cfc (cloud area fraction) from the cloud dataset ...\n\ncfc_ds = svar_op(ds=cloud_ds, var='cfc')\ncfc_ds\n\n\n\n... and O3_du_tot (the atmosphere mole content of ozone) from the ozone dataset.\n\nozone_tot_ds = svar_op(ds=ozone_ds, var='O3_du_tot')\nozone_tot_ds\n\n\n\nPlot the first time slices of the datasets\n\n%matplotlib inline\n\ncfc_ds.cfc.isel(time=0).plot()\n\n\n\nozone_tot_ds.O3_du_tot.isel(time=0).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#filter-datasets-to-select-the-desired-variables","position":5},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Co-register datasets by resampling"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#co-register-datasets-by-resampling","position":6},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Co-register datasets by resampling"},"content":"\n\nWe see that though both datasets are global, they are in different spatial resolutions:\n\nprint(cfc_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)\n\n\n\nTo bring them to the same resolution, we use the coregister function.\n\nJSON(get_op_meta_info('coregister'))\n\n\n\ncoregister_op = get_op('coregister')\n\n\n\nWe get the cloud dataset to the resolution of the ozone dataset.\n\ncfc_res_ds = coregister_op(ozone_tot_ds, cfc_ds)\n\n\n\nCheck the variable shapes again to see we were successful:\n\nprint(cfc_res_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)\n\n\n\nAnd plot again:\n\ncfc_res_ds.cfc.isel(time=0).plot()\n\n\n\nimport matplotlib.pyplot as plt\n\nfig, axes = plt.subplots(1, 2, figsize=(10, 4))\ncfc_res_ds.cfc.isel(time=0).plot(ax=axes[0])\naxes[0].set_title(\"Cloud Fraction\")\nozone_tot_ds.O3_du_tot.isel(time=0).plot(ax=axes[1])\naxes[1].set_title(\"Ozone Content\")\nplt.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#co-register-datasets-by-resampling","position":7},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired spatial region"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#select-the-desired-spatial-region","position":8},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired spatial region"},"content":"\n\nWe want to continue our analysis with a subset, say, Africa. For this we use subset_spatial.\n\nJSON(get_op_meta_info('subset_spatial'))\n\n\n\nsubset_spatial_op = get_op('subset_spatial')\n\n\n\nafrica = '-20.0, -40.0, 60.0, 40.0'\n# 'lon_min, lat_min, lon_max, lat_max'\ncfc_africa_res_ds = subset_spatial_op(cfc_res_ds, africa)\nozone_tot_africa_ds = subset_spatial_op(ozone_tot_ds, africa)\n\n\n\nThis is a good time to compare the plots of the resampled subset and the original plot to see the effects of our work:\n\ncfc_africa_res_ds.cfc.isel(time=0).plot()\n\n\n\ncfc_ds.cfc.isel(time=0).sel({'lat': slice(-40, 40), 'lon': slice(-20, 60)}).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#select-the-desired-spatial-region","position":9},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired temporal region"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#select-the-desired-temporal-region","position":10},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired temporal region"},"content":"\n\nWe may also create a temporal subset:\n\nJSON(get_op_meta_info('subset_temporal'))\n\n\n\nsubset_temporal_op = get_op('subset_temporal')\n\n\n\ncfc_africa_res_janmar_ds = subset_temporal_op(cfc_africa_res_ds, '2007-01-01, 2007-03-31')\nozone_tot_africa_janmar_ds = subset_temporal_op(ozone_tot_africa_ds, '2007-01-01, 2007-12-31')\n\n\n\nprint(cfc_africa_res_janmar_ds.time)\n\n\n\nprint(ozone_tot_africa_janmar_ds.time)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#select-the-desired-temporal-region","position":11},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Retrieve and plot timeseries"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#retrieve-and-plot-timeseries","position":12},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Retrieve and plot timeseries"},"content":"\n\nFinally, we can create time series from these datasets. Operation tseries_point can be used to get a time series for a given point, tseries_mean will get the mean and standard deviation across the dataset.\n\nJSON(get_op_meta_info('tseries_point'))\n\n\n\nJSON(get_op_meta_info('tseries_mean'))\n\n\n\ntseries_point_op = get_op('tseries_point')\ntseries_mean_op = get_op('tseries_mean')\n\n\n\nozone_ts_point = tseries_point_op(ozone_tot_africa_janmar_ds, point='50, 50')\ncfc_ts_point = tseries_point_op(cfc_africa_res_janmar_ds, point='50, 50')\nozone_ts_mean = tseries_mean_op(ozone_tot_africa_janmar_ds, var='O3_du_tot')\ncfc_ts_mean = tseries_mean_op(cfc_africa_res_janmar_ds, var='cfc')\n\n\n\nprint(ozone_ts_mean)\n\n\n\nprint(cfc_ts_mean)\n\n\n\ncfc_ts_mean.cfc_mean.plot()\n\n\n\nozone_ts_mean.O3_du_tot_mean.plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-using-operations#retrieve-and-plot-timeseries","position":13},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data#esa-cci-toolbox-reproject-dataset","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"content":"The purpose of this notebook is to demonstrate how to access a dataset, resample it to different coordinates, and reproject it to a new coordinate reference system (CRS).\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe ESA CCI Toolbox is built on xcube, leveraging many of its functionalities in this notebook. For additional examples on resampling and reprojection, visit the \n\nxcube GitHub repository.\n\nfrom xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom xcube.core.store import new_data_store\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data#esa-cci-toolbox-reproject-dataset","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset","lvl2":"Reproject Dataset from ESA Open Data Portal"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data#reproject-dataset-from-esa-open-data-portal","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset","lvl2":"Reproject Dataset from ESA Open Data Portal"},"content":"\n\nTo access datasets from the ESA Open Data Portal store, we begin by initializing a new data store using the store ID ‘esa-cci’.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nAll provided data are datasets. So, let’s have a look what data sets are available.\n\ndatasets = cci_store.list_data_ids()\ndatasets\n\n\n\nWe would like to reproject Aerosol CCI product. But first we view the available opening parameters for the respective dataset.\n\ncci_store.get_open_data_params_schema(\n    data_id=\"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\"    \n)\n\n\n\nNow we can open the dataset and select a subset which covers Europe and the last half year of the data.\n\nds = cci_store.open_data(\n    \"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\",\n    time_range=[\"2015-07-01\", \"2015-12-31\"],\n    bbox=[0, 45, 20, 60]\n)\nds\n\n\n\nWe can plot the absorbing aerosol index in the original projection before reprojecting it.\n\nds.absorbing_aerosol_index.isel(time=-1).plot()\n\n\n\nNow, we can reproject the dataset from the original Geographic Coordinate System (EPSG:4326 - WGS 84) to the European Terrestrial Reference System 1989 ensemble (EPSG:3035). To achieve this, we first create a grid mapping that defines the target projection, which is then used to reproject the dataset.\n\nsource_gm = GridMapping.from_dataset(ds)\ntemp_target_gm = source_gm.transform(\"EPSG:3035\", xy_res=10000)\ntarget_gm = temp_target_gm.to_regular()\ntarget_gm\n\n\n\nds_reproject = resample_in_space(\n    ds,\n    source_gm=source_gm,\n    target_gm=target_gm,\n)\nds_reproject\n\n\n\nFinally, we can plot the reprojected dataset.\n\nds_reproject.absorbing_aerosol_index.isel(time=-1).plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data#reproject-dataset-from-esa-open-data-portal","position":5},{"hierarchy":{"lvl1":"Filter Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data","position":0},{"hierarchy":{"lvl1":"Filter Operations"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data","position":1},{"hierarchy":{"lvl1":"Filter Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#filter-operations","position":2},{"hierarchy":{"lvl1":"Filter Operations"},"content":"In this section, we will demonstrate three filter operations on CCI ECV datasets:\n\nFiltering a dataset based on a specific flag value.\n\nFiltering, exploring, and propagating uncertainties that accompany the dataset.\n\nFiltering based on any data feature.\n\nAll of these filter operations are performed using the \n\nxarray.Dataset.where method, which is fully compatible with \n\nDask. This approach allows for on-demand filtering, performed chunk-by-chunk for efficiency.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#filter-operations","position":3},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"1. Filtering a datset for a given flag value"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-1-filtering-a-datset-for-a-given-flag-value","position":4},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"1. Filtering a datset for a given flag value"},"content":"We will show this filtering operation on a soil moisture dataset, which comes with a quality flag for its observational data.\n\nimport matplotlib.pyplot as plt\nfrom xcube.core.store import new_data_store\n\n\n\nWe can access the soil moisture dataset through the Zarr data store, as shown below:\n\nstore = new_data_store('esa-cci-zarr')\n\n\n\nds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds\n\n\n\nWe can filter the soil moisture data using the \"no_data_inconsistency_detected\" flag, which corresponds to a flag value of 0 in the flag data variable. This value can be verified by checking the attributes of the flag variable.\n\nfiltered_ds = ds.where(ds[\"flag\"] != 0)\nfiltered_ds\n\n\n\nWe can generate a comparison plot that illustrates both the unfiltered and filtered soil moisture at a single time step as an example.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=1)\nfiltered_ds.sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=1)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-1-filtering-a-datset-for-a-given-flag-value","position":5},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"2. Filtering based on uncertainties that accompany a dataset"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","position":6},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"2. Filtering based on uncertainties that accompany a dataset"},"content":"We will show this filtering operation on a biomass dataset, which carries uncertainty values for the above-ground biomass data in the \"abg_se\" (long name \"Above-ground biomass standard_error\") data variable.\n\nds = store.open_data('ESACCI-BIOMASS-L4-AGB-MERGED-100m-2010-2020-fv4.0.zarr')\nds\n\n\n\nSince the dataset is quite large, we have selected the Tropical Climate Zone (TCL) in Africa for analysis. This region is known for its high biological activity and consequently high values of above-ground biomass.\n\nIt’s important to note that the filtering method works efficiently on the full dataset. This is because the xarray.Dataset.where operation is performed on demand, either when writing or plotting the data. However, without selecting a smaller subset like the TCL Zone, performance issues will arise during plotting.\n\nds = ds.sel(lat=slice(10, -10), lon=slice(10, 40))\nds\n\n\n\nWhere filter the dataset for standard error smaller than 100 Mg/ha.\n\nfiltered_ds = ds.where(ds[\"agb_se\"] <= 100)\nfiltered_ds\n\n\n\nWe can generate a comparison plot that illustrates both the unfiltered and filtered above-ground biomass at a single time step as an example. Also here we downsample the dataset for the plotting.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[0], vmin=0, vmax=500)\nfiltered_ds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[1], vmin=0, vmax=500)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","position":7},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"3. Filtering by any data feature"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-3-filtering-by-any-data-feature","position":8},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"3. Filtering by any data feature"},"content":"We will show this filtering operation on the soil moisture dataset, which also has other data variables which can be used for filtering.\n\nds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds\n\n\n\nFor example, we can use the data variable \"mode\", which indicates whether the observation is derived from the ascending or descending orbit. This variable can be used to filter the dataset, allowing us to select only the ascending mode, represented by 1, and the descending mode, represented by 2, and  as shown below:\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.7)\nds.where(ds[\"mode\"] == 2).sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.7)\n\n\n\nWe can easliy generate the same plot for the soil moisture uncertainty data variable.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm_uncertainty.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.07)\nds.where(ds[\"mode\"] == 2).sm_uncertainty.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.07)\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-filtering-data#id-3-filtering-by-any-data-feature","position":9},{"hierarchy":{"lvl1":"Gap Filling"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling","position":0},{"hierarchy":{"lvl1":"Gap Filling"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling","position":1},{"hierarchy":{"lvl1":"Gap Filling"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling","position":2},{"hierarchy":{"lvl1":"Gap Filling"},"content":"This notebook will show some algorithms to fill gaps of vector data and raster data. The notebook is structured as follows:\n\nGap Filling of a vector dataset in spatial domain\n\nGap filling of a raster dataset in temporal and spatial domain\n\nfrom esa_climate_toolbox.core import get_op\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport numpy as np\nimport scipy.interpolate as interp\nimport xarray as xr\nfrom xcube.core.store import new_data_store\n\n\n\nTo get access to the data, we will initiate the ESA CCI Zarr store in the following cell.\n\nstore = new_data_store('esa-cci-zarr')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling","position":3},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"1. Gap Filling of a Vector Dataset in the Spatial Domain"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#id-1-gap-filling-of-a-vector-dataset-in-the-spatial-domain","position":4},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"1. Gap Filling of a Vector Dataset in the Spatial Domain"},"content":"In this example, we will work with trend data of the Greenland ice sheet, which is provided as a set of spatial points over a given time range. We will apply several interpolation algorithms to fill the gaps between these points, ultimately converting the data into a raster format.\n\nFirst we will open the data as usual.\n\nds = store.open_data(\"ESACCI-ICESHEETS_Greenland_GMB-2003-2016-v1.1.zarr\")\nds\n\n\n\nWe define the final coordiates of the resired target raster and extract one time slice from the data set.\n\nlon = np.arange(-73., -12., 0.02)\nlat = np.arange(83., 59., -0.02)\ngrid_lon, grid_lat = np.meshgrid(lon, lat)\nGMB_trend_slice = ds.GMB_trend.isel(time=0)\n\n\n\nNow we can perform a 2D linear interpolation using scipy.interpolate.griddata.\n\ngridded_data = interp.griddata(\n    (ds.longitude, ds.latitude),\n    GMB_trend_slice, \n    (grid_lon, grid_lat), \n    method='linear'\n)\nds_linear = xr.Dataset(\n    {'GMB_trend_slice': (['lat', 'lon'], gridded_data)},\n    coords={'lon': lon, 'lat': lat}\n)\nds_linear\n\n\n\nThe same approach can be applied using \"cubic\" as the interpolation method.\n\ngridded_data = interp.griddata(\n    (ds.longitude, ds.latitude),\n    GMB_trend_slice, \n    (grid_lon, grid_lat), \n    method=\"cubic\"\n)\nds_cubic = xr.Dataset(\n    {'GMB_trend_slice': (['lat', 'lon'], gridded_data)},\n    coords={'lon': lon, 'lat': lat}\n)\nds_cubic\n\n\n\nNow, we can plot the results: the left plot shows the original points from the ESA CCI ice sheet trend dataset, the center plot displays the linear interpolation, and the right plot presents the cubic interpolation.\n\nfig, ax = plt.subplots(1, 3, figsize=(20, 6))\nscatter = ax[0].scatter(\n    ds.longitude, ds.latitude, c=GMB_trend_slice, cmap='seismic', vmin=-500, vmax=500, s=30\n)\nax[0].set_title('Scatter Plot of Values on 2D Grid')\nax[0].set_ylabel('lat')\nax[0].set_xlabel('lon')\nfig.colorbar(scatter, ax=ax[0], orientation='vertical')\nds_linear.GMB_trend_slice.plot(ax=ax[1], vmin=-500, vmax=500, cmap='seismic')\nax[1].set_title('Linear interpolation')\nds_cubic.GMB_trend_slice.plot(ax=ax[2], vmin=-500, vmax=500, cmap='seismic')\nax[2].set_title('Cubic interpolation')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#id-1-gap-filling-of-a-vector-dataset-in-the-spatial-domain","position":5},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#id-2-gap-filling-of-a-raster-dataset","position":6},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"2. Gap filling of a raster dataset"},"content":"In this example, we will work with the soil moisture dataset, which is a 3d rastered dataset with gaps in it. We will show an example how to fill the gaps along the time axis for a time series and how to fill the pags in the 2d spatial domain.\n\nFirst we will open the data as usual.\n\nds = store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\nds\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#id-2-gap-filling-of-a-raster-dataset","position":7},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap filling along the time axis","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling-along-the-time-axis","position":8},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap filling along the time axis","lvl2":"2. Gap filling of a raster dataset"},"content":"For this, we create a small function that removes all NaN values and then performs interpolation to the original time axis using xarray.Dataset.interp().\n\ndef fill_temporal_gaps(ds, method=\"linear\"):\n    new_times = ds_ts.time\n    ds_nonans = ds_ts.dropna(dim=\"time\")\n    return ds_nonans.interp(time=new_times, method=method)\n\n\n\nWe will apply this gap-filling method to one year of the dataset as an example. To do this, we subset the dataset and select the year 2000.\n\nds_ts = ds.sel(lat=20, lon=20, method=\"nearest\")\nds_ts = ds_ts.sel(time=slice('2000-01-01 00:00:00', '2001-01-01 00:00:00'))\nds_ts\n\n\n\nNext, we apply the gap-filling method to the selected sample.\n\nds_ts_gap_fill = fill_temporal_gaps(ds_ts)\nds_ts_gap_fill\n\n\n\nWe then plot the original and gap-filled soil moisture dataset, zooming in on a two-month period to better highlight the gap-filling effect.\n\ntime_slice = slice('2000-06-01 00:00:00', '2000-08-01 00:00:00')\nds_ts.sm.sel(time=time_slice).plot(label=\"Original\")\nds_ts_gap_fill.sm.sel(time=time_slice).plot(label=\"Gap filling\", linestyle=\"dashed\")\nplt.legend()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling-along-the-time-axis","position":9},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap Filling in the Spatial Domain","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling-in-the-spatial-domain","position":10},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap Filling in the Spatial Domain","lvl2":"2. Gap filling of a raster dataset"},"content":"In this example, we utilize the low-pass gap-filling algorithm from \n\ngridtools (DOI \n\n10​.5281​/zenodo​.15062839). This method effectively applies a 2D low-pass filter to the data. As a demonstration, we select a single time slice and apply gap filling in the spatial domain using the aforementioned algorithm.\n\nsm_slice = ds.sm.sel(time='2000-07-01 12:00:00', method='nearest')\nsm_slice\n\n\n\nds_sub = ds.sel(time='2000-07-01 12:00:00', method='nearest')\nds_sub = ds_sub[[\"sm\"]]\nds_sub\n\n\n\nNext, we apply the toolbox’s gap-filling operation, which is highly efficient as it leverages Numba for parallel computation.\n\ngapfill_op = get_op('gapfill')\n\n\n\nds_filled = gapfill_op(ds_sub)\nds_filled.sm\n\n\n\nFinally, we plot the results for North Africa as an example to illustrate the gap-filling process.\n\nfig, ax = plt.subplots(1, 2, figsize=(20, 5))\nextent = dict(lat=slice(30, 10), lon=slice(-15, 35))\nds_sub.sm.sel(**extent).plot(ax=ax[0])\nds_filled.sm.sel(**extent).plot(ax=ax[1])\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling#gap-filling-in-the-spatial-domain","position":11},{"hierarchy":{"lvl1":""},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/esa-climate-toolbox/functions/country-data/readme","position":0},{"hierarchy":{"lvl1":""},"content":"Data file was taken from \n\nDownload vector maps.\n\nOriginal data is from \n\nNatural Earth.\n\nData was originally used in cate. This file has been slightly altered to create\na separate entry for “French Guyana”.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/esa-climate-toolbox/functions/country-data/readme","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#esa-cci-toolbox-finding-data","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data"},"content":"This notebook shows the usage of some covenience functions that have been setup to further facilitate the handling of the stores and the use of the ESA CCI Toolbox. A thorough description can be found here: \n\nhttps://​esa​-climate​-toolbox​.readthedocs​.io​/en​/latest​/api​_reference​.html​#datasets​-and​-datastores. To see how you can actually open data using these stores, see notebooks 2-5.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe functions provided here serve the purpose to get an overview about data and from which data store to get it from. They also serve to look for Essential Climate Variables. We may start by listing all that are provided by the ESA CCI Toolbox.\n\nfrom esa_climate_toolbox.core import list_ecvs\n\nlist_ecvs()\n\n\n\nNow that we see what the toolbox can offer, we can find datasets for one ecv, e.g., WATERVAPOUR.\n\nfrom esa_climate_toolbox.core import list_ecv_datasets\n\nlist_ecv_datasets(\"LC\")\n\n\n\nThe result consists of a list of tuples, where the first value is a data id and the second value the name of the store that provides access to the data. For information on how to access the stores specifically, using the xcube store framework, see notebooks 2 to 5. Here, we continue with listing all the stores that are registered in the system.\n\nfrom esa_climate_toolbox.core import list_stores\n\nlist_stores()\n\n\n\nYou will see default stores (and maybe some you have added yourself). You can also ask for a store by asking for a specific dataset id.\n\nfrom esa_climate_toolbox.core import find_data_store\n\nfind_data_store(ds_id=\"esacci.WATERVAPOUR.mon.L3S.TCWV.multi-sensor.multi-platform.TCWV_land_05deg.3-2.r1\")\n\n\n\nThe result consists of the name of the store as well as the python object itself.\nWe could also get it by just asking for its name.\n\nfrom esa_climate_toolbox.core import get_store\n\nget_store(\"esa-cci\")\n\n\n\nWe can also ask for the data of a store:\n\nfrom esa_climate_toolbox.core import list_datasets\n\nlist_datasets(\"esa-cci-zarr\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#esa-cci-toolbox-finding-data","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Adding your own stores"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#adding-your-own-stores","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Adding your own stores"},"content":"You may also define your own stores. This can come in handy when you want to combine your own data with the data from the toolbox.\nYou may add store to locally hosted data like this:\n\nfrom esa_climate_toolbox.core import add_local_store\n\nadd_local_store(\n    root=\"/path/to/my/data/\",\n    store_id=\"my_real_local_store\",\n    includes=\"aero*.nc\",\n    read_only=True,    \n    persist=False\n)\n\n\n\nThe root specifies the path to the data that shall be served by the store. The store_id defines by which name the store is registered in the system. With includes you can specify a pattern to determine what data shall be served, read_only causes that the store does not permit write operations, and if you would set persist to true, the store will be saved and available in your next session.\nOf course, we can always also remove a store. Don’t worry, this only deletes the registry entry. No real data is deleted.\n\nfrom esa_climate_toolbox.core import remove_store\n\nremove_store(\"my_real_local_store\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#adding-your-own-stores","position":5},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Writing data to stores"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#writing-data-to-stores","position":6},{"hierarchy":{"lvl1":"ESA CCI Toolbox Finding Data","lvl2":"Writing data to stores"},"content":"When you have created a new dataset, you might want to save it somewhere. For that, you can use this command:\n\nfrom esa_climate_toolbox.core import write_data\n\n# write_data(data, store_id=\"my_real_local_store\")\n\n\n\nWe leave this open for now, as we don’t want to actually write data now. Note that to write data, you need to define a store and make sure it is not read_only (see above). If you know you want your output in the same place, you can set a default output store:\n\nfrom esa_climate_toolbox.core import set_output_store\n\nadd_local_store(\n    root=\"/path/to/my/data/\",\n    store_id=\"my_real_local_store\",\n    includes=\"aero*.nc\",\n    read_only=True,    \n    persist=False\n)\nset_output_store(\"my_real_local_store\")\n\n\n\nLet’s check this is really the output store:\n\nfrom esa_climate_toolbox.core import get_output_store_id\n\nget_output_store_id()\n\n\n\nGreat! You are set to use these functions for making use of the toolbox. See the other notebooks to find out how to open datasets and use operations. Also, see the API for more detailed information on the functions described here: \n\nhttps://​esa​-climate​-toolbox​.readthedocs​.io​/en​/latest​/api​_reference​.html​#datasets​-and​-datastores.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-finding-data#writing-data-to-stores","position":7},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf","position":0},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf","position":1},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#accessing-obs4mips-and-cmip-data-via-esgf","position":2},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF"},"content":"This notebook demonstrates how to access CMIP6 and Obs4MIPs data using the \n\nintake-esgf package.\n\nTo run this notebook, you’ll need to install intake-esgf. You can install it using the following command:conda install -c conda-forge intake-esgf\n\nAlternatively, you can follow the \n\nofficial documentation for more installation details and usage instructions.\n\nimport intake_esgf\n\n\n\nThe catalog can be configured by following the instructions outlined in the \n\nintake-esgf configuration documentation. This allows you to set up indices that provide access to specific datasets.\n\nFor instance, the following example demonstrates how to access the Lawrence Livermore National Laboratory (LLNL) Solr index, which supports a wide range of ESGF datasets. By configuring the index in this way, you can easily query and retrieve the data you need from the ESGF network.\n\nRefer to the \n\nconfiguration guide for more details on setting up additional data sources or modifying the existing configuration to suit your needs.\n\nintake_esgf.conf.set(indices={\"esgf-node.llnl.gov\":True})\n\n\n\nThe following cell shows which projects are supported.\n\nintake_esgf.supported_projects()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#accessing-obs4mips-and-cmip-data-via-esgf","position":3},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access CMIP Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#access-cmip-data","position":4},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access CMIP Data"},"content":"In this section, we show how to access the ‘temperature at surface’ (tas) dataset from CMIP6 (Coupled Model Intercomparison Project). CMIP6 provides various climate model simulations, including tas data for different time periods and scenarios.\n\ncat = intake_esgf.ESGFCatalog()\n\n\n\nWe can query datasets using the search method, as demonstrated in the cell below.\n\ncat.search(\n    project=\"CMIP6\",\n    variable_id=\"tas\",\n    experiment_id=\"historical\",\n    source_id=\"CanESM5\",\n    member_id=\"r1i1p1f1\",\n    table_id=\"Amon\",\n)\n\n\n\n\n\nUsing the to_dataset_dict method, we can load the selected data into a dictionary, with each value containing an xarray.Dataset.\n\ndsd = cat.to_dataset_dict()\n\n\n\n\n\ndsd[\"tas\"]\n\n\n\nIn the following cell, we calculate the mean temperature over time, convert it to degrees Celsius, and plot the global surface temperature variable.\n\nds_plot = dsd[\"tas\"][\"tas\"].mean(dim=\"time\") - 273.15\nds_plot.plot(cmap=\"bwr\", vmin=-40, vmax=40)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#access-cmip-data","position":5},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access obs4MIPS"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#access-obs4mips","position":6},{"hierarchy":{"lvl1":"Accessing Obs4MIPs and CMIP Data via ESGF","lvl2":"Access obs4MIPS"},"content":"In this section, we show how to access the ‘temperature at surface’ (tas) dataset from obs4MIPS (Observations for Model Intercomparison Projects). obs4MIPS is a project that provides observational datasets for comparison with climate model outputs.\n\nWe first use the search method to get the desired dataset.\n\ncat.search(\n    project=\"obs4MIPs\",\n    institution_id=\"ECMWF\",\n    variable_id=\"tas\",\n)\n\n\n\n\n\nWe load the search results into a dictionary and extract the xarray.Dataset containing the data in the subsequent cell.\n\ndsd = cat.to_dataset_dict()\n\n\n\ndsd[\"tas\"]\n\n\n\nIn the following cell, we calculate the mean temperature over time, convert it to degrees Celsius, and plot the global surface temperature variable.\n\nds_plot = dsd[\"tas\"][\"tas\"].mean(dim=\"time\") - 273.15  \nds_plot.plot(cmap=\"bwr\", vmin=-40, vmax=40)\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf#access-obs4mips","position":7},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#esa-cci-toolbox-data-tree-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access"},"content":"Some of the data from the Open Data Portal is provided through the Toolbox in the form of DataTrees. DataTrees are basically a collection of datasets, where each dataset may be accessed through an identifier. This structure is applied to all gridded data that is subdivided into regions. As each of these region-specific datasets is a standard dataset, all toolbox operations can be applied to them.\n\nThis notebook shall serve to show what CCI datasets are concerned and how they can be opened.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nWe start, as usual, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nWe list the available data types of the store to make sure ‘datatree’ is included in the list.\n\ncci_store.get_data_types()\n\n\n\nAs datatrees are provided, we can ask which datasets are actually provided in this form.\n\nlist(cci_store.get_data_ids(data_type=\"datatree\"))\n\n\n\nSo, datatrees are provided for three ECVs: FIRE, LC, and VEGETATION. To fully show the use of datatrees, we will open FIRE and VEGETATION data.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#esa-cci-toolbox-data-tree-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening FIRE Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#opening-fire-data","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening FIRE Data"},"content":"\n\nWe start with opening one of the FIRE datasets.\n\nfire_dataset = \"esacci.FIRE.mon.L3S.BA.MODIS.Terra.MODIS_TERRA.v5-1.pixel\"\n\n\n\nAs first step, we have a look at the potential opener parameters.\n\ncci_store.get_open_data_params_schema(fire_dataset)\n\n\n\nOne entry that we don’t see when opening datasets of other type is the property place_names. If we extend this, we see a listing of Areas 1 to 6. Each of these identifiers stands for a different area. We can either open the data tree with all areas or pass a subset of this list as a parameter to only retrieve the area we are interested in. This will also increase performance.\n\nplaces = [\"AREA_1\"]\n\n\n\nfire_dt = cci_store.open_data(\n    fire_dataset,\n    place_names=places\n)\nfire_dt\n\n\n\nWe can see which datasets are available by asking for its keys.\n\nlist(fire_dt.keys())\n\n\n\nAs expected, it is the place(s) we had requested. We can now retrieve a dataset from any of the keys.\n\nds = fire_dt.get(places[0]).to_dataset()\nds\n\n\n\nAnd, of course, we can open and plot any of the data variables:\n\nds.CL.isel({\"time\": -6, \"x\": slice(25500, 26500), \"y\": slice(13500, 14500)}).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#opening-fire-data","position":5},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening VEGETATION Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#opening-vegetation-data","position":6},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Tree Access","lvl2":"Opening VEGETATION Data"},"content":"\n\nWe continue by opening a VEGETATION data set. What’s particular about this dataset is that it offers a lot of different sites, as becomes apparent from looking at the places in the schema properties\n\nvegetation_ds = \"esacci.VEGETATION.5-days.L3S.VP_PRODUCTS.VEGETATION.SPOT-5.MERGED.v1-0.r1\"\n\n\n\ncci_store.get_open_data_params_schema(vegetation_ds)\n\n\n\nWe can pick any of those sites and use them to open the data tree.\n\nplaces = [\"site_00001_ABRACOS_HILL\", \"site_00021_BASKIN\"]\n\n\n\nabracos = cci_store.open_data(\n    vegetation_ds,\n    place_names=places\n)\nabracos\n\n\n\nAgain, we see check that the correct places are provided.\n\nlist(abracos.keys())\n\n\n\nWe now open one of these datasets.\n\nds = abracos.get(places[0]).to_dataset()\nds\n\n\n\nWe see that this dataset has only a small extent spatially, but provides a long time series, so we do not plot an area, but pick the time series for one of the grid cells.\n\nds.LAI.isel(lat=1, lon=1).plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees#opening-vegetation-data","position":7},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-general-data-access","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-general-data-access","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-general-data-access#esa-cci-toolbox-data-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access"},"content":"The aim of this notebook is to show how to query for all the data sets provided by the ESA CCI Toolbox.\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe ESA CCI Toolbox is based on xcube. It provides dedicated stores to access data from the ESA Open Data Portal (ODP). To access the store, we can use the following import.\n\nfrom xcube.core.store import new_data_store\n\n\n\nNow we can acces the ESA Open Data Portal store. We may request it by ‘esa-cci’.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nWe can check what types of data it provides.\n\ncci_store.get_data_types()\n\n\n\nAll provided data are datasets. So, let’s have a look what data sets are available.\n\ndatasets = cci_store.get_data_ids()\nlist(datasets)\n\n\n\nThis might have been a bit much. In case you are looking for particular data sets, you can search for them. You can list which search options are available:\n\ncci_store.get_search_params_schema()\n\n\n\nThe parameters are listed under properties. start_date, end_date and bbox are standard search parameters that are also used by other stores. cci_attrs lists additional parameters that are specific for the cci store (again, listed under properties). Of these, let’s use ecv and frequency.\n\ncci_attrs = dict(\n    ecv='AEROSOL', \n    frequency='month'\n)\n\n[descriptor.data_id for descriptor in cci_store.search_data(cci_attrs=cci_attrs)]\n\n\n\n‘esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1’ sounds interesting. Let’s get more information about that one.\n\ncci_store.describe_data('esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid')\n\n\n\nFinally, we can have a look at which openers are provided by this store.\n\ncci_store.get_data_opener_ids()\n\n\n\nHere is how you can view which parameters can be used when you want to open a particular dataset (both parameters are optional).\n\ncci_store.get_open_data_params_schema(data_id='esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid', opener_id='dataset:zarr:cciodp')\n\n\n\nGreat! Now we are all set to open some cubes.\n\nds = cci_store.open_data(data_id='esacci.FIRE.mon.L4.BA.MODIS.Terra.MODIS_TERRA.v5-1.grid', opener_id='dataset:zarr:cciodp')\nds\n\n\n\nds.isel(time=263).burned_area.plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-general-data-access#esa-cci-toolbox-data-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-data-access-with-subsets","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-data-access-with-subsets","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-data-access-with-subsets#esa-cci-toolbox-data-access-with-parameters","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Data Access with Parameters"},"content":"This notebook shows how to open data cubes from the ESA Open Data Portal for a given time range and region:\n\nA temporarily regular cube with aggregated CCI data that fall into equal-size time periods;\n\nWe start with necessary imports.\n\nfrom xcube.core.store import new_data_store\nimport IPython.display\nimport shapely\n\n\n\nNow we can create the store.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nFor this demo, we are using the dataset with the id ‘esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1’. Here is its metadata:\n\ncci_store.describe_data('esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1')\n\n\n\nWe are focussing on Africa, so we define a bounding box accordingly.\n\nx1 = -23.40  # degree\ny1 = -40.40  # degree\nx2 = 57.40  # degree\ny2 = 40.40  # degree\n\nbbox = (x1, y1, x2, y2)\n\n\n\nVisualize the bounding box. If you don’t see anything, please refer to \n\nEx0-DCFS-Setup.\n\nIPython.display.GeoJSON(shapely.geometry.box(*bbox).__geo_interface__)\n\n\n\nOur time range covers data from 1997: 1997-01-01 to 1997-12-01\n\n\n\nNow to open the dataset. You may check its metadata first to make sure that your parameters are valid.\n\ncci_store.get_open_data_params_schema(data_id='esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1', opener_id='dataset:zarr:cciodp')\n\n\n\nSelect any valid combination from the paramater in properties above. The only mandatory parameter is the data_id. If you leave any parameter out, all available values will be considered.\n\ncube = cci_store.open_data('esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1',\n                           variable_names=['absorbing_aerosol_index'],\n                           bbox=bbox,\n                           time_range=['2005-01-01', '2005-12-31'])\ncube\n\n\n\nWe may visualize the cube’s time coordinates:\n\ncube.time.diff(dim='time').plot.line()\n\n\n\nAnd finally, display the results:\n\ncube.absorbing_aerosol_index.sel(time='2005-04-15 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-data-access-with-subsets#esa-cci-toolbox-data-access-with-parameters","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data#esa-cci-toolbox-vector-data-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access"},"content":"The ESA CCI Toolbox also provides access to data that is not provided on a structured grid. This data is provided in the form of geopandas geodataframes rather than xarray datasets.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nFor this notebook, we start as before, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nThe data in question are AEROSOL, GHG, ICESHEETS, RIVER DISCHARGE (RD), SEAICE, and SEALEVEL datasets in satellite-orbit-frequency. Let’s search for ICESHEETS datasets.\n\ndescriptors = cci_store.search_data(\n    data_type=\"geodataframe\",\n    cci_attrs=dict(\n        ecv=\"ICESHEETS\"\n    )\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\nWe have a closer look at the first one.\n\ndescriptors[0]\n\n\n\nWe can now open the dataframe, just like we would open any other dataset. For dataframes, all data is read in immediately when displaying frame. As we want to avoid long waiting times, we ask for a temporal subset by applying a time range.\n\nicesheets_df = cci_store.open_data(\n    \"esacci.ICESHEETS.unspecified.Unspecified.CFL.multi-sensor.multi-platform.UNSPECIFIED.v3-0.greenland\",\n    time_range=(\"2014-10-01\", \"2014-10-15\")\n)\n\n\n\nNow we may view the actual frame.\n\nicesheets_df\n\n\n\nIf you now plot the dataframe, you will see that all loaded entries are included.\n\nicesheets_df.plot()\n\n\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data#esa-cci-toolbox-vector-data-access","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access","lvl2":"Reading River Discharge Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data#reading-river-discharge-data","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Access","lvl2":"Reading River Discharge Data"},"content":"\n\nWith River Discharge Data, there is a particularity, as it supports requesting by placenames. We can see this from the dataset’s descriptor.\n\ndescriptors = cci_store.search_data(\n    data_type=\"geodataframe\",\n    cci_attrs=dict(\n        ecv=\"RD\"\n    )\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\ndescriptors[0]\n\n\n\nUnder '‘open_params_schema/properties/place_names’ you can find a list of place names that you can ask for when opening the dataset. You can also omit the parameter if you wish to get the data for all rivers (this would take some time to load).\n\nghg_df = cci_store.open_data(\n    \"esacci.RD.satellite-orbit-frequency.L3S.WL.multi-sensor.multi-platform.MERGED.v1-1.r1\",\n    place_names=[\"GARONNE_GARONNE_LAMAGISTERE\", \"PO_PO_PIACENZA\"]\n)\nghg_df\n\n\n\nWe may now plot the data.\n\nghg_df.plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data#reading-river-discharge-data","position":5},{"hierarchy":{"lvl1":"Access to Zarr Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-zarr-access","position":0},{"hierarchy":{"lvl1":"Access to Zarr Data"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-zarr-access","position":1},{"hierarchy":{"lvl1":"Access to Zarr Data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-zarr-access#access-to-zarr-data","position":2},{"hierarchy":{"lvl1":"Access to Zarr Data"},"content":"Some datasets from the Open Data Portal have been migrated to the Zarr format. This allows for faster opening and processing, so it makes sense to check whether data is provided in the Zarr format first.\n\nThe data is available via store abbreviation ‘cci-zarr-store’.\n\nfrom xcube.core.store import new_data_store\n\n\n\nzarr_store = new_data_store('esa-cci-zarr')\n\n\n\nAgain, let’s see what data sets are available.\n\ndatasets = zarr_store.list_data_ids()\ndatasets\n\n\n\nlen(datasets)\n\n\n\nThe names are similar but different to the ones from the Climate Toolbox store.\nWe can have a look at a dataset’s metadata to find out more about it.\n\nzarr_store.describe_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\n\n\n\nCubes can easily be opened from the store like this:\n\ncube = zarr_store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\ncube\n\n\n\nSubsets of the data may easily be created like this:\n\nsub_cube = cube.sel({\n    'lat': slice(40.40, -40.40),\n    'lon': slice(-23.40, 57.40),\n    'time': slice('2000-01-01', '2000-12-31')\n    }\n)\nsub_cube\n\n\n\n... and we can plot the data.\n\nsub_cube.sm.sel(time='2000-07-01 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-zarr-access#access-to-zarr-data","position":3},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-kerchunk-access","position":0},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-kerchunk-access","position":1},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-kerchunk-access#access-to-data-in-netcdf-format-viewed-as-zarr","position":2},{"hierarchy":{"lvl1":"Access to Data in NetCDF format viewed as Zarr"},"content":"Some datasets offered by the Open Data Portal are provided via\n\n\nreferences format\nas specified by the \n\nkerchunk\npackage. This allows accessing to the original NetCDF data files with\nan I/O performance comparable to \n\nZarr.\n\nThe data is available via store identifier ‘cci-kerchunk-store’.\n\nfrom xcube.core.store import new_data_store\n\n\n\nkerchunk_store = new_data_store('esa-cci-kc')\n\n\n\nAgain, let’s see what data sets are available.\n\ndatasets = kerchunk_store.list_data_ids()\ndatasets\n\n\n\nThe names are similar but different to the ones from the Climate Toolbox store.\nWe can have a look at a dataset’s metadata to find out more about it.\n\nkerchunk_store.describe_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-19781101-20211231-fv07.1-kr1.1')\n\n\n\nCubes can easily be opened from the store like this:\n\ncube = kerchunk_store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-19781101-20211231-fv07.1-kr1.1')\ncube\n\n\n\nSubsets of the data may easily be created like this:\n\nsub_cube = cube.sel({\n    'lat': slice(40.40, -40.40),\n    'lon': slice(-23.40, 57.40),\n    'time': slice('2000-01-01', '2000-12-31')\n    }\n)\nsub_cube\n\n\n\n... and we can plot the data.\n\nsub_cube.sm.sel(time='2000-07-01 12:00:00', method='nearest').plot.imshow(cmap='Greys_r', figsize=(8, 8))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-kerchunk-access#access-to-data-in-netcdf-format-viewed-as-zarr","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data-cubes","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data-cubes","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data-cubes#esa-cci-toolbox-vector-data-cube-access","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Vector Data Cube Access"},"content":"The ESA CCI Toolbox also provides access to data that is provided in the form of vector data cubes. These can be thought of as a hybrid between data cubes and vector data. It is a data cube where the spatial locations are not identified through a structured grid, but distinct geometries.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nFor this notebook, we start as before, by opening the standard esa-cci data store.\n\nfrom xcube.core.store import new_data_store\n\ncci_store = new_data_store('esa-cci')\n\n\n\nThe data in question are ICESHEETS and SEALEVEL datasets. We can find the vector data cubes by specifying their data type.\n\ndescriptors = cci_store.search_data(\n    data_type=\"vectordatacube\",\n)\n[descriptor.data_id for descriptor in descriptors]\n\n\n\nWe have a closer look at the first sea level dataset.\n\ndescriptors[4]\n\n\n\nNow, we can open the dataset to see what the vector data cube looks like.\n\nsl_ds = cci_store.open_data(\n    \"esacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.ASA\"\n)\n\nsl_ds\n\n\n\nWe see that the resulting dataset has a geometry coordinate which consists of single points. We may plot a variable which only has a single geometric dimension like this:\n\nimport geopandas as gpd\ngdf = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"local_sla_trend\"]].to_dataframe())\ngdf.plot(column=\"local_sla_trend\")\n\n\n\n\n\nWe may also plot variables which have values along the temporal dimension. We can do so like this:\n\ngdf2 = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"sla\", \"nbmonth\"]].to_dataframe())\ngdf2.xs(\"2019-09-16 00:00:00\", level=\"nbmonth\").plot(column=\"sla\")\n\n\n\n\n\nsl_ds = cci_store.open_data(\n    \"esacci.SEALEVEL.mon.IND.MSLTR.multi-sensor.multi-platform.MERGED.2-2.ASA\"\n)\ngdf = gpd.GeoDataFrame(sl_ds[[\"geometry\", \"local_sla_trend\"]].to_dataframe())\ngdf.plot(column=\"local_sla_trend\")\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-vector-data-cubes#esa-cci-toolbox-vector-data-cube-access","position":3},{"hierarchy":{"lvl1":"Access to WCS data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wcs-data","position":0},{"hierarchy":{"lvl1":"Access to WCS data"},"content":"The CEDA data server at \n\nhttps://​data​.cci​.ceda​.ac​.uk/ provides access via the OGC Web Coverage Service (WCS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WCS from the CEDA server, using \n\nOWSLib as the client.\n\nIf owslib is not already installed in the Python environment, uncomment the following cell to install it with mamba.\n\n# ! mamba install --yes owslib\n\n\n\nImport some required libraries, including OWSLib as the WCS client.\n\nfrom owslib.wcs import WebCoverageService\nimport xarray as xr\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\n%matplotlib inline\nimport matplotlib.pyplot as plt\n\n\n\nDefine a simple convenience class CciWcs to manage the web service.\n\nclass CciWcs:\n\n    def __init__(self, dataset_id: str):\n        self.service = WebCoverageService(\n            f\"https://data.cci.ceda.ac.uk/thredds/wcs/{dataset_id}?service=WCS&version=1.0.0\",\n            version=\"1.0.0\"\n        )\n        \n    def coverage(self, data_id: str, bbox: tuple[float]) -> xr.Dataset:\n        coverage = self.service.getCoverage(\n          identifier=data_id,\n          bbox=bbox,\n          format=\"NetCDF3\",\n          timeout=600\n        )\n        with open(\"coverage.nc\", \"wb\") as fh:\n            fh.write(coverage.read())\n        return xr.open_dataset(\"coverage.nc\")\n\n\n\nList the available ECVs.\n\nlist_ecvs()\n\n\n\nList the available datasets for the Land Surface Temperature (LST) ECV.\n\nprint(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"LST\"))))\n\n\n\nSelect a dataset from the list and store its name in a variable for use in the following steps.\n\nds_id = \"esacci.LST.mon.L3S.LST.multi-sensor.multi-platform.IRCDR.2-00.DAY\"\n\n\n\nCreate a local representation of the WCS service for the selected dataset.\n\ncciwcs = CciWcs(ds_id)\n\n\n\nList the data variables available from this service.\n\nlist(cciwcs.service.contents.keys())\n\n\n\nSelect the lst variable from the list and store its name in a variable.\n\ndata_id = \"lst\"\n\n\n\nCheck the bounding box for the selected dataset and variable; we can see that it is of global extent.\n\ncciwcs.service.contents[data_id].boundingBoxWGS84\n\n\n\nFor a quick demonstration with a small amount of data, request a coverage for a small sub-region and return it as a xarray dataset.\n\nds = cciwcs.coverage(\n    data_id=\"lst\",\n    bbox=(9.7, 53.3, 10.3, 53.5)\n)\n\n\n\nShow some of the metadata for the returned coverage.\n\nds\n\n\n\nUse the coverage data to plot a map of land surface temperature for a specific point in time.\n\nds.lst.isel(time=100).plot.imshow()\n\n\n\nUse the coverage data to plot a graph of land surface temperature against time for a specific location.\n\nds.lst.sel(lat=53.4, lon=10.0, method=\"nearest\").plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wcs-data","position":1},{"hierarchy":{"lvl1":"Access to WMS data"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wms-data","position":0},{"hierarchy":{"lvl1":"Access to WMS data"},"content":"The CEDA data server at \n\nhttps://​data​.cci​.ceda​.ac​.uk/ provides access via the OGC Web Map Service (WMS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WMS from the CEDA server, using \n\nOWSLib as the client.\n\nIf owslib is not already installed in the Python environment, uncomment the following cell to install it with mamba.\n\n# ! mamba install --yes owslib\n\n\n\nImport some required libraries, including OWSLib as the WMS client.\n\nfrom owslib.wms import WebMapService\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\nfrom IPython.display import Image\n\n\n\nList the available ECVs.\n\nlist_ecvs()\n\n\n\nList the available datasets for the cloud ECV.\n\nprint(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"CLOUD\"))))\n\n\n\nSelect a dataset from the list and store its name in a variable for use in the following steps.\n\nds_id = \"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\"\n\n\n\nCreate a local representation of the WMS service for the selected dataset.\n\nwms_url = f\"https://data.cci.ceda.ac.uk/thredds/wms/{ds_id}?service=WMS&version=1.3.0\"\nwms = WebMapService(wms_url, version=\"1.3.0\", timeout=600)\n\n\n\nList the data variables available from this service.\n\nlist(wms.contents)\n\n\n\nSelect the iwp (ice water path) variable from the list and store its name in a variable.\n\ndata_id = \"iwp\"\n\n\n\nCheck the bounding box for the selected dataset and variable; we can see that it is of global extent.\n\nwms.contents[data_id].boundingBox\n\n\n\nCheck what times are available, filtering to the year 2011.\n\n[t for t in wms[data_id].timepositions if t.startswith(\"2011\")]\n\n\n\nRequest a map for the chosen dataset and variable from the WMS server, selecting a time from the list above and a bounding box covering latitudes from 80°S to 50°N, then display the map in the notebook.\n\nresponse = wms.getmap(\n    layers=[\"iwp\"],\n    styles=[\"boxfill/rainbow\"],\n    size=[800, 600],\n    srs=\"EPSG:4326\",\n    bbox=[-180.0, -80.0, 180.0, 50.0],\n    format=\"image/png\",\n    time=\"2011-12-01T00:00:00.000Z\"\n)\n\nImage(response.read())\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wms-data","position":1},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-using-xcube-viewer","position":0},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-using-xcube-viewer","position":1},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-using-xcube-viewer#using-the-esa-cci-toolbox-with-the-xcube-viewer","position":2},{"hierarchy":{"lvl1":"Using the ESA CCI Toolbox with the xcube Viewer"},"content":"The xcube viewer is an easy way to display gridded data. In this notebook, we show how the viewer can be started from a notebook and how cci datasets can be added to it.\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe viewer requires datasets. For this notebook, we will access them from the Zarr store and the regular store.\n\nfrom xcube.core.store import new_data_store\n\nzarr_store = new_data_store('esa-cci-zarr')\ncci_store = new_data_store('esa-cci')\n\n\n\nIf you want, you can execute the following lines to see which datasets are available. For now, this part is in a comment as we do not want to print all the datasets for reasons of readability.\n\n# zarr_store.list_data_ids()\n\n\n\n# cci_store.list_data_ids()\n\n\n\nFrom the Zarr store, we pick a snow dataset.\n\nsnow_ds = zarr_store.open_data('ESACCI-L3C_SNOW-SWE-1979-2020-fv2.0.zarr')\nsnow_ds\n\n\n\nFrom the cci store, we pick an aerosol dataset. However, let’s just use a subset here, to see how it will look in the viewer.\n\nx1 = -23.40  # degree\ny1 = -40.40  # degree\nx2 = 57.40  # degree\ny2 = 40.40  # degree\nbbox = (x1, y1, x2, y2)\n\naerosol_ds = cci_store.open_data(\n    'esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1',\n    variable_names=['absorbing_aerosol_index'],\n    bbox=bbox,\n    time_range=['2005-01-01', '2005-12-31']\n)\naerosol_ds\n\n\n\nNow that we have the datasets assembled, we can start the viewer. We import it from xcube like this:\n\nfrom xcube.webapi.viewer import Viewer\n\n\n\nviewer = Viewer()\n\n\n\nNext, we add the datasets.\n\nviewer.add_dataset(snow_ds)\n\n\n\nviewer.add_dataset(aerosol_ds)\n\n\n\nNow that the viewer is set up, we can ask for information about it. With the following command, we get the links for the server and the viewer. The server is responsible for serving the datasets. You may take the link and use it with any running viewer. However, it is directly plugged into the viewer instance which you can open from its link.\n\nviewer.info()\n\n\n\nAlternatively, you can open the viewer in a notebook cell:\n\nviewer.show()\n\n\n\n... and there you go. You can learn more about the usage of the viewer here: \n\nhttps://​xcube​.readthedocs​.io​/en​/latest​/viewer​.html . You may add any datasets, but not geodataframes or vector data cubes. To keep the viewer usable, we advise against adding too many or too large datasets.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-using-xcube-viewer#using-the-esa-cci-toolbox-with-the-xcube-viewer","position":3},{"hierarchy":{"lvl1":"Failure reporting in the ESA Climate Toolbox"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-failure-reporting","position":0},{"hierarchy":{"lvl1":"Failure reporting in the ESA Climate Toolbox"},"content":"The ESA Climate Toolbox provides a mechanism whereby unrecoverable failures can be reported automatically to an external server. The user must explicitly consent to this data sharing before it can be activated.\n\nThis notebook demonstrates the mechanism by setting up a simple local reporting server, which receives failure reports and writes them to a file. The notebook then activates automated failure reporting and deliberately raises an error from the toolbox. Finally, the server’s log file is shown to demonstrate that the report was received and logged.\n\nImport some necessary classes and modules, including the FailureReporter class.\n\nimport datetime\nimport json\nimport pathlib\nfrom http.server import BaseHTTPRequestHandler\nfrom http.server import HTTPServer\nimport multiprocessing\nfrom esa_climate_toolbox.util.reporting import FailureReporter\n\n\n\nDefine a minimal server which will receive failure reports, and start it in the background.\n\nlog_path = pathlib.Path(\"server-log.txt\")\n\nclass ReportRequestHandler(BaseHTTPRequestHandler):\n\n    def do_POST(self):\n        self.send_response(200)\n        self.send_header(\"Content-Type\", \"text/plain\")\n        self.end_headers()\n        content_length = int(self.headers.get(\"Content-Length\", 0))\n        content = self.rfile.read(content_length).decode(\"utf-8\")\n        data = json.loads(content)\n        with open(log_path, \"a\") as fh:\n            fh.write(datetime.datetime.now(datetime.UTC).isoformat() + \"\\n\")\n            for k, v in data.items():\n                fh.write(k + \":\\n\")\n                fh.write(\"\\n\".join(v) if isinstance(v, list) else str(v) + \"\\n\")\n            fh.write(\"\\n\")\n        self.wfile.write(\"OK\".encode(\"utf-8\"))\n\nserver = HTTPServer((\"127.0.0.1\", 9898), ReportRequestHandler)\n\ndef start_server():\n    server.serve_forever()\n\nlog_path.unlink(missing_ok=True)\nprocess = multiprocessing.Process(target=start_server)\nprocess.start()\n\n\n\nCreate and activate a FailureReporter, which will automatically detect and report any unhandled exceptions involving the ESA Climate Toolbox. The URL of the server which receives the reports can be passed as a parameter or using the environment variable ESA_CLIMATE_TOOLBOX_FAILURE_REPORTING_SERVER_URL. The user is asked for their explicit consent before the reporter is activated.\n\nreporter = FailureReporter(\"http://localhost:9898\")\nreporter.activate()\n\n\n\n\n\n\n\nNow test the functionality. The FailureReporter class provides a method called raise_error to deliberately trigger an error within the toolbox code for testing purposes.\n\nFailureReporter.raise_error()\n\n\n\n\n\nFor comparison, trigger an exception not involving the climate toolbox. This will still be reported in the notebook, but will not be reported to the server.\n\n1 / 0\n\n\n\nShow the contents of the server’s log file. Note that the exception from the climate toolbox is logged, but the other exception is not.\n\nwith open(log_path, \"r\") as fh:\n    for line in fh.readlines():\n        print(line, end=\"\")\n\n\n\nShut down the server.\n\nprocess.kill()\nserver.socket.close()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-failure-reporting","position":1},{"hierarchy":{"lvl1":"Performance tests"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-performance","position":0},{"hierarchy":{"lvl1":"Performance tests"},"content":"This notebook makes some time measurements of climate toolbox operations.\n\nImport some necessary libraries.\n\nimport xarray as xr\nfrom xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom esa_climate_toolbox.core import find_data_store, get_store, list_datasets\n%matplotlib inline\nimport matplotlib.pyplot as plt\n\n\n\nSelect a suitable dataset of global extent for the tests.\n\ndsname = \"esacci.LST.yr.L3C.LST.multi-sensor.multi-platform.SSMI_SSMIS.v2-33.ASC\"\n\n\n\nFind the store that contains the dataset.\n\nstore_name, store = find_data_store(ds_id=dsname)\n\n\n\nCheck the accepted parameters for opening this dataset.\n\nstore.get_open_data_params_schema(dsname)\n\n\n\nOpen a dataset for the full global extent and the year 2020, containing the variables lst and lst_uncertainty.\n\nds = store.open_data(\n    dsname,\n    variable_names=[\"lst\", \"lst_uncertainty\"],\n    time_range=[\"2020-01-01\", \"2020-12-31\"],\n    bbox=[-180, -90, 180, 90]\n)\n\n\n\nShow the dataset’s metadata.\n\nds\n\n\n\nFor demonstration and testing purposes, resample the dataset to a higher resolution, corresponding to a cell size of slightly under 10 × 10 km at the equator. (Longitudinal resolution increases with increasing latitude.)\n\nsource_gm = GridMapping.from_dataset(ds)\n\n\n\ntarget_gm = source_gm.scale(3)\n\n\n\nds_resampled = resample_in_space(ds, source_gm=source_gm, target_gm=target_gm)\n\n\n\nds_resampled\n\n\n\nWrite the dataset to a Zarr archive in local storage, in the same directory as this notebook.\n\nzarr_path = \"lst-global-10km.zarr\"\nds_resampled.to_zarr(zarr_path, mode=\"w\")\n\n\n\nMeasure and display the time required to ingest the data from Zarr into an xarray dataset.\n\n%%time\nds_zarr = xr.open_zarr(zarr_path)\n\n\n\nMeasure and display the time required to apply a dummy algorithm (doubling all values) to the ingested dataset.\n\n%%time\nds_processed = ds_zarr + ds_zarr\n\n\n\nMeasure and display the time required to plot the lst variable of the ingested and processed dataset.\n\n%%time\nds_processed.squeeze().lst.plot.imshow()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-performance","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme#esa-cci-toolbox-notebooks-setup","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup"},"content":"To run the Notebooks in this folder, you will need a Python environment\nwith the \n\nESA CCI Toolbox\ninstalled.\nFor creating such an environment follow the instructions given in the\n\n\nREADME.\n\nBefore using Jupyter Lab for the first time install the jupyterlab,\njupyterlab-geojson, and ipywidgets package.(ect) conda install -c conda-forge jupyterlab jupyterlab-geojson ipywidgets","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme#esa-cci-toolbox-notebooks-setup","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup","lvl2":"Running Jupyter Lab"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme#running-jupyter-lab","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Notebooks Setup","lvl2":"Running Jupyter Lab"},"content":"Start Jupyter Lab:(ect) $ jupyter-lab","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/readme#running-jupyter-lab","position":5},{"hierarchy":{"lvl1":"Finding Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-finding-operations","position":0},{"hierarchy":{"lvl1":"Finding Operations"},"content":"This notebook serves to show how operations can be detected and how information about these operations can be shown.\n\nfrom IPython.display import JSON\n\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.core import list_operations\n\n\n\nOperations of the ESA Climate Toolbox can be listed by calling the list_operations command.\n\nlist_operations()\n\n\n\nTo get information about the required input parameters, you can ask for an operation’s meta info and see its inputs. Under outputs, you will find what you will get from applying the operation.\n\nJSON(get_op_meta_info('coregister'))\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-finding-operations","position":1},{"hierarchy":{"lvl1":"Usage of Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations","position":0},{"hierarchy":{"lvl1":"Usage of Operations"},"content":"This notebook serves to show how operations provided by the toolbox can be applied.\nFor this purpose, the following aspects are covered:\n\nAccess to ESA CCI Ozone and Cloud data (Atmosphere Mole Content of Ozone and Cloud Cover)\n\nGeometric adjustments (coregistration)\n\nSpatial (point, polygon) and temporal subsetting\n\nVisualisation of time series\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations","position":1},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Ingest data and create datasets"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#ingest-data-and-create-datasets","position":2},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Ingest data and create datasets"},"content":"\n\nfrom IPython.display import JSON\n\nfrom xcube.core.store import new_data_store\n\nimport esa_climate_toolbox.ops as ops\n\nfrom esa_climate_toolbox.core import get_op\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.util.monitor import ConsoleMonitor\n\n\n\nFirst, read in the ESA Climate Data Centre Data Store.\n\ndata_store = new_data_store('esa-climate-data-centre')\n\n\n\nOpen an ozone dataset (see Notebook 1-ECT_General_Data_Access to find which options you have).\n\nozone_ds = data_store.open_data('esacci.OZONE.mon.L3.NP.multi-sensor.multi-platform.MERGED.fv0002.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\nozone_ds\n\n\n\nOpen a cloud dataset next.\n\ncloud_ds = data_store.open_data('esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\ncloud_ds\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#ingest-data-and-create-datasets","position":3},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Filter datasets to select the desired variables"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#filter-datasets-to-select-the-desired-variables","position":4},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Filter datasets to select the desired variables"},"content":"\n\nThe datasets are rather large, so we opt to make datasets that have only the variable we are interested in. The select_var op may be used for that.\n\nJSON(get_op_meta_info('select_var'))\n\n\n\nsvar_op = get_op('select_var')\n\n\n\nWe choose the variable cfc (cloud area fraction) from the cloud dataset ...\n\ncfc_ds = svar_op(ds=cloud_ds, var='cfc')\ncfc_ds\n\n\n\n... and O3_du_tot (the atmosphere mole content of ozone) from the ozone dataset.\n\nozone_tot_ds = svar_op(ds=ozone_ds, var='O3_du_tot')\nozone_tot_ds\n\n\n\nPlot the first time slices of the datasets\n\n%matplotlib inline\n\ncfc_ds.cfc.isel(time=0).plot()\n\n\n\nozone_tot_ds.O3_du_tot.isel(time=0).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#filter-datasets-to-select-the-desired-variables","position":5},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Co-register datasets by resampling"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#co-register-datasets-by-resampling","position":6},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Co-register datasets by resampling"},"content":"\n\nWe see that though both datasets are global, they are in different spatial resolutions:\n\nprint(cfc_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)\n\n\n\nTo bring them to the same resolution, we use the coregister function.\n\nJSON(get_op_meta_info('coregister'))\n\n\n\ncoregister_op = get_op('coregister')\n\n\n\nWe get the cloud dataset to the resolution of the ozone dataset.\n\ncfc_res_ds = coregister_op(ozone_tot_ds, cfc_ds)\n\n\n\nCheck the variable shapes again to see we were successful:\n\nprint(cfc_res_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)\n\n\n\nAnd plot again:\n\ncfc_res_ds.cfc.isel(time=0).plot()\n\n\n\nimport matplotlib.pyplot as plt\n\nfig, axes = plt.subplots(1, 2, figsize=(10, 4))\ncfc_res_ds.cfc.isel(time=0).plot(ax=axes[0])\naxes[0].set_title(\"Cloud Fraction\")\nozone_tot_ds.O3_du_tot.isel(time=0).plot(ax=axes[1])\naxes[1].set_title(\"Ozone Content\")\nplt.tight_layout()\nplt.show()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#co-register-datasets-by-resampling","position":7},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired spatial region"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#select-the-desired-spatial-region","position":8},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired spatial region"},"content":"\n\nWe want to continue our analysis with a subset, say, Africa. For this we use subset_spatial.\n\nJSON(get_op_meta_info('subset_spatial'))\n\n\n\nsubset_spatial_op = get_op('subset_spatial')\n\n\n\nafrica = '-20.0, -40.0, 60.0, 40.0'\n# 'lon_min, lat_min, lon_max, lat_max'\ncfc_africa_res_ds = subset_spatial_op(cfc_res_ds, africa)\nozone_tot_africa_ds = subset_spatial_op(ozone_tot_ds, africa)\n\n\n\nThis is a good time to compare the plots of the resampled subset and the original plot to see the effects of our work:\n\ncfc_africa_res_ds.cfc.isel(time=0).plot()\n\n\n\ncfc_ds.cfc.isel(time=0).sel({'lat': slice(-40, 40), 'lon': slice(-20, 60)}).plot()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#select-the-desired-spatial-region","position":9},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired temporal region"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#select-the-desired-temporal-region","position":10},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Select the desired temporal region"},"content":"\n\nWe may also create a temporal subset:\n\nJSON(get_op_meta_info('subset_temporal'))\n\n\n\nsubset_temporal_op = get_op('subset_temporal')\n\n\n\ncfc_africa_res_janmar_ds = subset_temporal_op(cfc_africa_res_ds, '2007-01-01, 2007-03-31')\nozone_tot_africa_janmar_ds = subset_temporal_op(ozone_tot_africa_ds, '2007-01-01, 2007-12-31')\n\n\n\nprint(cfc_africa_res_janmar_ds.time)\n\n\n\nprint(ozone_tot_africa_janmar_ds.time)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#select-the-desired-temporal-region","position":11},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Retrieve and plot timeseries"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#retrieve-and-plot-timeseries","position":12},{"hierarchy":{"lvl1":"Usage of Operations","lvl2":"Retrieve and plot timeseries"},"content":"\n\nFinally, we can create time series from these datasets. Operation tseries_point can be used to get a time series for a given point, tseries_mean will get the mean and standard deviation across the dataset.\n\nJSON(get_op_meta_info('tseries_point'))\n\n\n\nJSON(get_op_meta_info('tseries_mean'))\n\n\n\ntseries_point_op = get_op('tseries_point')\ntseries_mean_op = get_op('tseries_mean')\n\n\n\nozone_ts_point = tseries_point_op(ozone_tot_africa_janmar_ds, point='50, 50')\ncfc_ts_point = tseries_point_op(cfc_africa_res_janmar_ds, point='50, 50')\nozone_ts_mean = tseries_mean_op(ozone_tot_africa_janmar_ds, var='O3_du_tot')\ncfc_ts_mean = tseries_mean_op(cfc_africa_res_janmar_ds, var='cfc')\n\n\n\nprint(ozone_ts_mean)\n\n\n\nprint(cfc_ts_mean)\n\n\n\ncfc_ts_mean.cfc_mean.plot()\n\n\n\nozone_ts_mean.O3_du_tot_mean.plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations#retrieve-and-plot-timeseries","position":13},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data","position":0},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data","position":1},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data#esa-cci-toolbox-reproject-dataset","position":2},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset"},"content":"The purpose of this notebook is to demonstrate how to access a dataset, resample it to different coordinates, and reproject it to a new coordinate reference system (CRS).\n\nTo run this Notebook, make sure the ESA CCI Toolbox is setup correctly.\n\nThe ESA CCI Toolbox is built on xcube, leveraging many of its functionalities in this notebook. For additional examples on resampling and reprojection, visit the \n\nxcube GitHub repository.\n\nfrom xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom xcube.core.store import new_data_store\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data#esa-cci-toolbox-reproject-dataset","position":3},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset","lvl2":"Reproject Dataset from ESA Open Data Portal"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data#reproject-dataset-from-esa-open-data-portal","position":4},{"hierarchy":{"lvl1":"ESA CCI Toolbox Reproject Dataset","lvl2":"Reproject Dataset from ESA Open Data Portal"},"content":"\n\nTo access datasets from the ESA Open Data Portal store, we begin by initializing a new data store using the store ID ‘esa-cci’.\n\ncci_store = new_data_store('esa-cci')\n\n\n\nAll provided data are datasets. So, let’s have a look what data sets are available.\n\ndatasets = cci_store.list_data_ids()\ndatasets\n\n\n\nWe would like to reproject Aerosol CCI product. But first we view the available opening parameters for the respective dataset.\n\ncci_store.get_open_data_params_schema(\n    data_id=\"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\"    \n)\n\n\n\nNow we can open the dataset and select a subset which covers Europe and the last half year of the data.\n\nds = cci_store.open_data(\n    \"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\",\n    time_range=[\"2015-07-01\", \"2015-12-31\"],\n    bbox=[0, 45, 20, 60]\n)\nds\n\n\n\nWe can plot the absorbing aerosol index in the original projection before reprojecting it.\n\nds.absorbing_aerosol_index.isel(time=-1).plot()\n\n\n\nNow, we can reproject the dataset from the original Geographic Coordinate System (EPSG:4326 - WGS 84) to the European Terrestrial Reference System 1989 ensemble (EPSG:3035). To achieve this, we first create a grid mapping that defines the target projection, which is then used to reproject the dataset.\n\nsource_gm = GridMapping.from_dataset(ds)\ntemp_target_gm = source_gm.transform(\"EPSG:3035\", xy_res=10000)\ntarget_gm = temp_target_gm.to_regular()\ntarget_gm\n\n\n\nds_reproject = resample_in_space(\n    ds,\n    source_gm=source_gm,\n    target_gm=target_gm,\n)\nds_reproject\n\n\n\nFinally, we can plot the reprojected dataset.\n\nds_reproject.absorbing_aerosol_index.isel(time=-1).plot()\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data#reproject-dataset-from-esa-open-data-portal","position":5},{"hierarchy":{"lvl1":"Filter Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data","position":0},{"hierarchy":{"lvl1":"Filter Operations"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data","position":1},{"hierarchy":{"lvl1":"Filter Operations"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#filter-operations","position":2},{"hierarchy":{"lvl1":"Filter Operations"},"content":"In this section, we will demonstrate three filter operations on CCI ECV datasets:\n\nFiltering a dataset based on a specific flag value.\n\nFiltering, exploring, and propagating uncertainties that accompany the dataset.\n\nFiltering based on any data feature.\n\nAll of these filter operations are performed using the \n\nxarray.Dataset.where method, which is fully compatible with \n\nDask. This approach allows for on-demand filtering, performed chunk-by-chunk for efficiency.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#filter-operations","position":3},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"1. Filtering a datset for a given flag value"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-1-filtering-a-datset-for-a-given-flag-value","position":4},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"1. Filtering a datset for a given flag value"},"content":"We will show this filtering operation on a soil moisture dataset, which comes with a quality flag for its observational data.\n\nimport matplotlib.pyplot as plt\nfrom xcube.core.store import new_data_store\n\n\n\nWe can access the soil moisture dataset through the Zarr data store, as shown below:\n\nstore = new_data_store('esa-cci-zarr')\n\n\n\nds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds\n\n\n\nWe can filter the soil moisture data using the \"no_data_inconsistency_detected\" flag, which corresponds to a flag value of 0 in the flag data variable. This value can be verified by checking the attributes of the flag variable.\n\nfiltered_ds = ds.where(ds[\"flag\"] != 0)\nfiltered_ds\n\n\n\nWe can generate a comparison plot that illustrates both the unfiltered and filtered soil moisture at a single time step as an example.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=1)\nfiltered_ds.sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=1)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-1-filtering-a-datset-for-a-given-flag-value","position":5},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"2. Filtering based on uncertainties that accompany a dataset"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","position":6},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"2. Filtering based on uncertainties that accompany a dataset"},"content":"We will show this filtering operation on a biomass dataset, which carries uncertainty values for the above-ground biomass data in the \"abg_se\" (long name \"Above-ground biomass standard_error\") data variable.\n\nds = store.open_data('ESACCI-BIOMASS-L4-AGB-MERGED-100m-2010-2020-fv4.0.zarr')\nds\n\n\n\nSince the dataset is quite large, we have selected the Tropical Climate Zone (TCL) in Africa for analysis. This region is known for its high biological activity and consequently high values of above-ground biomass.\n\nIt’s important to note that the filtering method works efficiently on the full dataset. This is because the xarray.Dataset.where operation is performed on demand, either when writing or plotting the data. However, without selecting a smaller subset like the TCL Zone, performance issues will arise during plotting.\n\nds = ds.sel(lat=slice(10, -10), lon=slice(10, 40))\nds\n\n\n\nWhere filter the dataset for standard error smaller than 100 Mg/ha.\n\nfiltered_ds = ds.where(ds[\"agb_se\"] <= 100)\nfiltered_ds\n\n\n\nWe can generate a comparison plot that illustrates both the unfiltered and filtered above-ground biomass at a single time step as an example. Also here we downsample the dataset for the plotting.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[0], vmin=0, vmax=500)\nfiltered_ds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[1], vmin=0, vmax=500)\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","position":7},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"3. Filtering by any data feature"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-3-filtering-by-any-data-feature","position":8},{"hierarchy":{"lvl1":"Filter Operations","lvl2":"3. Filtering by any data feature"},"content":"We will show this filtering operation on the soil moisture dataset, which also has other data variables which can be used for filtering.\n\nds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds\n\n\n\nFor example, we can use the data variable \"mode\", which indicates whether the observation is derived from the ascending or descending orbit. This variable can be used to filter the dataset, allowing us to select only the ascending mode, represented by 1, and the descending mode, represented by 2, and  as shown below:\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.7)\nds.where(ds[\"mode\"] == 2).sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.7)\n\n\n\nWe can easliy generate the same plot for the soil moisture uncertainty data variable.\n\nfig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm_uncertainty.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.07)\nds.where(ds[\"mode\"] == 2).sm_uncertainty.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.07)\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data#id-3-filtering-by-any-data-feature","position":9},{"hierarchy":{"lvl1":"Gap Filling"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling","position":0},{"hierarchy":{"lvl1":"Gap Filling"},"content":"","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling","position":1},{"hierarchy":{"lvl1":"Gap Filling"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling","position":2},{"hierarchy":{"lvl1":"Gap Filling"},"content":"This notebook will show some algorithms to fill gaps of vector data and raster data. The notebook is structured as follows:\n\nGap Filling of a vector dataset in spatial domain\n\nGap filling of a raster dataset in temporal and spatial domain\n\nfrom esa_climate_toolbox.core import get_op\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport numpy as np\nimport scipy.interpolate as interp\nimport xarray as xr\nfrom xcube.core.store import new_data_store\n\n\n\nTo get access to the data, we will initiate the ESA CCI Zarr store in the following cell.\n\nstore = new_data_store('esa-cci-zarr')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling","position":3},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"1. Gap Filling of a Vector Dataset in the Spatial Domain"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#id-1-gap-filling-of-a-vector-dataset-in-the-spatial-domain","position":4},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"1. Gap Filling of a Vector Dataset in the Spatial Domain"},"content":"In this example, we will work with trend data of the Greenland ice sheet, which is provided as a set of spatial points over a given time range. We will apply several interpolation algorithms to fill the gaps between these points, ultimately converting the data into a raster format.\n\nFirst we will open the data as usual.\n\nds = store.open_data(\"ESACCI-ICESHEETS_Greenland_GMB-2003-2016-v1.1.zarr\")\nds\n\n\n\nWe define the final coordiates of the resired target raster and extract one time slice from the data set.\n\nlon = np.arange(-73., -12., 0.02)\nlat = np.arange(83., 59., -0.02)\ngrid_lon, grid_lat = np.meshgrid(lon, lat)\nGMB_trend_slice = ds.GMB_trend.isel(time=0)\n\n\n\nNow we can perform a 2D linear interpolation using scipy.interpolate.griddata.\n\ngridded_data = interp.griddata(\n    (ds.longitude, ds.latitude),\n    GMB_trend_slice, \n    (grid_lon, grid_lat), \n    method='linear'\n)\nds_linear = xr.Dataset(\n    {'GMB_trend_slice': (['lat', 'lon'], gridded_data)},\n    coords={'lon': lon, 'lat': lat}\n)\nds_linear\n\n\n\nThe same approach can be applied using \"cubic\" as the interpolation method.\n\ngridded_data = interp.griddata(\n    (ds.longitude, ds.latitude),\n    GMB_trend_slice, \n    (grid_lon, grid_lat), \n    method=\"cubic\"\n)\nds_cubic = xr.Dataset(\n    {'GMB_trend_slice': (['lat', 'lon'], gridded_data)},\n    coords={'lon': lon, 'lat': lat}\n)\nds_cubic\n\n\n\nNow, we can plot the results: the left plot shows the original points from the ESA CCI ice sheet trend dataset, the center plot displays the linear interpolation, and the right plot presents the cubic interpolation.\n\nfig, ax = plt.subplots(1, 3, figsize=(20, 6))\nscatter = ax[0].scatter(\n    ds.longitude, ds.latitude, c=GMB_trend_slice, cmap='seismic', vmin=-500, vmax=500, s=30\n)\nax[0].set_title('Scatter Plot of Values on 2D Grid')\nax[0].set_ylabel('lat')\nax[0].set_xlabel('lon')\nfig.colorbar(scatter, ax=ax[0], orientation='vertical')\nds_linear.GMB_trend_slice.plot(ax=ax[1], vmin=-500, vmax=500, cmap='seismic')\nax[1].set_title('Linear interpolation')\nds_cubic.GMB_trend_slice.plot(ax=ax[2], vmin=-500, vmax=500, cmap='seismic')\nax[2].set_title('Cubic interpolation')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#id-1-gap-filling-of-a-vector-dataset-in-the-spatial-domain","position":5},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#id-2-gap-filling-of-a-raster-dataset","position":6},{"hierarchy":{"lvl1":"Gap Filling","lvl2":"2. Gap filling of a raster dataset"},"content":"In this example, we will work with the soil moisture dataset, which is a 3d rastered dataset with gaps in it. We will show an example how to fill the gaps along the time axis for a time series and how to fill the pags in the 2d spatial domain.\n\nFirst we will open the data as usual.\n\nds = store.open_data('ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr')\nds\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#id-2-gap-filling-of-a-raster-dataset","position":7},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap filling along the time axis","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling-along-the-time-axis","position":8},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap filling along the time axis","lvl2":"2. Gap filling of a raster dataset"},"content":"For this, we create a small function that removes all NaN values and then performs interpolation to the original time axis using xarray.Dataset.interp().\n\ndef fill_temporal_gaps(ds, method=\"linear\"):\n    new_times = ds_ts.time\n    ds_nonans = ds_ts.dropna(dim=\"time\")\n    return ds_nonans.interp(time=new_times, method=method)\n\n\n\nWe will apply this gap-filling method to one year of the dataset as an example. To do this, we subset the dataset and select the year 2000.\n\nds_ts = ds.sel(lat=20, lon=20, method=\"nearest\")\nds_ts = ds_ts.sel(time=slice('2000-01-01 00:00:00', '2001-01-01 00:00:00'))\nds_ts\n\n\n\nNext, we apply the gap-filling method to the selected sample.\n\nds_ts_gap_fill = fill_temporal_gaps(ds_ts)\nds_ts_gap_fill\n\n\n\nWe then plot the original and gap-filled soil moisture dataset, zooming in on a two-month period to better highlight the gap-filling effect.\n\ntime_slice = slice('2000-06-01 00:00:00', '2000-08-01 00:00:00')\nds_ts.sm.sel(time=time_slice).plot(label=\"Original\")\nds_ts_gap_fill.sm.sel(time=time_slice).plot(label=\"Gap filling\", linestyle=\"dashed\")\nplt.legend()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling-along-the-time-axis","position":9},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap Filling in the Spatial Domain","lvl2":"2. Gap filling of a raster dataset"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling-in-the-spatial-domain","position":10},{"hierarchy":{"lvl1":"Gap Filling","lvl3":"Gap Filling in the Spatial Domain","lvl2":"2. Gap filling of a raster dataset"},"content":"In this example, we utilize the low-pass gap-filling algorithm from \n\ngridtools (DOI \n\n10​.5281​/zenodo​.15062839). This method effectively applies a 2D low-pass filter to the data. As a demonstration, we select a single time slice and apply gap filling in the spatial domain using the aforementioned algorithm.\n\nsm_slice = ds.sm.sel(time='2000-07-01 12:00:00', method='nearest')\nsm_slice\n\n\n\nds_sub = ds.sel(time='2000-07-01 12:00:00', method='nearest')\nds_sub = ds_sub[[\"sm\"]]\nds_sub\n\n\n\nNext, we apply the toolbox’s gap-filling operation, which is highly efficient as it leverages Numba for parallel computation.\n\ngapfill_op = get_op('gapfill')\n\n\n\nds_filled = gapfill_op(ds_sub)\nds_filled.sm\n\n\n\nFinally, we plot the results for North Africa as an example to illustrate the gap-filling process.\n\nfig, ax = plt.subplots(1, 2, figsize=(20, 5))\nextent = dict(lat=slice(30, 10), lon=slice(-15, 35))\nds_sub.sm.sel(**extent).plot(ax=ax[0])\nds_filled.sm.sel(**extent).plot(ax=ax[1])\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-gap-filling#gap-filling-in-the-spatial-domain","position":11},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation","position":0},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage"},"content":"The objective if this notebook is to demonstrate the loading and plotting of a CCI sea ice coverage dataset.\n\nThis notebook builds upon notebook #5 from the \n\nESA CCI Toolbox: 5-ECY_Zarr_Access.ipynb to visualse Sea Ice in the Northern Hemisphere, using data from Cryosat-2.\n\nThe notebook:\n\naccesses and loads the dataset from the esa-cci-zarr zarr storage\n\nplots a single time step if sea ice thickness\n\ncreates a GIF of a sea ice thickness time series\n\nplots sea ice thickness and concentration\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation","position":1},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl2":"Access and Load Data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#access-and-load-data","position":2},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl2":"Access and Load Data"},"content":"\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#access-and-load-data","position":3},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import necessary librarires","lvl2":"Access and Load Data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-necessary-librarires","position":4},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import necessary librarires","lvl2":"Access and Load Data"},"content":"\n\nfrom xcube.core.store import new_data_store\n\n%matplotlib inline\n\nimport matplotlib\nimport numpy as np\nimport matplotlib.pyplot as plt\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-necessary-librarires","position":5},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Set data storage to esa-cci-zarr","lvl2":"Access and Load Data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#set-data-storage-to-esa-cci-zarr","position":6},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Set data storage to esa-cci-zarr","lvl2":"Access and Load Data"},"content":"\n\nzarr_store = new_data_store('esa-cci-zarr')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#set-data-storage-to-esa-cci-zarr","position":7},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Access specific dataset","lvl2":"Access and Load Data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#access-specific-dataset","position":8},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Access specific dataset","lvl2":"Access and Load Data"},"content":"We access the ESACCI-SEAICE-L3C-SITHICK-SIRAL_CRYOSAT2-NH25KMEASE2-2010-2017-fv2.0.zarr dataset from the Zarr data store. (Other datasets can be found using the \n\n1-ECT_Finding_Data notebook.)\n\nThis is a six-year sea ice thickness dataset covering the northern hemisphere. This dataset was produced by the \n\nESA CCI Sea Ice Project, and more details on the ESACCI-SEAICE-L3C-SITHICK-SIRAL_CRYOSAT2-NH25KMEASE2-2010-2017-fv2.0 dataset can be \n\nfound here.\n\nMore information from the dataset attrs is displayed below.\n\nimport json\n\n# Assuming this is how you get the data from zarr_store.describe_data()\nresponse = zarr_store.describe_data('ESACCI-SEAICE-L3C-SITHICK-SIRAL_CRYOSAT2-NH25KMEASE2-2010-2017-fv2.0.zarr')\n\n# If the response has a method to_dict() or equivalent, use it.\n# Convert the response to a dictionary-like structure\nresponse_dict = response.to_dict() if hasattr(response, 'to_dict') else dict(response)\n\n# Format and display the response with indentation\nformatted_response = json.dumps(response_dict, indent=4)\n\n# Display formatted response\nprint(formatted_response)\n\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#access-specific-dataset","position":9},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Open a data cube for this dataset","lvl2":"Access and Load Data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#open-a-data-cube-for-this-dataset","position":10},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Open a data cube for this dataset","lvl2":"Access and Load Data"},"content":"\n\ncube = zarr_store.open_data('ESACCI-SEAICE-L3C-SITHICK-SIRAL_CRYOSAT2-NH25KMEASE2-2010-2017-fv2.0.zarr')\ncube\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#open-a-data-cube-for-this-dataset","position":11},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl2":"Visualising the data"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#visualising-the-data","position":12},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl2":"Visualising the data"},"content":"We visualise the data by:\n\nplotting a single time step\n\ncreating a GIF of a time series\n\ncharting sea ice thickness and concentration\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#visualising-the-data","position":13},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plot-a-single-time-step","position":14},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"content":"\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plot-a-single-time-step","position":15},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import the necessary libraries","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-the-necessary-libraries","position":16},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import the necessary libraries","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"content":"\n\nimport matplotlib.pyplot as plt\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-the-necessary-libraries","position":17},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Create the plot","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#create-the-plot","position":18},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Create the plot","lvl3":"Plot a single time step","lvl2":"Visualising the data"},"content":"\n\ncube.sea_ice_thickness.sel(time='2017-11-01 12:00:00', method='nearest').plot.imshow(cmap='bone', figsize=(8, 8))\nplt.show()\nplt.close()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#create-the-plot","position":19},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Create a GIF","lvl2":"Visualising the data"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#create-a-gif","position":20},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Create a GIF","lvl2":"Visualising the data"},"content":"To visualse how the sea ice changes over the dataset period, we create an animated gif, plotting each time point in the dataset. The gif image will be saved locally.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#create-a-gif","position":21},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Install the required libraries","lvl3":"Create a GIF","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#install-the-required-libraries","position":22},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Install the required libraries","lvl3":"Create a GIF","lvl2":"Visualising the data"},"content":"\n\n!pip install imageio\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#install-the-required-libraries","position":23},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Get the times from the data cube","lvl3":"Create a GIF","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#get-the-times-from-the-data-cube","position":24},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Get the times from the data cube","lvl3":"Create a GIF","lvl2":"Visualising the data"},"content":"\n\ntimes = cube.time\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#get-the-times-from-the-data-cube","position":25},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import necessary libraries and create GIF","lvl3":"Create a GIF","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-necessary-libraries-and-create-gif","position":26},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Import necessary libraries and create GIF","lvl3":"Create a GIF","lvl2":"Visualising the data"},"content":"The GIF will be created in memory, and then stored as specified in gif_filename.\n\nNote: the runtime of this cell can be several minutes.\n\n# Import necessary libraries\nimport imageio\nimport matplotlib.pyplot as plt\nfrom io import BytesIO\nimport warnings\nimport os\n\n# Suppress warnings\nwarnings.filterwarnings('ignore')\n\n# Parameters\ndelay = 1.0  # Delay between frames in seconds\n\n# Ensure the 'output' directory exists\noutput_dir = 'output'\nif not os.path.exists(output_dir):\n    os.makedirs(output_dir)\n\n# Generate plots for the whole timeseries and store them in memory\nimages = []\n\nfor i in range(len(times)):\n    t = times[i]\n    fig, ax = plt.subplots(figsize=(8, 8))\n    cube.sea_ice_thickness.sel(time=t, method='nearest').plot.imshow(cmap='bone', ax=ax, vmin=-2, vmax=5)\n    buf = BytesIO()\n    plt.savefig(buf, format='jpg')\n    buf.seek(0)\n    images.append(imageio.imread(buf))\n    plt.close(fig)\n\n# Create the animated GIF from the images in the 'output' folder\ngif_filename = os.path.join(output_dir, 'CCI-SeaIce-Animation.gif')\nimageio.mimsave(gif_filename, images, duration=delay)\n\n# Display the animated GIF in the notebook\nfrom IPython.display import Image\nImage(filename=gif_filename)\n\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#import-necessary-libraries-and-create-gif","position":27},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl3","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plotting-the-time-series","position":28},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"Plot the average sea ice thickness and sea ice concentration at each time point over the perio.\n\nThe below builds off notebook 8 in the ESA CCI Toolbox: \n\n8-ECT_Using_Operations.ipynb.\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plotting-the-time-series","position":29},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Install necessary libraries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#install-necessary-libraries","position":30},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Install necessary libraries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"\n\nimport esa_climate_toolbox.ops as ops\n\nfrom esa_climate_toolbox.core import get_op\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.util.monitor import ConsoleMonitor\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#install-necessary-libraries","position":31},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Select variables","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#select-variables","position":32},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Select variables","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"\n\nsvar_op = get_op('select_var')\n\nseaice_concentration_ds = svar_op(ds=cube, var='sea_ice_concentration')\nseaice_concentration_ds\n\nseaice_thickness_ds = svar_op(ds=cube, var='sea_ice_thickness')\nseaice_thickness_ds\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#select-variables","position":33},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Set timeseries parameters","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#set-timeseries-parameters","position":34},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Set timeseries parameters","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"\n\ntseries_point_op = get_op('tseries_point')\ntseries_mean_op = get_op('tseries_mean')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#set-timeseries-parameters","position":35},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Compute mean timeseries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#compute-mean-timeseries","position":36},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Compute mean timeseries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"\n\nseaice_thickness_mean = tseries_mean_op(seaice_thickness_ds, var='sea_ice_thickness')\nseaice_concentration_mean = tseries_mean_op(seaice_concentration_ds, var='sea_ice_concentration')\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#compute-mean-timeseries","position":37},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Plot mean timeseries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"type":"lvl4","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plot-mean-timeseries","position":38},{"hierarchy":{"lvl1":"Access and Plot Northern Hemisphere Sea Ice from Zarr Data Storage","lvl4":"Plot mean timeseries","lvl3":"Plotting the time series","lvl2":"Visualising the data"},"content":"\n\n%matplotlib inline\n\nseaice_thickness_mean.sea_ice_thickness_mean.plot()\nplt.title(\"Mean Sea Ice Thickness, Cryosat-2 data\")\nplt.xlabel(\"Year\")\nplt.ylabel(\"Thickness of the Sea Ice Layer (m)\")\nplt.show()\nplt.close()\n\nseaice_concentration_mean.sea_ice_concentration_mean.plot()\nplt.title(\"Mean Sea Ice Concentration, Cryosat-2 data\")\nplt.xlabel(\"Year\")\nplt.ylabel(\"Sea Ice Concentration (%)\")\nplt.show()\nplt.close()\n\n\n\n","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/cci-seaice-animation#plot-mean-timeseries","position":39},{"hierarchy":{"lvl1":"External User Created Examples"},"type":"lvl1","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme","position":0},{"hierarchy":{"lvl1":"External User Created Examples"},"content":"\n\nWelcome to the user_examples folder!","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme","position":1},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"Purpose"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#purpose","position":2},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"Purpose"},"content":"This folder contains examples contributed by the users of this repository. These examples are shared as part of an open collaboration, with the goal of showcasing different ways to use the tools and code available in this repository.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#purpose","position":3},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"Disclaimer"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#disclaimer","position":4},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"Disclaimer"},"content":"Please note that the examples in this folder are not officially supported by the repository owner or maintainers. The repository owner is not responsible for the correctness, functionality, or maintenance of the user-contributed code found here.\n\nUse at your own risk: While these examples may provide valuable insights, we cannot guarantee their accuracy or relevance to your specific use case.\n\nCommunity Contributions: These examples are provided by the community, and we encourage users to share their ideas and approaches here. However, they may not adhere to the same standards as the core repository.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#disclaimer","position":5},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"How to Contribute"},"type":"lvl2","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#how-to-contribute","position":6},{"hierarchy":{"lvl1":"External User Created Examples","lvl2":"How to Contribute"},"content":"If you’d like to share an example:\n\nPlease ensure that your example is well-documented, so that others can understand and learn from it.\n\nSubmit a pull request with your example added to this folder.\n\nContributions are welcome, but keep in mind that support will not be provided for user-created content. If you encounter issues with these examples, we recommend reaching out to the original author via the pull request or issue tracker.","type":"content","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/user-examples/readme#how-to-contribute","position":7}]}