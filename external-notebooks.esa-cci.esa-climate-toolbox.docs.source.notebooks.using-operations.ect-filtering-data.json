{"version":3,"kind":"Notebook","sha256":"e61bedde652c55008130d6d8fcf0ae9193608e4e7f28be5b863e640e98931aea","slug":"external-notebooks.esa-cci.esa-climate-toolbox.docs.source.notebooks.using-operations.ect-filtering-data","location":"/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Using_Operations/4-ECT_Filtering_Data.ipynb","dependencies":[],"frontmatter":{"title":"Filter Operations","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Using_Operations/4-ECT_Filtering_Data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Using_Operations/4-ECT_Filtering_Data.ipynb","exports":[{"format":"ipynb","filename":"4-ECT_Filtering_Data.ipynb","url":"/cci-toolbox-usage-viewers/build/4-ECT_Filtering_Data-e9556a995566ac73c6b763e7f25ac259.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Filter Operations","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X6s2rhxLx8"}],"identifier":"filter-operations","label":"Filter Operations","html_id":"filter-operations","implicit":true,"key":"ew7hHsX7s1"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In this section, we will demonstrate three filter operations on CCI ECV datasets:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UVMKTgdlE4"}],"key":"VOiRzjSlJz"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Filtering a dataset based on a specific flag value.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"SLblz5uxmP"}],"key":"ijoaDWK9hL"}],"key":"FxGisjqhfi"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Filtering, exploring, and propagating uncertainties that accompany the dataset.","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"qVtaZyeJVC"}],"key":"bMuxyRmFKi"}],"key":"zMIB4ld5k1"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Filtering based on any data feature.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OQ8UEJHght"}],"key":"mwEY0wg7Nf"}],"key":"mjpuy0POSY"}],"key":"JRqZnwVu01"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"All of these filter operations are performed using the ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Qhyh7fVUuR"},{"type":"link","url":"https://docs.xarray.dev/en/stable/generated/xarray.Dataset.where.html","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"inlineCode","value":"xarray.Dataset.where","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"vK5LZq5ABn"}],"urlSource":"https://docs.xarray.dev/en/stable/generated/xarray.Dataset.where.html","key":"q2xeesyHHi"},{"type":"text","value":" method, which is fully compatible with ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"Qr9lv8CJu8"},{"type":"link","url":"https://www.dask.org/","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Dask","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"scRa9PeXpt"}],"urlSource":"https://www.dask.org/","key":"akeQgIFLFU"},{"type":"text","value":". This approach allows for on-demand filtering, performed chunk-by-chunk for efficiency.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CDDPFuuEz3"}],"key":"Crxz2XLsb1"}],"key":"qIWjXVHIfx"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lDn60JXd8z"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"1. Filtering a datset for a given flag value","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"LKYji1A7ZA"}],"identifier":"id-1-filtering-a-datset-for-a-given-flag-value","label":"1. Filtering a datset for a given flag value","html_id":"id-1-filtering-a-datset-for-a-given-flag-value","implicit":true,"key":"Zsazo5ulKT"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will show this filtering operation on a soil moisture dataset, which comes with a quality flag for its observational data.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lemuRyXnFu"}],"key":"uyJV0JvYHl"}],"key":"oxt0SXyucb"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\nfrom xcube.core.store import new_data_store","visibility":"show","key":"dho4ZdGs6E"},{"type":"outputs","id":"2MDU6ojuC09NoTgiJtsNK","children":[],"visibility":"show","key":"z9l5kUGqkn"}],"visibility":"show","key":"frc1uirHEh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can access the soil moisture dataset through the Zarr data store, as shown below:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QpUKLOmk6g"}],"key":"XDcU6pALKa"}],"key":"NXBDO6vkA1"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"store = new_data_store('esa-cci-zarr')","visibility":"show","key":"e1k1gUE1D7"},{"type":"outputs","id":"hdTaIJ2Vn7gTXc3LjxR0k","children":[],"visibility":"show","key":"LTlC4lkRFM"}],"visibility":"show","key":"O7pMJQXI8p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds","key":"qHsH1jEIeS"},{"type":"outputs","id":"mEDtOuOkiSPRlRzIRJ2zY","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"0cf4a3a26cf90e2d2a616cd8cc952a14","path":"/cci-toolbox-usage-viewers/build/0cf4a3a26cf90e2d2a616cd8cc952a14.html"},"text/plain":{"content":"<xarray.Dataset> Size: 654GB\nDimensions:         (time: 15767, lat: 720, lon: 1440)\nCoordinates:\n  * lat             (lat) float64 6kB 89.88 89.62 89.38 ... -89.38 -89.62 -89.88\n  * lon             (lon) float64 12kB -179.9 -179.6 -179.4 ... 179.6 179.9\n  * time            (time) datetime64[ns] 126kB 1978-11-01 ... 2021-12-31\nData variables:\n    dnflag          (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    flag            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    freqbandID      (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    mode            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sensor          (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm              (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm_uncertainty  (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    t0              (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\nAttributes: (12/44)\n    Conventions:                  CF-1.9\n    cdm_data_type:                Grid\n    comment:                      This dataset was produced with funding of t...\n    contact:                      cci_sm_contact@eodc.eu\n    creator_email:                cci_sm_developer@eodc.eu\n    creator_name:                 Department of Geodesy and Geoinformation, V...\n    ...                           ...\n    time_coverage_end_product:    20211231T235959Z\n    time_coverage_resolution:     P1D\n    time_coverage_start:          1978-11-01 00:00:00\n    time_coverage_start_product:  19781101T000000Z\n    title:                        ESA CCI Surface Soil Moisture COMBINED acti...\n    tracking_id:                  ad35798e-58e0-488f-b5b9-593874a47700","content_type":"text/plain"}}},"children":[],"key":"VztDfsZoye"}],"key":"M0HLUE0kFl"}],"key":"tt1SPNAfsM"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can filter the soil moisture data using the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BzRJz7rMyd"},{"type":"inlineCode","value":"\"no_data_inconsistency_detected\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WuV2e14D2n"},{"type":"text","value":" flag, which corresponds to a flag value of ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tdeIuxvw7N"},{"type":"inlineCode","value":"0","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m8Fr7BllIc"},{"type":"text","value":" in the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cGKROBJEp2"},{"type":"inlineCode","value":"flag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xEpPqYZC7m"},{"type":"text","value":" data variable. This value can be verified by checking the attributes of the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WgkGzxPia6"},{"type":"inlineCode","value":"flag","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rvrtmzLqkG"},{"type":"text","value":" variable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F164osrZGl"}],"key":"W5QypHJoHd"}],"key":"YFl2zSWyeX"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filtered_ds = ds.where(ds[\"flag\"] != 0)\nfiltered_ds","key":"JSbnumKMqE"},{"type":"outputs","id":"8KVX1j5wNaSeav3QH-soA","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d855039f48d19b674622b9dbf3a3ebe2","path":"/cci-toolbox-usage-viewers/build/d855039f48d19b674622b9dbf3a3ebe2.html"},"text/plain":{"content":"<xarray.Dataset> Size: 654GB\nDimensions:         (time: 15767, lat: 720, lon: 1440)\nCoordinates:\n  * lat             (lat) float64 6kB 89.88 89.62 89.38 ... -89.38 -89.62 -89.88\n  * lon             (lon) float64 12kB -179.9 -179.6 -179.4 ... 179.6 179.9\n  * time            (time) datetime64[ns] 126kB 1978-11-01 ... 2021-12-31\nData variables:\n    dnflag          (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    flag            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    freqbandID      (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    mode            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sensor          (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm              (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm_uncertainty  (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    t0              (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\nAttributes: (12/44)\n    Conventions:                  CF-1.9\n    cdm_data_type:                Grid\n    comment:                      This dataset was produced with funding of t...\n    contact:                      cci_sm_contact@eodc.eu\n    creator_email:                cci_sm_developer@eodc.eu\n    creator_name:                 Department of Geodesy and Geoinformation, V...\n    ...                           ...\n    time_coverage_end_product:    20211231T235959Z\n    time_coverage_resolution:     P1D\n    time_coverage_start:          1978-11-01 00:00:00\n    time_coverage_start_product:  19781101T000000Z\n    title:                        ESA CCI Surface Soil Moisture COMBINED acti...\n    tracking_id:                  ad35798e-58e0-488f-b5b9-593874a47700","content_type":"text/plain"}}},"children":[],"key":"sCFIpiGJS6"}],"key":"KBPnPymE1y"}],"key":"HK5ObRKGMU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can generate a comparison plot that illustrates both the unfiltered and filtered soil moisture at a single time step as an example.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rDfO7lRMkl"}],"key":"YW97JOvMEU"}],"key":"uRHyuZ5xQb"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=1)\nfiltered_ds.sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=1)","key":"ZhSs6bfI03"},{"type":"outputs","id":"dy41XnVW0-_cGP5pc1drS","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1a374de45f99638ceb7b8adbac8012a4","path":"/cci-toolbox-usage-viewers/build/1a374de45f99638ceb7b8adbac8012a4.png"},"text/plain":{"content":"<Figure size 1300x400 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"eOcb2FaJin"}],"key":"tdpKt4uaoP"}],"key":"KZ9869nFxj"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PdWyV8rX5Y"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"2. Filtering based on uncertainties that accompany a dataset","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"E83P8Sja58"}],"identifier":"id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","label":"2. Filtering based on uncertainties that accompany a dataset","html_id":"id-2-filtering-based-on-uncertainties-that-accompany-a-dataset","implicit":true,"key":"J7ZKYI8FhE"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will show this filtering operation on a biomass dataset, which carries uncertainty values for the above-ground biomass data in the ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hi8dWbHeGy"},{"type":"inlineCode","value":"\"abg_se\"","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Y7HhUVZ7ug"},{"type":"text","value":" (long name ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"qScQBcqTP8"},{"type":"inlineCode","value":"\"Above-ground biomass standard_error\"","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ub0o8akcs3"},{"type":"text","value":") data variable.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"I0OLrFnqcU"}],"key":"Xg7ROg0f3K"}],"key":"zor3ExdpdR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = store.open_data('ESACCI-BIOMASS-L4-AGB-MERGED-100m-2010-2020-fv4.0.zarr')\nds","key":"rchdCKIi4q"},{"type":"outputs","id":"yU-1YNBdSMFcNxTe7ozQp","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"279e30ce5eccbb86d377aa0a2bfee185","path":"/cci-toolbox-usage-viewers/build/279e30ce5eccbb86d377aa0a2bfee185.html"},"text/plain":{"content":"<xarray.Dataset> Size: 3TB\nDimensions:    (time: 5, lat: 157500, lon: 405000, nv: 2)\nCoordinates:\n  * lat        (lat) float64 1MB 80.0 80.0 80.0 80.0 ... -60.0 -60.0 -60.0 -60.0\n    lat_bnds   (lat, nv) float64 3MB dask.array<chunksize=(1575, 2), meta=np.ndarray>\n  * lon        (lon) float64 3MB -180.0 -180.0 -180.0 ... 180.0 180.0 180.0\n    lon_bnds   (lon, nv) float64 6MB dask.array<chunksize=(2025, 2), meta=np.ndarray>\n  * time       (time) datetime64[ns] 40B 2010-07-02 2017-07-02 ... 2020-07-01\n    time_bnds  (time, nv) datetime64[ns] 80B dask.array<chunksize=(1, 2), meta=np.ndarray>\nDimensions without coordinates: nv\nData variables:\n    agb        (time, lat, lon) float32 1TB dask.array<chunksize=(1, 1575, 2025), meta=np.ndarray>\n    agb_se     (time, lat, lon) float32 1TB dask.array<chunksize=(1, 1575, 2025), meta=np.ndarray>\nAttributes: (12/53)\n    Conventions:                  CF-1.7\n    EPSG:                         4326\n    GeoTransform:                 -180   0.00088888888888                  0 ...\n    catalogue_url:                https://catalogue.ceda.ac.uk/uuid/84403d09c...\n    cdm_data_type:                INT\n    comment:                      These data were produced at ESA CCI as part...\n    ...                           ...\n    time_coverage_duration:       P1Y\n    time_coverage_end:            20201231T000000Z\n    time_coverage_resolution:     P1Y\n    time_coverage_start:          20100101T000000Z\n    title:                        ESA CCI above-ground biomass product level ...\n    tracking_id:                  cd5cb1d2-e582-41ab-a0fc-637f050baf9e","content_type":"text/plain"}}},"children":[],"key":"LaHjLdXBH1"}],"key":"YvKtCF0zXz"}],"key":"Tz3nXSpINt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Since the dataset is quite large, we have selected the Tropical Climate Zone (TCL) in Africa for analysis. This region is known for its high biological activity and consequently high values of above-ground biomass.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eqwCvUtesw"}],"key":"e7bib6hpBr"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Itâ€™s important to note that the filtering method works efficiently on the full dataset. This is because the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"G0ObAC4gXz"},{"type":"inlineCode","value":"xarray.Dataset.where","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Wg4isKaNZB"},{"type":"text","value":" operation is performed on demand, either when writing or plotting the data. However, without selecting a smaller subset like the TCL Zone, performance issues will arise during plotting.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dUbS7VzisS"}],"key":"QhdL2INiUA"}],"key":"uyM3Dn2elM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = ds.sel(lat=slice(10, -10), lon=slice(10, 40))\nds","key":"RHPHChwLIj"},{"type":"outputs","id":"HDEA_C4tzdMzOP2CY-9Go","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"c0b42214ee1ae9fff2a0d5497006fbd8","path":"/cci-toolbox-usage-viewers/build/c0b42214ee1ae9fff2a0d5497006fbd8.html"},"text/plain":{"content":"<xarray.Dataset> Size: 30GB\nDimensions:    (time: 5, lat: 22500, lon: 33750, nv: 2)\nCoordinates:\n  * lat        (lat) float64 180kB 10.0 9.999 9.998 ... -9.998 -9.999 -10.0\n    lat_bnds   (lat, nv) float64 360kB dask.array<chunksize=(1575, 2), meta=np.ndarray>\n  * lon        (lon) float64 270kB 10.0 10.0 10.0 10.0 ... 40.0 40.0 40.0 40.0\n    lon_bnds   (lon, nv) float64 540kB dask.array<chunksize=(900, 2), meta=np.ndarray>\n  * time       (time) datetime64[ns] 40B 2010-07-02 2017-07-02 ... 2020-07-01\n    time_bnds  (time, nv) datetime64[ns] 80B dask.array<chunksize=(1, 2), meta=np.ndarray>\nDimensions without coordinates: nv\nData variables:\n    agb        (time, lat, lon) float32 15GB dask.array<chunksize=(1, 1575, 900), meta=np.ndarray>\n    agb_se     (time, lat, lon) float32 15GB dask.array<chunksize=(1, 1575, 900), meta=np.ndarray>\nAttributes: (12/53)\n    Conventions:                  CF-1.7\n    EPSG:                         4326\n    GeoTransform:                 -180   0.00088888888888                  0 ...\n    catalogue_url:                https://catalogue.ceda.ac.uk/uuid/84403d09c...\n    cdm_data_type:                INT\n    comment:                      These data were produced at ESA CCI as part...\n    ...                           ...\n    time_coverage_duration:       P1Y\n    time_coverage_end:            20201231T000000Z\n    time_coverage_resolution:     P1Y\n    time_coverage_start:          20100101T000000Z\n    title:                        ESA CCI above-ground biomass product level ...\n    tracking_id:                  cd5cb1d2-e582-41ab-a0fc-637f050baf9e","content_type":"text/plain"}}},"children":[],"key":"AUIGpfyAgC"}],"key":"PJZ4IUKNVy"}],"key":"LQjiwfnNAm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Where filter the dataset for standard error smaller than 100 Mg/ha.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"I8CTPdP2xh"}],"key":"p6CTx95ZZT"}],"key":"nIZWxDue85"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"filtered_ds = ds.where(ds[\"agb_se\"] <= 100)\nfiltered_ds","key":"Ff5kCuJeuA"},{"type":"outputs","id":"Bx2e9Uhi5mGHOm1cI5wa5","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"097d236b24ce4480ae9cda5b5c79b04d","path":"/cci-toolbox-usage-viewers/build/097d236b24ce4480ae9cda5b5c79b04d.html"},"text/plain":{"content":"<xarray.Dataset> Size: 30GB\nDimensions:    (time: 5, lat: 22500, lon: 33750, nv: 2)\nCoordinates:\n  * lat        (lat) float64 180kB 10.0 9.999 9.998 ... -9.998 -9.999 -10.0\n    lat_bnds   (lat, nv) float64 360kB dask.array<chunksize=(1575, 2), meta=np.ndarray>\n  * lon        (lon) float64 270kB 10.0 10.0 10.0 10.0 ... 40.0 40.0 40.0 40.0\n    lon_bnds   (lon, nv) float64 540kB dask.array<chunksize=(900, 2), meta=np.ndarray>\n  * time       (time) datetime64[ns] 40B 2010-07-02 2017-07-02 ... 2020-07-01\n    time_bnds  (time, nv) datetime64[ns] 80B dask.array<chunksize=(1, 2), meta=np.ndarray>\nDimensions without coordinates: nv\nData variables:\n    agb        (time, lat, lon) float32 15GB dask.array<chunksize=(1, 1575, 900), meta=np.ndarray>\n    agb_se     (time, lat, lon) float32 15GB dask.array<chunksize=(1, 1575, 900), meta=np.ndarray>\nAttributes: (12/53)\n    Conventions:                  CF-1.7\n    EPSG:                         4326\n    GeoTransform:                 -180   0.00088888888888                  0 ...\n    catalogue_url:                https://catalogue.ceda.ac.uk/uuid/84403d09c...\n    cdm_data_type:                INT\n    comment:                      These data were produced at ESA CCI as part...\n    ...                           ...\n    time_coverage_duration:       P1Y\n    time_coverage_end:            20201231T000000Z\n    time_coverage_resolution:     P1Y\n    time_coverage_start:          20100101T000000Z\n    title:                        ESA CCI above-ground biomass product level ...\n    tracking_id:                  cd5cb1d2-e582-41ab-a0fc-637f050baf9e","content_type":"text/plain"}}},"children":[],"key":"V8Pbz8arRd"}],"key":"AXvo13hlNA"}],"key":"IxO1W1bdPx"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can generate a comparison plot that illustrates both the unfiltered and filtered above-ground biomass at a single time step as an example. Also here we downsample the dataset for the plotting.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ShsOtBrCB4"}],"key":"kUEQkauiA5"}],"key":"WASXhWHgrB"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[0], vmin=0, vmax=500)\nfiltered_ds.agb.isel(time=-1)[::20, ::20].plot(ax=ax[1], vmin=0, vmax=500)","key":"GujdyjnuTh"},{"type":"outputs","id":"LDOaZQXrgSaI6WqUXJFOF","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9e69eb027d14948f091e095e7cff4d41","path":"/cci-toolbox-usage-viewers/build/9e69eb027d14948f091e095e7cff4d41.png"},"text/plain":{"content":"<Figure size 1300x400 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"KbOZHFt1MG"}],"key":"J5TuQIbQ9q"}],"key":"hXO1d8KWbt"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N46d0DW7t6"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"3. Filtering by any data feature","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"DYolDRt0BG"}],"identifier":"id-3-filtering-by-any-data-feature","label":"3. Filtering by any data feature","html_id":"id-3-filtering-by-any-data-feature","implicit":true,"key":"KZZpBsSs7d"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"We will show this filtering operation on the soil moisture dataset, which also has other data variables which can be used for filtering.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"zhcKnicSb6"}],"key":"Jbkz6sr2M9"}],"key":"RQ1Hzeze2I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = store.open_data(\"ESACCI-SOILMOISTURE-L3S-SSMV-COMBINED-1978-2021-fv07.1.zarr\")\nds","key":"kQJw9VtARK"},{"type":"outputs","id":"q42pKqHwTUx_uY2mKxCnB","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d4098cc86943030cb7befe58e12597a7","path":"/cci-toolbox-usage-viewers/build/d4098cc86943030cb7befe58e12597a7.html"},"text/plain":{"content":"<xarray.Dataset> Size: 654GB\nDimensions:         (time: 15767, lat: 720, lon: 1440)\nCoordinates:\n  * lat             (lat) float64 6kB 89.88 89.62 89.38 ... -89.38 -89.62 -89.88\n  * lon             (lon) float64 12kB -179.9 -179.6 -179.4 ... 179.6 179.9\n  * time            (time) datetime64[ns] 126kB 1978-11-01 ... 2021-12-31\nData variables:\n    dnflag          (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    flag            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    freqbandID      (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    mode            (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sensor          (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm              (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    sm_uncertainty  (time, lat, lon) float32 65GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\n    t0              (time, lat, lon) float64 131GB dask.array<chunksize=(16, 720, 720), meta=np.ndarray>\nAttributes: (12/44)\n    Conventions:                  CF-1.9\n    cdm_data_type:                Grid\n    comment:                      This dataset was produced with funding of t...\n    contact:                      cci_sm_contact@eodc.eu\n    creator_email:                cci_sm_developer@eodc.eu\n    creator_name:                 Department of Geodesy and Geoinformation, V...\n    ...                           ...\n    time_coverage_end_product:    20211231T235959Z\n    time_coverage_resolution:     P1D\n    time_coverage_start:          1978-11-01 00:00:00\n    time_coverage_start_product:  19781101T000000Z\n    title:                        ESA CCI Surface Soil Moisture COMBINED acti...\n    tracking_id:                  ad35798e-58e0-488f-b5b9-593874a47700","content_type":"text/plain"}}},"children":[],"key":"TZevxa0lDA"}],"key":"JMBtYqAdj2"}],"key":"rmZixfxaGC"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For example, we can use the data variable ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fAnKhE7noQ"},{"type":"inlineCode","value":"\"mode\"","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JjJP525kMC"},{"type":"text","value":", which indicates whether the observation is derived from the ascending or descending orbit. This variable can be used to filter the dataset, allowing us to select only the ascending mode, represented by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Oy19peaPoM"},{"type":"inlineCode","value":"1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nIBPgZaxii"},{"type":"text","value":", and the descending mode, represented by ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bAcRrgaqXz"},{"type":"inlineCode","value":"2","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nnmKb2TUU7"},{"type":"text","value":", and  as shown below:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Sjmevdnc7m"}],"key":"RgLgO5gd4U"}],"key":"HyKflbfFzt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.7)\nds.where(ds[\"mode\"] == 2).sm.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.7)","key":"VXLFHsrj94"},{"type":"outputs","id":"5zNXoKrDJCgPj7asdaI2s","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3f0974cd675706e0b0ec0d2b790bcd42","path":"/cci-toolbox-usage-viewers/build/3f0974cd675706e0b0ec0d2b790bcd42.png"},"text/plain":{"content":"<Figure size 1300x400 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"tcKP8smc40"}],"key":"FoHVwVm77D"}],"key":"e21OhEufNF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can easliy generate the same plot for the soil moisture uncertainty data variable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"McqqPFOk6Q"}],"key":"RrfbkyplzY"}],"key":"Ol76giqiwn"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots(1, 2, figsize=(13, 4))\nds.where(ds[\"mode\"] == 1).sm_uncertainty.isel(time=-1).plot(ax=ax[0], vmin=0, vmax=0.07)\nds.where(ds[\"mode\"] == 2).sm_uncertainty.isel(time=-1).plot(ax=ax[1], vmin=0, vmax=0.07)","key":"IMAbyRp2Ua"},{"type":"outputs","id":"BWqsMbYXJfZ0CWyQ7rK8n","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fd7d7d8ffe688e890bebf1383726b0a4","path":"/cci-toolbox-usage-viewers/build/fd7d7d8ffe688e890bebf1383726b0a4.png"},"text/plain":{"content":"<Figure size 1300x400 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"DSnJaU5XOn"}],"key":"NyBMaeps1B"}],"key":"rjyFT7WMem"}],"key":"cvog380aXd"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"ESA CCI Toolbox Reproject Dataset","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-reprojecting-data","group":"Source"},"next":{"title":"Gap Filling","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-gap-filling","group":"Source"}}},"domain":"http://localhost:3000"}