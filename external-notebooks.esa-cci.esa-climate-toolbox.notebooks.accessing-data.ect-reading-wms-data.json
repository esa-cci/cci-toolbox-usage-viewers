{"version":3,"kind":"Notebook","sha256":"03a6349fa0432db570e215e92674c15752b204a5a6f7c7eeaeb6a63e6cb07ae3","slug":"external-notebooks.esa-cci.esa-climate-toolbox.notebooks.accessing-data.ect-reading-wms-data","location":"/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","dependencies":[],"frontmatter":{"title":"Access to WMS data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","exports":[{"format":"ipynb","filename":"9-ECT_Reading_WMS_data.ipynb","url":"/cci-toolbox-usage-viewers/build/9-ECT_Reading_WMS_da-fa8f414ab18f7a97432a23f8f4a00aca.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The CEDA data server at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jflC4eEKqv"},{"type":"link","url":"https://data.cci.ceda.ac.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​data​.cci​.ceda​.ac​.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jMhE2ofzKl"}],"urlSource":"https://data.cci.ceda.ac.uk/","key":"rj7duj4PZy"},{"type":"text","value":" provides access via the OGC Web Map Service (WMS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WMS from the CEDA server, using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"C3HGMeFP3i"},{"type":"link","url":"https://www.osgeo.org/projects/owslib/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"OWSLib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zKUWgDnBNa"}],"urlSource":"https://www.osgeo.org/projects/owslib/","key":"VCTc4XqqmL"},{"type":"text","value":" as the client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BsDKgBhJTe"}],"key":"LDcMaF9nPB"}],"key":"mgswFa7m6G"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e5VUVcPS9K"},{"type":"inlineCode","value":"owslib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SxX4wmRLpy"},{"type":"text","value":" is not already installed in the Python environment, uncomment the following cell to install it with mamba.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NuZWTIiZrl"}],"key":"JDyzeHfqlp"}],"key":"lUuV54r88p"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ! mamba install --yes owslib","key":"kXTHd2EJCS"},{"type":"outputs","id":"kK9e2MAZWacrSkynvQgry","children":[],"key":"lmtt50hdTa"}],"key":"YBJqvvphe7"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import some required libraries, including OWSLib as the WMS client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Qu2B8TWV65"}],"key":"HBqhp9JdLr"}],"key":"yaY32UxlFD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from owslib.wms import WebMapService\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\nfrom IPython.display import Image","key":"tyVwE1Jdjw"},{"type":"outputs","id":"uwEfRNWIY7dAFrrhBl8_4","children":[],"key":"nPFZGPb0iU"}],"key":"bArZw7VnM8"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available ECVs.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GDP9dNeJeL"}],"key":"tJ92w95kkC"}],"key":"sLHCHOufDO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list_ecvs()","key":"a5OEA2UvHg"},{"type":"outputs","id":"96JLjHBiTXpCMI_3PvP9y","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"['SEASURFACESALINITY',\n 'BIOMASS',\n 'CLOUD',\n 'AEROSOL',\n 'VEGETATION',\n 'LST',\n 'LC',\n 'FIRE',\n 'LAKES',\n 'PERMAFROST',\n 'SEALEVEL',\n 'OZONE',\n 'WATERVAPOUR',\n 'ICESHEETS',\n 'OC',\n 'SEASTATE',\n 'SOILMOISTURE',\n 'SEAICE',\n 'GHG',\n 'SNOW',\n 'RD',\n 'SST']","content_type":"text/plain"}}},"children":[],"key":"OubMNcdGxd"}],"key":"YbPMn8dcxn"}],"key":"Ys5EmtTT3S"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available datasets for the cloud ECV.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eQ676j5Q23"}],"key":"qUJKZE83Rb"}],"key":"yWcQs7GbNQ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"CLOUD\"))))","key":"BEdQd9Dd2G"},{"type":"outputs","id":"esnMcwbs0qWeK0_gFlkli","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Aqua.MODIS_AQUA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Terra.MODIS_TERRA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-AM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-PM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.MERIS-AATSR.2-0.r1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MODIS_AQUA-200208-201412-fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-ATSR2_AATSR-199506-201204-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_AM-199109-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_PM-198201-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MERIS-AATSR_ENVISAT-200301-201112_fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_NOAA-1982-2016-fv3.0.zarr\n"},"children":[],"key":"v1YKr6EmeG"}],"key":"ugSMI2Anzm"}],"key":"UDG4dlv4zA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select a dataset from the list and store its name in a variable for use in the following steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yq8R3nutwU"}],"key":"KArBUSqNd7"}],"key":"w6thoVAOJm"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_id = \"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\"","key":"q0Op91bEpg"},{"type":"outputs","id":"Yl8oayK7Mpz-vvkPDHtbq","children":[],"key":"HUQgylb4K2"}],"key":"PjcEVXYZrw"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a local representation of the WMS service for the selected dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nrOhTBW5b2"}],"key":"b81gha7NVG"}],"key":"pMHbjUhaGw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms_url = f\"https://data.cci.ceda.ac.uk/thredds/wms/{ds_id}?service=WMS&version=1.3.0\"\nwms = WebMapService(wms_url, version=\"1.3.0\", timeout=600)","key":"kyAOnMbeoW"},{"type":"outputs","id":"NYLAP9qklJPlYNlz9jbgA","children":[],"key":"yE3wf1Ozo6"}],"key":"iNCTLLsbOe"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the data variables available from this service.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ekjpLhNVic"}],"key":"CK7TgiCuMa"}],"key":"JR6Qs2XzW3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list(wms.contents)","key":"LrtWCLI2wS"},{"type":"outputs","id":"513lhSoxm3hjbApCtV6F-","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"['nday',\n 'nday_low',\n 'nday_mid',\n 'nday_hig',\n 'nobs',\n 'nobs_day',\n 'nobs_clear_day',\n 'nobs_cloudy_day',\n 'nobs_clear_night',\n 'nobs_cloudy_night',\n 'nobs_clear_twl',\n 'nobs_cloudy_twl',\n 'nobs_cloudy',\n 'nretr_clear',\n 'nretr_cloudy',\n 'toa_swup',\n 'toa_swdn',\n 'toa_swup_clr',\n 'toa_lwup',\n 'toa_lwup_clr',\n 'toa_swup_low',\n 'toa_swup_mid',\n 'toa_swup_hig',\n 'toa_lwup_low',\n 'toa_lwup_mid',\n 'toa_lwup_hig',\n 'boa_swup',\n 'boa_swup_clr',\n 'boa_lwup',\n 'boa_lwup_clr',\n 'boa_swdn',\n 'boa_swdn_clr',\n 'boa_lwdn',\n 'boa_lwdn_clr',\n 'cee',\n 'cee_corr_unc',\n 'cee_prop_unc',\n 'cee_std',\n 'cee_unc',\n 'cer',\n 'cer_corr_unc',\n 'cer_ice',\n 'cer_ice_corr_unc',\n 'cer_ice_prop_unc',\n 'cer_ice_std',\n 'cer_ice_unc',\n 'cer_liq',\n 'cer_liq_corr_unc',\n 'cer_liq_prop_unc',\n 'cer_liq_std',\n 'cer_liq_unc',\n 'cer_prop_unc',\n 'cer_std',\n 'cer_unc',\n 'cfc',\n 'cfc_corr_unc',\n 'cfc_day',\n 'cfc_high',\n 'cfc_low',\n 'cfc_mid',\n 'cfc_night',\n 'cfc_prop_unc',\n 'cfc_std',\n 'cfc_twl',\n 'cfc_unc',\n 'cla_vis006',\n 'cla_vis006_corr_unc',\n 'cla_vis006_ice',\n 'cla_vis006_ice_std',\n 'cla_vis006_ice_unc',\n 'cla_vis006_liq',\n 'cla_vis006_liq_std',\n 'cla_vis006_liq_unc',\n 'cla_vis006_prop_unc',\n 'cla_vis006_std',\n 'cla_vis006_unc',\n 'cla_vis008',\n 'cla_vis008_corr_unc',\n 'cla_vis008_ice',\n 'cla_vis008_ice_std',\n 'cla_vis008_ice_unc',\n 'cla_vis008_liq',\n 'cla_vis008_liq_std',\n 'cla_vis008_liq_unc',\n 'cla_vis008_prop_unc',\n 'cla_vis008_std',\n 'cla_vis008_unc',\n 'cot',\n 'cot_corr_unc',\n 'cot_ice',\n 'cot_ice_corr_unc',\n 'cot_ice_prop_unc',\n 'cot_ice_std',\n 'cot_ice_unc',\n 'cot_liq',\n 'cot_liq_corr_unc',\n 'cot_liq_prop_unc',\n 'cot_liq_std',\n 'cot_liq_unc',\n 'cot_log',\n 'cot_prop_unc',\n 'cot_std',\n 'cot_unc',\n 'cph',\n 'cph_corr_unc',\n 'cph_day',\n 'cph_day_corr_unc',\n 'cph_day_prop_unc',\n 'cph_day_std',\n 'cph_day_unc',\n 'cph_prop_unc',\n 'cph_std',\n 'cph_unc',\n 'cth',\n 'cth_corr_unc',\n 'cth_corrected',\n 'cth_corrected_corr_unc',\n 'cth_corrected_prop_unc',\n 'cth_corrected_std',\n 'cth_corrected_unc',\n 'cth_prop_unc',\n 'cth_std',\n 'cth_unc',\n 'ctp',\n 'ctp_corr_unc',\n 'ctp_corrected',\n 'ctp_corrected_corr_unc',\n 'ctp_corrected_prop_unc',\n 'ctp_corrected_std',\n 'ctp_corrected_unc',\n 'ctp_log',\n 'ctp_prop_unc',\n 'ctp_std',\n 'ctp_unc',\n 'ctt',\n 'ctt_corr_unc',\n 'ctt_corrected',\n 'ctt_corrected_corr_unc',\n 'ctt_corrected_prop_unc',\n 'ctt_corrected_std',\n 'ctt_corrected_unc',\n 'ctt_prop_unc',\n 'ctt_std',\n 'ctt_unc',\n 'iwp',\n 'iwp_allsky',\n 'iwp_corr_unc',\n 'iwp_prop_unc',\n 'iwp_std',\n 'iwp_unc',\n 'lwp',\n 'lwp_allsky',\n 'lwp_corr_unc',\n 'lwp_prop_unc',\n 'lwp_std',\n 'lwp_unc',\n 'nretr_cloudy_day',\n 'nretr_cloudy_day_ice',\n 'nretr_cloudy_day_liq',\n 'nretr_cloudy_high',\n 'nretr_cloudy_ice',\n 'nretr_cloudy_liq',\n 'nretr_cloudy_low',\n 'nretr_cloudy_mid',\n 'stemp_clear',\n 'stemp_clear_corr_unc',\n 'stemp_clear_prop_unc',\n 'stemp_clear_std',\n 'stemp_clear_unc',\n 'stemp_cloudy',\n 'stemp_cloudy_corr_unc',\n 'stemp_cloudy_prop_unc',\n 'stemp_cloudy_std',\n 'stemp_cloudy_unc']","content_type":"text/plain"}}},"children":[],"key":"YBswGo4PR5"}],"key":"RWvcspgbql"}],"key":"ieRTDkRw94"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F42c2irm2v"},{"type":"inlineCode","value":"iwp","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EpxoxWmNMG"},{"type":"text","value":" (ice water path) variable from the list and store its name in a variable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PYS13UQes6"}],"key":"XD5xpYidm9"}],"key":"Rfclsd2x3v"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_id = \"iwp\"","key":"uT1LdKnjnU"},{"type":"outputs","id":"U926X8Oz2GbJZd3HWaD7i","children":[],"key":"Ry4VpTAayk"}],"key":"Hi0lRPUFpi"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check the bounding box for the selected dataset and variable; we can see that it is of global extent.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"y0Eic4VYTl"}],"key":"Mjt7rHAxYD"}],"key":"atz9YxuJLA"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms.contents[data_id].boundingBox","key":"kbwxV3kH1T"},{"type":"outputs","id":"tuo62QS6rTqjNJcXUlBGS","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"(-179.75, -89.75, 179.75, 89.75, 'CRS:84')","content_type":"text/plain"}}},"children":[],"key":"cXYPizznxy"}],"key":"tKQB9UoQA4"}],"key":"tltHSEW9MS"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check what times are available, filtering to the year 2011.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZJKk6VwHKX"}],"key":"SThLla0HY4"}],"key":"AqM5BNAHTI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[t for t in wms[data_id].timepositions if t.startswith(\"2011\")]","key":"DTexjnPusw"},{"type":"outputs","id":"CtxIHLLEzYhOPpN8cZ-NS","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"['2011-01-01T00:00:00.000Z',\n '2011-02-01T00:00:00.000Z',\n '2011-03-01T00:00:00.000Z',\n '2011-04-01T00:00:00.000Z',\n '2011-05-01T00:00:00.000Z',\n '2011-06-01T00:00:00.000Z',\n '2011-07-01T00:00:00.000Z',\n '2011-08-01T00:00:00.000Z',\n '2011-09-01T00:00:00.000Z',\n '2011-10-01T00:00:00.000Z',\n '2011-11-01T00:00:00.000Z',\n '2011-12-01T00:00:00.000Z']","content_type":"text/plain"}}},"children":[],"key":"uen8fMlVEj"}],"key":"w1D1dNgqdY"}],"key":"YfqAw6RRcB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Request a map for the chosen dataset and variable from the WMS server, selecting a time from the list above and a bounding box covering latitudes from 80°S to 50°N, then display the map in the notebook.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"riQodplKen"}],"key":"hy5cGOFG6J"}],"key":"CrI1qsNkNj"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"response = wms.getmap(\n    layers=[\"iwp\"],\n    styles=[\"boxfill/rainbow\"],\n    size=[800, 600],\n    srs=\"EPSG:4326\",\n    bbox=[-180.0, -80.0, 180.0, 50.0],\n    format=\"image/png\",\n    time=\"2011-12-01T00:00:00.000Z\"\n)\n\nImage(response.read())","key":"BGo7Bx3tLl"},{"type":"outputs","id":"hQFz2BqR9jnu_VER8hvAK","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"79b665e5bca4448c8d46196f43e41822","path":"/cci-toolbox-usage-viewers/build/79b665e5bca4448c8d46196f43e41822.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"bRIACUo0uJ"}],"key":"F3kE2SqlzO"}],"key":"BA9yUdT2Mi"}],"key":"m3IYShOqin"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Access to WCS data","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wcs-data","group":"Accessing Data"},"next":{"title":"Accessing Obs4MIPs and CMIP Data via ESGF","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf","group":"Accessing Data"}}},"domain":"http://localhost:3000"}