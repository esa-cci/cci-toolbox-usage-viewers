{"version":3,"kind":"Notebook","sha256":"03a6349fa0432db570e215e92674c15752b204a5a6f7c7eeaeb6a63e6cb07ae3","slug":"external-notebooks.esa-cci.esa-climate-toolbox.notebooks.accessing-data.ect-reading-wms-data","location":"/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","dependencies":[],"frontmatter":{"title":"Access to WMS data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","exports":[{"format":"ipynb","filename":"9-ECT_Reading_WMS_data.ipynb","url":"/cci-toolbox-usage-viewers/build/9-ECT_Reading_WMS_da-650e44b673b2cbf10c2a36f8ac4fca07.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The CEDA data server at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DYnbb5kLYp"},{"type":"link","url":"https://data.cci.ceda.ac.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​data​.cci​.ceda​.ac​.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M3LteZKq5n"}],"urlSource":"https://data.cci.ceda.ac.uk/","key":"psYikwiVqo"},{"type":"text","value":" provides access via the OGC Web Map Service (WMS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WMS from the CEDA server, using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dJSnNZNrHn"},{"type":"link","url":"https://www.osgeo.org/projects/owslib/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"OWSLib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NKQzURCjNp"}],"urlSource":"https://www.osgeo.org/projects/owslib/","key":"CfrzctXPx0"},{"type":"text","value":" as the client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q3K3jCWqYw"}],"key":"zgrxTK0lP7"}],"key":"ajRkFNb8fR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Koi4z1OFPv"},{"type":"inlineCode","value":"owslib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"PcMYu9pTam"},{"type":"text","value":" is not already installed in the Python environment, uncomment the following cell to install it with mamba.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qwpZBamEf5"}],"key":"rPIc5wSRnw"}],"key":"bARf9nfp2r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ! mamba install --yes owslib","key":"YU4iedZf7Z"},{"type":"outputs","id":"hMqhSeGcveFkVdeSOtkyX","children":[],"key":"UnLGSHfF6h"}],"key":"mEfFycbYyF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import some required libraries, including OWSLib as the WMS client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YG8ZAwmvam"}],"key":"b7EzVp4xUO"}],"key":"h56SPcQT9E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from owslib.wms import WebMapService\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\nfrom IPython.display import Image","key":"ftVnZaAXPj"},{"type":"outputs","id":"HjN8v_Hq5-B7XEZYuwj3i","children":[],"key":"yyHqn6Cz1j"}],"key":"AcJLRAK0WZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available ECVs.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MjqyOZZSGX"}],"key":"D3tNXKwdoV"}],"key":"KFINRhV8dk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list_ecvs()","key":"AhOiV665sP"},{"type":"outputs","id":"3ZQWIw3JkLL3Ic3IDlRUu","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"['SEASURFACESALINITY',\n 'BIOMASS',\n 'CLOUD',\n 'AEROSOL',\n 'VEGETATION',\n 'LST',\n 'LC',\n 'FIRE',\n 'LAKES',\n 'PERMAFROST',\n 'SEALEVEL',\n 'OZONE',\n 'WATERVAPOUR',\n 'ICESHEETS',\n 'OC',\n 'SEASTATE',\n 'SOILMOISTURE',\n 'SEAICE',\n 'GHG',\n 'SNOW',\n 'RD',\n 'SST']","content_type":"text/plain"}}},"children":[],"key":"fObN37PCjs"}],"key":"D0O7lj3J2w"}],"key":"mkOggDYN0L"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available datasets for the cloud ECV.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jlyLA2d3I7"}],"key":"YPnbeKfvey"}],"key":"mqNuZzsI5E"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"CLOUD\"))))","key":"wLMMMwsAv3"},{"type":"outputs","id":"HlH-qPBpWFV2Kqd0tfJkr","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Aqua.MODIS_AQUA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Terra.MODIS_TERRA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-AM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-PM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.MERIS-AATSR.2-0.r1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MODIS_AQUA-200208-201412-fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-ATSR2_AATSR-199506-201204-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_AM-199109-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_PM-198201-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MERIS-AATSR_ENVISAT-200301-201112_fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_NOAA-1982-2016-fv3.0.zarr\n"},"children":[],"key":"aZgXlzbpyf"}],"key":"FSdGQXnjcV"}],"key":"QuhBwE26Ng"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select a dataset from the list and store its name in a variable for use in the following steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fTJNAsCOkC"}],"key":"LgUaqLnI2v"}],"key":"UUGsWpcwBa"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_id = \"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\"","key":"AEKtAjOUHc"},{"type":"outputs","id":"saMhyJ4-H-19t0b7zZXPe","children":[],"key":"TYthYDb7x7"}],"key":"JQSHSU5JrZ"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a local representation of the WMS service for the selected dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lLyCxtObb5"}],"key":"auXvLz7B2Z"}],"key":"fVbMFDbAKP"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms_url = f\"https://data.cci.ceda.ac.uk/thredds/wms/{ds_id}?service=WMS&version=1.3.0\"\nwms = WebMapService(wms_url, version=\"1.3.0\", timeout=600)","key":"ThiF8UpV1e"},{"type":"outputs","id":"NPuOgoTS6gfzokXYCXeko","children":[],"key":"HjBOLDXbph"}],"key":"r2DFgisefK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the data variables available from this service.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V0a6CUDeqa"}],"key":"qSNsEhFWgP"}],"key":"jll9xm3QgT"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list(wms.contents)","key":"qwLEQUPRxL"},{"type":"outputs","id":"zPyw-DV6FRrPJH2z6cYMm","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"['nday',\n 'nday_low',\n 'nday_mid',\n 'nday_hig',\n 'nobs',\n 'nobs_day',\n 'nobs_clear_day',\n 'nobs_cloudy_day',\n 'nobs_clear_night',\n 'nobs_cloudy_night',\n 'nobs_clear_twl',\n 'nobs_cloudy_twl',\n 'nobs_cloudy',\n 'nretr_clear',\n 'nretr_cloudy',\n 'toa_swup',\n 'toa_swdn',\n 'toa_swup_clr',\n 'toa_lwup',\n 'toa_lwup_clr',\n 'toa_swup_low',\n 'toa_swup_mid',\n 'toa_swup_hig',\n 'toa_lwup_low',\n 'toa_lwup_mid',\n 'toa_lwup_hig',\n 'boa_swup',\n 'boa_swup_clr',\n 'boa_lwup',\n 'boa_lwup_clr',\n 'boa_swdn',\n 'boa_swdn_clr',\n 'boa_lwdn',\n 'boa_lwdn_clr',\n 'cee',\n 'cee_corr_unc',\n 'cee_prop_unc',\n 'cee_std',\n 'cee_unc',\n 'cer',\n 'cer_corr_unc',\n 'cer_ice',\n 'cer_ice_corr_unc',\n 'cer_ice_prop_unc',\n 'cer_ice_std',\n 'cer_ice_unc',\n 'cer_liq',\n 'cer_liq_corr_unc',\n 'cer_liq_prop_unc',\n 'cer_liq_std',\n 'cer_liq_unc',\n 'cer_prop_unc',\n 'cer_std',\n 'cer_unc',\n 'cfc',\n 'cfc_corr_unc',\n 'cfc_day',\n 'cfc_high',\n 'cfc_low',\n 'cfc_mid',\n 'cfc_night',\n 'cfc_prop_unc',\n 'cfc_std',\n 'cfc_twl',\n 'cfc_unc',\n 'cla_vis006',\n 'cla_vis006_corr_unc',\n 'cla_vis006_ice',\n 'cla_vis006_ice_std',\n 'cla_vis006_ice_unc',\n 'cla_vis006_liq',\n 'cla_vis006_liq_std',\n 'cla_vis006_liq_unc',\n 'cla_vis006_prop_unc',\n 'cla_vis006_std',\n 'cla_vis006_unc',\n 'cla_vis008',\n 'cla_vis008_corr_unc',\n 'cla_vis008_ice',\n 'cla_vis008_ice_std',\n 'cla_vis008_ice_unc',\n 'cla_vis008_liq',\n 'cla_vis008_liq_std',\n 'cla_vis008_liq_unc',\n 'cla_vis008_prop_unc',\n 'cla_vis008_std',\n 'cla_vis008_unc',\n 'cot',\n 'cot_corr_unc',\n 'cot_ice',\n 'cot_ice_corr_unc',\n 'cot_ice_prop_unc',\n 'cot_ice_std',\n 'cot_ice_unc',\n 'cot_liq',\n 'cot_liq_corr_unc',\n 'cot_liq_prop_unc',\n 'cot_liq_std',\n 'cot_liq_unc',\n 'cot_log',\n 'cot_prop_unc',\n 'cot_std',\n 'cot_unc',\n 'cph',\n 'cph_corr_unc',\n 'cph_day',\n 'cph_day_corr_unc',\n 'cph_day_prop_unc',\n 'cph_day_std',\n 'cph_day_unc',\n 'cph_prop_unc',\n 'cph_std',\n 'cph_unc',\n 'cth',\n 'cth_corr_unc',\n 'cth_corrected',\n 'cth_corrected_corr_unc',\n 'cth_corrected_prop_unc',\n 'cth_corrected_std',\n 'cth_corrected_unc',\n 'cth_prop_unc',\n 'cth_std',\n 'cth_unc',\n 'ctp',\n 'ctp_corr_unc',\n 'ctp_corrected',\n 'ctp_corrected_corr_unc',\n 'ctp_corrected_prop_unc',\n 'ctp_corrected_std',\n 'ctp_corrected_unc',\n 'ctp_log',\n 'ctp_prop_unc',\n 'ctp_std',\n 'ctp_unc',\n 'ctt',\n 'ctt_corr_unc',\n 'ctt_corrected',\n 'ctt_corrected_corr_unc',\n 'ctt_corrected_prop_unc',\n 'ctt_corrected_std',\n 'ctt_corrected_unc',\n 'ctt_prop_unc',\n 'ctt_std',\n 'ctt_unc',\n 'iwp',\n 'iwp_allsky',\n 'iwp_corr_unc',\n 'iwp_prop_unc',\n 'iwp_std',\n 'iwp_unc',\n 'lwp',\n 'lwp_allsky',\n 'lwp_corr_unc',\n 'lwp_prop_unc',\n 'lwp_std',\n 'lwp_unc',\n 'nretr_cloudy_day',\n 'nretr_cloudy_day_ice',\n 'nretr_cloudy_day_liq',\n 'nretr_cloudy_high',\n 'nretr_cloudy_ice',\n 'nretr_cloudy_liq',\n 'nretr_cloudy_low',\n 'nretr_cloudy_mid',\n 'stemp_clear',\n 'stemp_clear_corr_unc',\n 'stemp_clear_prop_unc',\n 'stemp_clear_std',\n 'stemp_clear_unc',\n 'stemp_cloudy',\n 'stemp_cloudy_corr_unc',\n 'stemp_cloudy_prop_unc',\n 'stemp_cloudy_std',\n 'stemp_cloudy_unc']","content_type":"text/plain"}}},"children":[],"key":"ENVNXBGlHr"}],"key":"IPCu7O9DUB"}],"key":"UpQBKCOrVG"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BYtlP5ECpB"},{"type":"inlineCode","value":"iwp","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DSkSNS6yCx"},{"type":"text","value":" (ice water path) variable from the list and store its name in a variable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VGyjlyv9SI"}],"key":"ETiPtDUcEL"}],"key":"gi2PhPMjOp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_id = \"iwp\"","key":"mIiNy7QZ4M"},{"type":"outputs","id":"a5GdaO5X1y-ebbTC2PnN3","children":[],"key":"LjdvgsrRZB"}],"key":"dfpOCh4eA9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check the bounding box for the selected dataset and variable; we can see that it is of global extent.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iA69Ti0iJS"}],"key":"b3PFvUkLuA"}],"key":"XIdLa1Uxq3"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms.contents[data_id].boundingBox","key":"iPqhv7qnjl"},{"type":"outputs","id":"DVSY8jCGv27k8H7lXlMCm","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"(-179.75, -89.75, 179.75, 89.75, 'CRS:84')","content_type":"text/plain"}}},"children":[],"key":"BQRL6gRjvL"}],"key":"oPmEDlLA7B"}],"key":"v4HJZ9pnKP"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check what times are available, filtering to the year 2011.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FG5i6s1E0c"}],"key":"aA5ovZnO9C"}],"key":"mzTy5feGSq"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[t for t in wms[data_id].timepositions if t.startswith(\"2011\")]","key":"nJpSk0q374"},{"type":"outputs","id":"KryMj0SCNWymVv9b-NxtP","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"['2011-01-01T00:00:00.000Z',\n '2011-02-01T00:00:00.000Z',\n '2011-03-01T00:00:00.000Z',\n '2011-04-01T00:00:00.000Z',\n '2011-05-01T00:00:00.000Z',\n '2011-06-01T00:00:00.000Z',\n '2011-07-01T00:00:00.000Z',\n '2011-08-01T00:00:00.000Z',\n '2011-09-01T00:00:00.000Z',\n '2011-10-01T00:00:00.000Z',\n '2011-11-01T00:00:00.000Z',\n '2011-12-01T00:00:00.000Z']","content_type":"text/plain"}}},"children":[],"key":"jd4aWfr0Hh"}],"key":"QlNypvTUnW"}],"key":"p96dLLJc0H"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Request a map for the chosen dataset and variable from the WMS server, selecting a time from the list above and a bounding box covering latitudes from 80°S to 50°N, then display the map in the notebook.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XsQSZLVfDY"}],"key":"wwZRSmeA8u"}],"key":"xI6vZRVuA2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"response = wms.getmap(\n    layers=[\"iwp\"],\n    styles=[\"boxfill/rainbow\"],\n    size=[800, 600],\n    srs=\"EPSG:4326\",\n    bbox=[-180.0, -80.0, 180.0, 50.0],\n    format=\"image/png\",\n    time=\"2011-12-01T00:00:00.000Z\"\n)\n\nImage(response.read())","key":"z1bE8SFAPx"},{"type":"outputs","id":"sAlwpOLIl20zNkp1u8j-b","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"79b665e5bca4448c8d46196f43e41822","path":"/cci-toolbox-usage-viewers/build/79b665e5bca4448c8d46196f43e41822.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"XsXvQSJ6lw"}],"key":"QsGMroyVh6"}],"key":"DnXRkvUpLu"}],"key":"SR97SRoU0G"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Access to WCS data","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-reading-wcs-data","group":"Accessing Data"},"next":{"title":"Accessing Obs4MIPs and CMIP Data via ESGF","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-esgf","group":"Accessing Data"}}},"domain":"http://localhost:3000"}