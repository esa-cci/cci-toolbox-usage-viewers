{"version":3,"kind":"Notebook","sha256":"cee3cc00592160d46263698a33a7725e5e788ca267957d9e199c5fdc1005b986","slug":"external-notebooks.esa-cci.esa-climate-toolbox.notebooks.advanced-functionality.ect-using-xcube-viewer","location":"/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Advanced_Functionality/1-ECT_Using_xcube_viewer.ipynb","dependencies":[],"frontmatter":{"title":"Using the ESA CCI Toolbox with the xcube Viewer","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Advanced_Functionality/1-ECT_Using_xcube_viewer.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Advanced_Functionality/1-ECT_Using_xcube_viewer.ipynb","exports":[{"format":"ipynb","filename":"1-ECT_Using_xcube_viewer.ipynb","url":"/cci-toolbox-usage-viewers/build/1-ECT_Using_xcube_vi-e932073b8af3033bd9a2fba35c797e3f.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Using the ESA CCI Toolbox with the xcube Viewer","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mdahkS73LR"}],"identifier":"using-the-esa-cci-toolbox-with-the-xcube-viewer","label":"Using the ESA CCI Toolbox with the xcube Viewer","html_id":"using-the-esa-cci-toolbox-with-the-xcube-viewer","implicit":true,"key":"udvLJFqsvB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The xcube viewer is an easy way to display gridded data. In this notebook, we show how the viewer can be started from a notebook and how cci datasets can be added to it.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GYAcVW3Z7g"}],"key":"XID1cJ7VkJ"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"To run this Notebook, make sure the ESA CCI Toolbox is setup correctly.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"n5qxAGTWoI"}],"key":"Tpcck4PJiy"}],"key":"Il1sAkq5fU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The viewer requires datasets. For this notebook, we will access them from the Zarr store and the regular store.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CYERaMDBmW"}],"key":"YjlDdKtLBj"}],"key":"ss9j0yVmfd"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from xcube.core.store import new_data_store\n\nzarr_store = new_data_store('esa-cci-zarr')\ncci_store = new_data_store('esa-cci')","visibility":"show","key":"AFIjsl3NWU"},{"type":"outputs","id":"r-Jy914z2KOOUUH0yr_0X","children":[],"visibility":"show","key":"GgMx5khPCn"}],"visibility":"show","key":"R9MBbIUEta"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If you want, you can execute the following lines to see which datasets are available. For now, this part is in a comment as we do not want to print all the datasets for reasons of readability.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p3qRMC4Tvt"}],"key":"tEy5Dng36R"}],"key":"Ca1bypSPnk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# zarr_store.list_data_ids()","key":"XTkBBX76FD"},{"type":"outputs","id":"O0TQpI3KMsIeRHj2TuHeV","children":[],"key":"bzwM8fgSJB"}],"key":"fuqbxQw6sf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# cci_store.list_data_ids()","key":"dPPyfz4n6p"},{"type":"outputs","id":"rTeXbguG3UKpIEtkCPJCR","children":[],"key":"TDBmCuQgBA"}],"key":"Vmoaxo5J5u"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"From the Zarr store, we pick a snow dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lw0ZplVkO7"}],"key":"CkPYJNST9x"}],"key":"tc1d23hU4b"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"snow_ds = zarr_store.open_data('ESACCI-L3C_SNOW-SWE-1979-2020-fv2.0.zarr')\nsnow_ds","key":"kRVQaanOvP"},{"type":"outputs","id":"jOdZrZolkg4h3a795UtWL","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d295d0dadd965dae56eb792a92dd8b72","path":"/cci-toolbox-usage-viewers/build/d295d0dadd965dae56eb792a92dd8b72.html"},"text/plain":{"content":"<xarray.Dataset> Size: 823GB\nDimensions:   (lat: 1800, nv: 2, lon: 3600, time: 7934)\nCoordinates:\n  * lat       (lat) float64 14kB -89.95 -89.85 -89.75 ... 89.75 89.85 89.95\n    lat_bnds  (lat, nv) float64 29kB dask.array<chunksize=(900, 2), meta=np.ndarray>\n  * lon       (lon) float64 29kB -179.9 -179.8 -179.8 ... 179.7 179.8 179.9\n    lon_bnds  (lon, nv) float64 58kB dask.array<chunksize=(900, 2), meta=np.ndarray>\n  * time      (time) datetime64[ns] 63kB 1979-01-02 1979-01-04 ... 2020-05-24\nDimensions without coordinates: nv\nData variables:\n    swe       (time, lat, lon) float64 411GB dask.array<chunksize=(10, 900, 900), meta=np.ndarray>\n    swe_std   (time, lat, lon) float64 411GB dask.array<chunksize=(10, 900, 900), meta=np.ndarray>\nAttributes: (12/43)\n    Conventions:                CF-1.9\n    cdm_data_type:              grid\n    comment:                    The following auxiliary datasets are used for...\n    creator_email:              kari.luojus@fmi.fi (Scientific and Production...\n    creator_name:               Finnish Meteorological Institute\n    creator_url:                www.fmi.fi\n    ...                         ...\n    time_coverage_duration:     P1D\n    time_coverage_end:          20200524T000000Z\n    time_coverage_resolution:   P1D\n    time_coverage_start:        19790102T000000Z\n    title:                      ESA CCI snow SWE product level L3C daily, Dyn...\n    tracking_id:                25063fb5-47ad-424a-8f26-29bdf35efb78","content_type":"text/plain"}}},"children":[],"key":"YWmrkCOudF"}],"key":"tSqf52iUtF"}],"key":"KeOEmo2AMR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"From the cci store, we pick an aerosol dataset. However, let’s just use a subset here, to see how it will look in the viewer.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xXyRGJfRvG"}],"key":"LdezGWltHc"}],"key":"QPFJZIActf"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"x1 = -23.40  # degree\ny1 = -40.40  # degree\nx2 = 57.40  # degree\ny2 = 40.40  # degree\nbbox = (x1, y1, x2, y2)\n\naerosol_ds = cci_store.open_data(\n    'esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1',\n    variable_names=['absorbing_aerosol_index'],\n    bbox=bbox,\n    time_range=['2005-01-01', '2005-12-31']\n)\naerosol_ds","key":"xn9Tv8lHkK"},{"type":"outputs","id":"IXlCCayWhyW0IWFOy3pIo","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"da13c234527d204c942e478ff36ebc21","path":"/cci-toolbox-usage-viewers/build/da13c234527d204c942e478ff36ebc21.html"},"text/plain":{"content":"<xarray.Dataset> Size: 308kB\nDimensions:                  (time: 12, lat: 80, lon: 80, bnds: 2)\nCoordinates:\n  * lat                      (lat) float32 320B -39.5 -38.5 -37.5 ... 38.5 39.5\n  * lon                      (lon) float32 320B -22.5 -21.5 -20.5 ... 55.5 56.5\n  * time                     (time) datetime64[ns] 96B 2005-01-16T12:00:00 .....\n    time_bnds                (time, bnds) datetime64[ns] 192B dask.array<chunksize=(12, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    absorbing_aerosol_index  (time, lat, lon) float32 307kB dask.array<chunksize=(1, 80, 80), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-pla...\n    date_created:            2025-12-04T11:52:18.378325\n    processing_level:        L3\n    time_coverage_start:     2005-01-01T00:00:00\n    time_coverage_end:       2006-01-01T00:00:00\n    time_coverage_duration:  P365DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"Nu13QBIaeT"}],"key":"iD7Ofm4UgK"}],"key":"RqSFiP1M8G"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now that we have the datasets assembled, we can start the viewer. We import it from xcube like this:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uBDTwv9jmk"}],"key":"agG9UjWobL"}],"key":"SjstYpAPQW"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from xcube.webapi.viewer import Viewer","key":"SLupkerAlc"},{"type":"outputs","id":"-XMvb4yC54_Ku6qxvRfTk","children":[],"key":"UKCbGztjMt"}],"key":"boR4grdUxM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"viewer = Viewer()","key":"tUKgivywxI"},{"type":"outputs","id":"CovpMjS4kSSRj6QqBiNfx","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"404 GET /viewer/config/config.json (127.0.0.1): xcube viewer has not been been configured\n404 GET /viewer/config/config.json (127.0.0.1) 11.21ms\n501 GET /viewer/state?key=sentinel (127.0.0.1) 0.27ms\n404 GET /viewer/ext/contributions (127.0.0.1) 0.32ms\n"},"children":[],"key":"MR3023yZvp"}],"key":"gaos3H3EAJ"}],"key":"ud7yswxCkF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, we add the datasets.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UlcZsvcVKL"}],"key":"vEK3BhuMLd"}],"key":"Vkj4BFrvgr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"viewer.add_dataset(snow_ds)","key":"LM3jBrYw49"},{"type":"outputs","id":"g_2JFkf4k8VKssAfehRdT","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/plain":{"content":"'63622925-cb47-4e27-9346-0d0acc930130'","content_type":"text/plain"}}},"children":[],"key":"x8Tp6lkuxb"}],"key":"VZFaWmMH7p"}],"key":"rsmhu3dcNM"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"viewer.add_dataset(aerosol_ds)","key":"wSyrgFPBaq"},{"type":"outputs","id":"Uf_xAT8uzKfURaPFgBbn9","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"'5c042aa5-b2de-47db-b7af-2051191afb16'","content_type":"text/plain"}}},"children":[],"key":"C5w9Vz2Jtf"}],"key":"QTWT3CaDNU"}],"key":"eP7hGzi662"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now that the viewer is set up, we can ask for information about it. With the following command, we get the links for the server and the viewer. The server is responsible for serving the datasets. You may take the link and use it with any running viewer. However, it is directly plugged into the viewer instance which you can open from its link.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lbEwGEwbhz"}],"key":"mx7Pi3IIH4"}],"key":"OBzQUxyBvI"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"viewer.info()","key":"mU1VFEUvF2"},{"type":"outputs","id":"65MG4SZVnszdL9kimdqRR","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Server: http://localhost:8000\nViewer: http://localhost:8000/viewer/?serverUrl=http://localhost:8000\n"},"children":[],"key":"GDGvK9rDU1"}],"key":"FZc0vFWNbZ"}],"key":"bmcg0hAYMb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Alternatively, you can open the viewer in a notebook cell:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UK4sRhelig"}],"key":"jTYhafDqTx"}],"key":"WdCxuc93xO"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"viewer.show()","key":"hFtNhiqGQT"},{"type":"outputs","id":"GBcSx_yjVbadKksT0jOgZ","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content":"<iframe src=\"http://localhost:8000/viewer/?serverUrl=http://localhost:8000&compact=0\" width=\"100%\" height=\"800\"/>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},"children":[],"key":"ZZwNo0ofB4"}],"key":"g37pCvCg6O"}],"key":"buwdBrMeJU"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"... and there you go. You can learn more about the usage of the viewer here: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wGQXf1Eg6a"},{"type":"link","url":"https://xcube.readthedocs.io/en/latest/viewer.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​xcube​.readthedocs​.io​/en​/latest​/viewer​.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"icML9wgE5w"}],"urlSource":"https://xcube.readthedocs.io/en/latest/viewer.html","key":"QoZhPjRgBG"},{"type":"text","value":" . You may add any datasets, but not geodataframes or vector data cubes. To keep the viewer usable, we advise against adding too many or too large datasets.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mE47en0YVy"}],"key":"q4Dgrphgiq"}],"key":"EHkSIgZkke"}],"key":"SGisZpecio"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"ESA CCI Toolbox Data Tree Access","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/accessing-data/ect-access-data-trees","group":"Accessing Data"},"next":{"title":"Failure reporting in the ESA Climate Toolbox","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/advanced-functionality/ect-failure-reporting","group":"Advanced Functionality"}}},"domain":"http://localhost:3000"}