{"version":3,"kind":"Notebook","sha256":"63cd119d469461752c1da088d31d8de8773f505a0757f722fe8a81e2788938dc","slug":"external-notebooks.esa-cci.esa-climate-toolbox.notebooks.using-operations.ect-reprojecting-data","location":"/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/3-ECT_Reprojecting_Data.ipynb","dependencies":[],"frontmatter":{"title":"ESA CCI Toolbox Reproject Dataset","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/3-ECT_Reprojecting_Data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/3-ECT_Reprojecting_Data.ipynb","exports":[{"format":"ipynb","filename":"3-ECT_Reprojecting_Data.ipynb","url":"/cci-toolbox-usage-viewers/build/3-ECT_Reprojecting_D-61427b7105df48804e8b5e5645a09319.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ESA CCI Toolbox Reproject Dataset","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IAL52sqEiU"}],"identifier":"esa-cci-toolbox-reproject-dataset","label":"ESA CCI Toolbox Reproject Dataset","html_id":"esa-cci-toolbox-reproject-dataset","implicit":true,"key":"JzlA23PCzE"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The purpose of this notebook is to demonstrate how to access a dataset, resample it to different coordinates, and reproject it to a new coordinate reference system (CRS).","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cCP9b55MUz"}],"key":"ldKTkOGyqy"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"To run this Notebook, make sure the ESA CCI Toolbox is setup correctly.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"TUKRlENLCs"}],"key":"i6nR2cgXI9"}],"key":"mbxBGhaJyq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The ESA CCI Toolbox is built on xcube, leveraging many of its functionalities in this notebook. For additional examples on resampling and reprojection, visit the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g2jC2iSMPH"},{"type":"link","url":"https://github.com/xcube-dev/xcube/tree/main/examples/notebooks/resampling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"xcube GitHub repository","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Xfvz8sOIWg"}],"urlSource":"https://github.com/xcube-dev/xcube/tree/main/examples/notebooks/resampling","error":true,"key":"odKBrKBMgM"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YHNYzR7dQu"}],"key":"OhMrEuGjUs"}],"key":"jWHnVhvXVr"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom xcube.core.store import new_data_store","visibility":"show","key":"jRJ4FDbM7W"},{"type":"outputs","id":"w8cjXzudZiaefCkdKExgF","children":[],"visibility":"show","key":"IszlKDlEb5"}],"visibility":"show","key":"YPnYM9hVRo"},{"type":"block","kind":"notebook-content","children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jDMr2ek9BY"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Reproject Dataset from ESA Open Data Portal","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yBnjM7kVtm"}],"identifier":"reproject-dataset-from-esa-open-data-portal","label":"Reproject Dataset from ESA Open Data Portal","html_id":"reproject-dataset-from-esa-open-data-portal","implicit":true,"key":"nLRaXcgemi"}],"key":"kgyXiFzIQK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To access datasets from the ESA Open Data Portal store, we begin by initializing a new data store using the store ID ‘esa-cci’.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"st085Bcjin"}],"key":"aMjcJoEIp9"}],"key":"Bg8FPdtXd8"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cci_store = new_data_store('esa-cci')","visibility":"show","key":"ira2gksFEQ"},{"type":"outputs","id":"e4x_SAdrcqRurJ6MI9PA4","children":[],"visibility":"show","key":"HYbop39bW9"}],"visibility":"show","key":"inkm62LY3Z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"All provided data are datasets. So, let’s have a look what data sets are available.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EqwIAqfEiN"}],"key":"cxl7miTfAM"}],"key":"wiuruaMP0C"},{"type":"block","kind":"notebook-code","data":{"scrolled":true,"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"datasets = cci_store.list_data_ids()\ndatasets","visibility":"show","key":"Xh4PBiXLoG"},{"type":"outputs","id":"JvOcOIezRmCCzcjEaiMgE","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content_type":"text/plain","hash":"db955daaec7296ef976655e853118458","path":"/cci-toolbox-usage-viewers/build/db955daaec7296ef976655e853118458.txt"}}},"children":[],"key":"YWoqYymGjy"}],"visibility":"show","key":"otKMTvIT6X"}],"visibility":"show","key":"Obu6rSWLNp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We would like to reproject Aerosol CCI product. But first we view the available opening parameters for the respective dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MqecZQdqrM"}],"key":"WXHOeajVt5"}],"key":"fmdlACO8Hz"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cci_store.get_open_data_params_schema(\n    data_id=\"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\"    \n)","visibility":"show","key":"RUldim3mdR"},{"type":"outputs","id":"m_ce0i5AnKPtxBOOothov","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"application/json":{"content":"{\"additionalProperties\":false,\"properties\":{\"bbox\":{\"items\":[{\"maximum\":180,\"minimum\":-180,\"type\":\"number\"},{\"maximum\":90,\"minimum\":-90,\"type\":\"number\"},{\"maximum\":180,\"minimum\":-180,\"type\":\"number\"},{\"maximum\":90,\"minimum\":-90,\"type\":\"number\"}],\"type\":\"array\"},\"normalize_data\":{\"default\":true,\"type\":\"boolean\"},\"time_range\":{\"items\":[{\"format\":\"date\",\"maxDate\":\"2015-12-31\",\"minDate\":\"1978-11-01\",\"type\":\"string\"},{\"format\":\"date\",\"maxDate\":\"2015-12-31\",\"minDate\":\"1978-11-01\",\"type\":\"string\"}],\"type\":\"array\"},\"variable_names\":{\"items\":{\"enum\":[\"absorbing_aerosol_index\",\"number_of_observations\",\"solar_zenith_angle\",\"positive_absorbing_aerosol_index\",\"number_of_positive_observations\"],\"type\":\"string\"},\"type\":\"array\"}},\"type\":\"object\"}","content_type":"application/json"},"text/plain":{"content":"<xcube.util.jsonschema.JsonObjectSchema at 0x70d8cab709f0>","content_type":"text/plain"}}},"children":[],"key":"o5JCeXwF1R"}],"visibility":"show","key":"UqIlBBc3HF"}],"visibility":"show","key":"S7O3ZVoUPh"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we can open the dataset and select a subset which covers Europe and the last half year of the data.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"McqKKNEm2M"}],"key":"HJNrtfZ8Ab"}],"key":"hHKXBzv4ml"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds = cci_store.open_data(\n    \"esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-platform.MSAAI.1-7.r1\",\n    time_range=[\"2015-07-01\", \"2015-12-31\"],\n    bbox=[0, 45, 20, 60]\n)\nds","visibility":"show","key":"uNPL8bCMMQ"},{"type":"outputs","id":"YxRRDfd1AmiryGNwT1sJc","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"dfd64ee4dd7131cb72b0aaa39c8e0906","path":"/cci-toolbox-usage-viewers/build/dfd64ee4dd7131cb72b0aaa39c8e0906.html"},"text/plain":{"content":"<xarray.Dataset> Size: 51kB\nDimensions:                           (time: 6, lat: 15, lon: 20, bnds: 2)\nCoordinates:\n  * lat                               (lat) float32 60B 45.5 46.5 ... 58.5 59.5\n  * lon                               (lon) float32 80B 0.5 1.5 ... 18.5 19.5\n  * time                              (time) datetime64[ns] 48B 2015-07-16T12...\n    time_bnds                         (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    absorbing_aerosol_index           (time, lat, lon) float32 7kB dask.array<chunksize=(1, 15, 20), meta=np.ndarray>\n    number_of_observations            (time, lat, lon) float64 14kB dask.array<chunksize=(1, 15, 20), meta=np.ndarray>\n    number_of_positive_observations   (time, lat, lon) float64 14kB dask.array<chunksize=(1, 15, 20), meta=np.ndarray>\n    positive_absorbing_aerosol_index  (time, lat, lon) float32 7kB dask.array<chunksize=(1, 15, 20), meta=np.ndarray>\n    solar_zenith_angle                (time, lat, lon) float32 7kB dask.array<chunksize=(1, 15, 20), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-pla...\n    date_created:            2025-12-08T12:14:17.027657\n    processing_level:        L3\n    time_coverage_start:     2015-07-01T00:00:00\n    time_coverage_end:       2016-01-01T00:00:00\n    time_coverage_duration:  P184DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"GwRUpEHxoe"}],"visibility":"show","key":"o6S6qQ8TBq"}],"visibility":"show","key":"HLFDu1Gpwq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can plot the absorbing aerosol index in the original projection before reprojecting it.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HkCWCCfm8w"}],"key":"z8b1DkS2Te"}],"key":"wns8qjh6ZJ"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds.absorbing_aerosol_index.isel(time=-1).plot()","key":"Edh9SK68Ms"},{"type":"outputs","id":"AaLJc3CXkk8sORi6jHkwO","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"7650b040fa6c6041f952e14b4066926c","path":"/cci-toolbox-usage-viewers/build/7650b040fa6c6041f952e14b4066926c.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"tOClRFsPp8"}],"key":"b4gfVtTFs0"}],"key":"igvKgFl6rW"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now, we can reproject the dataset from the original Geographic Coordinate System (EPSG:4326 - WGS 84) to the European Terrestrial Reference System 1989 ensemble (EPSG:3035). To achieve this, we first create a grid mapping that defines the target projection, which is then used to reproject the dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oj1WbFIiu8"}],"key":"zcJVxljI6V"}],"key":"f0ZdTJLvgt"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"source_gm = GridMapping.from_dataset(ds)\ntemp_target_gm = source_gm.transform(\"EPSG:3035\", xy_res=10000)\ntarget_gm = temp_target_gm.to_regular()\ntarget_gm","key":"TWVJ2L66Ki"},{"type":"outputs","id":"kRqkC6F2hW3rt3ja54QxT","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/markdown":{"content":"class: **RegularGridMapping**\n* is_regular: True\n* is_j_axis_up: False\n* is_lon_360: False\n* crs: EPSG:3035\n* xy_res: (10000, 10000)\n* xy_bbox: (3528853, 2427033, 5118853, 4157033)\n* ij_bbox: (0, 0, 159, 173)\n* xy_dim_names: ('x', 'y')\n* xy_var_names: ('x', 'y')\n* size: (159, 173)\n* tile_size: (20, 15)","content_type":"text/markdown"},"text/plain":{"content":"<xcube.core.gridmapping.regular.RegularGridMapping at 0x70d8c8b57c50>","content_type":"text/plain"}}},"children":[],"key":"HEFZ4ywTCZ"}],"key":"p1YQoPcu27"}],"key":"leFdC4uUfG"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_reproject = resample_in_space(\n    ds,\n    source_gm=source_gm,\n    target_gm=target_gm,\n)\nds_reproject","key":"dUzjTAblx9"},{"type":"outputs","id":"UWS2ZcZ6qi3Eh7wzKBWe7","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"d0766bff43868cf7726c5d54b8d4660f","path":"/cci-toolbox-usage-viewers/build/d0766bff43868cf7726c5d54b8d4660f.html"},"text/plain":{"content":"<xarray.Dataset> Size: 5MB\nDimensions:                           (time: 6, y: 173, x: 159, bnds: 2)\nCoordinates:\n  * time                              (time) datetime64[ns] 48B 2015-07-16T12...\n  * y                                 (y) float64 1kB 4.152e+06 ... 2.432e+06\n  * x                                 (x) float64 1kB 3.534e+06 ... 5.114e+06\n    x_bnds                            (x, bnds) float64 3kB 3.529e+06 ... 5.1...\n    y_bnds                            (y, bnds) float64 3kB 4.157e+06 ... 2.4...\nDimensions without coordinates: bnds\nData variables:\n    absorbing_aerosol_index           (time, y, x) float32 660kB dask.array<chunksize=(6, 15, 20), meta=np.ndarray>\n    number_of_observations            (time, y, x) float64 1MB dask.array<chunksize=(6, 15, 20), meta=np.ndarray>\n    number_of_positive_observations   (time, y, x) float64 1MB dask.array<chunksize=(6, 15, 20), meta=np.ndarray>\n    positive_absorbing_aerosol_index  (time, y, x) float32 660kB dask.array<chunksize=(6, 15, 20), meta=np.ndarray>\n    solar_zenith_angle                (time, y, x) float32 660kB dask.array<chunksize=(6, 15, 20), meta=np.ndarray>\n    crs                               int64 8B 0\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.AEROSOL.mon.L3.AAI.multi-sensor.multi-pla...\n    date_created:            2025-12-08T12:14:17.027657\n    processing_level:        L3\n    time_coverage_start:     2015-07-01T00:00:00\n    time_coverage_end:       2016-01-01T00:00:00\n    time_coverage_duration:  P184DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"ue6XqPi2j5"}],"key":"HN57dI6hBY"}],"key":"u6W2X5DXTr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we can plot the reprojected dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hf0JPs8b99"}],"key":"r16OK3WC2B"}],"key":"A57KoXe47a"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_reproject.absorbing_aerosol_index.isel(time=-1).plot()","key":"ZpMjoo7Vhy"},{"type":"outputs","id":"NDq46Ih6Own24TCCn16va","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"fd6073a615315895ce2fc5bbd9f2f90f","path":"/cci-toolbox-usage-viewers/build/fd6073a615315895ce2fc5bbd9f2f90f.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"ohFdS2Ifmn"}],"key":"Oifqgs85oe"}],"key":"T2Y8BCfEAg"}],"key":"FIRM7zwu37"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Usage of Operations","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-using-operations","group":"Using Operations"},"next":{"title":"Filter Operations","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-filtering-data","group":"Using Operations"}}},"domain":"http://localhost:3000"}