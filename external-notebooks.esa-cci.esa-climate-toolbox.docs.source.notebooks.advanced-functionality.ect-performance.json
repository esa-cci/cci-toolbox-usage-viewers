{"version":3,"kind":"Notebook","sha256":"76450b44c128f2987daf03a87442af041c8d9e13dc828b29636a97e9e818784b","slug":"external-notebooks.esa-cci.esa-climate-toolbox.docs.source.notebooks.advanced-functionality.ect-performance","location":"/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Advanced_Functionality/3-ECT_Performance.ipynb","dependencies":[],"frontmatter":{"title":"Performance tests","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Advanced_Functionality/3-ECT_Performance.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Advanced_Functionality/3-ECT_Performance.ipynb","exports":[{"format":"ipynb","filename":"3-ECT_Performance.ipynb","url":"/cci-toolbox-usage-viewers/build/3-ECT_Performance-02740057c25a985371256ccd296242d3.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook makes some time measurements of climate toolbox operations.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dxZPbVUt7G"}],"key":"jaxXzpjmzr"}],"key":"QFblu0Aba4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import some necessary libraries.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WYDSTwi2yn"}],"key":"HJxVcm0hAk"}],"key":"ugOuCyTsj2"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import xarray as xr\nfrom xcube.core.gridmapping import GridMapping\nfrom xcube.core.resampling import resample_in_space\nfrom esa_climate_toolbox.core import find_data_store, get_store, list_datasets\n%matplotlib inline\nimport matplotlib.pyplot as plt","key":"mbWG1g31na"},{"type":"outputs","id":"kFuXEt5L-Wwyf85XPEMLu","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"<frozen abc>:106: FutureWarning: xarray subclass VectorDataCube should explicitly define __slots__\n"},"children":[],"key":"TeosUSdAKk"}],"key":"tJYyBP72mS"}],"key":"uFHudv8egX"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select a suitable dataset of global extent for the tests.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T4zDJsl5Vn"}],"key":"OOvrdJ6ENI"}],"key":"d3MsXkyqNo"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"dsname = \"esacci.LST.yr.L3C.LST.multi-sensor.multi-platform.SSMI_SSMIS.v2-33.ASC\"","key":"CDPAdJWWoT"},{"type":"outputs","id":"gb43ea73dxRTlRhDW5_PS","children":[],"key":"ffy4VRoEV1"}],"key":"XSxgTPPjKb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Find the store that contains the dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eYwUP21y9F"}],"key":"gpRqk7H99z"}],"key":"WeovYv7dDU"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"store_name, store = find_data_store(ds_id=dsname)","key":"LaRhZ6t7Xq"},{"type":"outputs","id":"C26so51Db6SCSKBl8w9Gu","children":[],"key":"Bk40OsfTsH"}],"key":"KDPUgxXRPy"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check the accepted parameters for opening this dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o9YAExJXY6"}],"key":"iK6mapYiBH"}],"key":"xKey1TSAHY"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"store.get_open_data_params_schema(dsname)","key":"cL8lAE1nEi"},{"type":"outputs","id":"XCeTzrtWDKXZUJrK9SQ3q","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"application/json":{"content":"{\"additionalProperties\":false,\"properties\":{\"bbox\":{\"items\":[{\"maximum\":180,\"minimum\":-180,\"type\":\"number\"},{\"maximum\":90,\"minimum\":-90,\"type\":\"number\"},{\"maximum\":180,\"minimum\":-180,\"type\":\"number\"},{\"maximum\":90,\"minimum\":-90,\"type\":\"number\"}],\"type\":\"array\"},\"normalize_data\":{\"default\":true,\"type\":\"boolean\"},\"time_range\":{\"items\":[{\"format\":\"date\",\"maxDate\":\"2020-12-31\",\"minDate\":\"1996-01-01\",\"type\":\"string\"},{\"format\":\"date\",\"maxDate\":\"2020-12-31\",\"minDate\":\"1996-01-01\",\"type\":\"string\"}],\"type\":\"array\"},\"variable_names\":{\"items\":{\"enum\":[\"dtime\",\"satze\",\"sataz\",\"solze\",\"solaz\",\"lst\",\"lst_uncertainty\",\"n\",\"qual_flag\",\"lst_unc_ran\",\"lst_unc_loc_atm\",\"lst_unc_loc_sfc\",\"lst_unc_sys\",\"lst_time_correction\",\"lst_unc_time_correction\"],\"type\":\"string\"},\"type\":\"array\"}},\"type\":\"object\"}","content_type":"application/json"},"text/plain":{"content":"<xcube.util.jsonschema.JsonObjectSchema at 0x7f06d5ea94f0>","content_type":"text/plain"}}},"children":[],"key":"Ppcf8IkCKv"}],"key":"CfZwvCRwWN"}],"key":"G36GDmnqsp"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open a dataset for the full global extent and the year 2020, containing the variables ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"g8LT31wqTt"},{"type":"inlineCode","value":"lst","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YNpKxxAxpn"},{"type":"text","value":" and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aPr3xzYDyF"},{"type":"inlineCode","value":"lst_uncertainty","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"O9pMEupY0I"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FNiX6yE4WR"}],"key":"lktolVvdlq"}],"key":"zDw7dgnA3r"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds = store.open_data(\n    dsname,\n    variable_names=[\"lst\", \"lst_uncertainty\"],\n    time_range=[\"2020-01-01\", \"2020-12-31\"],\n    bbox=[-180, -90, 180, 90]\n)","key":"W1PG2i97UQ"},{"type":"outputs","id":"SikPvHodwZ0CAYayhS1QS","children":[],"key":"pE80YNndUV"}],"key":"H9q75iOg0Z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show the dataset’s metadata.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"snJlbtGYs9"}],"key":"ueNU1q2tc5"}],"key":"RmcGFzv9sl"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds","key":"Rr9k8aoZ2v"},{"type":"outputs","id":"yfK-eQlbsZQs1HYqOKI0-","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"ed866249511ebcc175452114f1f330cc","path":"/cci-toolbox-usage-viewers/build/ed866249511ebcc175452114f1f330cc.html"},"text/plain":{"content":"<xarray.Dataset> Size: 17MB\nDimensions:          (lat: 720, lon: 1440, time: 1, bnds: 2)\nCoordinates:\n  * lat              (lat) float32 3kB -89.88 -89.62 -89.38 ... 89.62 89.88\n  * lon              (lon) float32 6kB -179.9 -179.6 -179.4 ... 179.6 179.9\n  * time             (time) datetime64[ns] 8B 2020-07-02\n    time_bnds        (time, bnds) datetime64[ns] 16B dask.array<chunksize=(1, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    lst              (time, lat, lon) float64 8MB dask.array<chunksize=(1, 720, 1440), meta=np.ndarray>\n    lst_uncertainty  (time, lat, lon) float64 8MB dask.array<chunksize=(1, 720, 1440), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.LST.yr.L3C.LST.multi-sensor.multi-platfor...\n    date_created:            2025-03-26T17:27:59.946056\n    processing_level:        L3C\n    time_coverage_start:     2020-01-01T00:00:00\n    time_coverage_end:       2021-01-01T00:00:00\n    time_coverage_duration:  P366DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"Kwg2FYc1eC"}],"key":"qVC9itnOJl"}],"key":"iW7X0Wq7rR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For demonstration and testing purposes, resample the dataset to a higher resolution, corresponding to a cell size of slightly under 10 × 10 km at the equator. (Longitudinal resolution increases with increasing latitude.)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nNoD8NLW4H"}],"key":"P0GxtOIIAa"}],"key":"BfkEMbdlIz"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"source_gm = GridMapping.from_dataset(ds)","key":"vFgv7AUea2"},{"type":"outputs","id":"cmvhW3nRP_a6boS6LI0Vd","children":[],"key":"Xc8DNroFAU"}],"key":"cFKmN5Zp3x"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"target_gm = source_gm.scale(3)","key":"rWz1n6x3cj"},{"type":"outputs","id":"NWMN7rBASxZuRKHMDBIBN","children":[],"key":"I4azrD8d5H"}],"key":"IFbP5WE0Vy"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_resampled = resample_in_space(ds, source_gm=source_gm, target_gm=target_gm)","key":"csxYp0aDEb"},{"type":"outputs","id":"PU12KgdXXAfPd_k5RMLDs","children":[],"key":"g5S3xNTspY"}],"key":"DMfO57Jmyk"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_resampled","key":"yjsvBoHvwS"},{"type":"outputs","id":"5tQ8YgiMpwJdHFBIL54w7","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"fb35c61d0b53df08d8679f388c25e06d","path":"/cci-toolbox-usage-viewers/build/fb35c61d0b53df08d8679f388c25e06d.html"},"text/plain":{"content":"<xarray.Dataset> Size: 149MB\nDimensions:          (time: 1, lat: 2160, lon: 4320, bnds: 2)\nCoordinates:\n  * time             (time) datetime64[ns] 8B 2020-07-02\n    time_bnds        (time, bnds) datetime64[ns] 16B dask.array<chunksize=(1, 2), meta=np.ndarray>\n  * lon              (lon) float64 35kB -180.0 -179.9 -179.8 ... 179.9 180.0\n  * lat              (lat) float64 17kB -89.96 -89.88 -89.79 ... 89.87 89.96\nDimensions without coordinates: bnds\nData variables:\n    lst              (time, lat, lon) float64 75MB dask.array<chunksize=(1, 720, 1440), meta=np.ndarray>\n    lst_uncertainty  (time, lat, lon) float64 75MB dask.array<chunksize=(1, 720, 1440), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.LST.yr.L3C.LST.multi-sensor.multi-platfor...\n    date_created:            2025-03-26T17:27:59.946056\n    processing_level:        L3C\n    time_coverage_start:     2020-01-01T00:00:00\n    time_coverage_end:       2021-01-01T00:00:00\n    time_coverage_duration:  P366DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"GmV7PqcNvg"}],"key":"H7c2ug7ldU"}],"key":"YuFgvX7b9z"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write the dataset to a Zarr archive in local storage, in the same directory as this notebook.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"u1RJRLZ6I2"}],"key":"DsGVJwf9mL"}],"key":"Lj8xUZyneS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"zarr_path = \"lst-global-10km.zarr\"\nds_resampled.to_zarr(zarr_path, mode=\"w\")","key":"Qiveza9QOe"},{"type":"outputs","id":"8SL0JW0S_mk5twhZqLewD","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/plain":{"content":"<xarray.backends.zarr.ZarrStore at 0x7f06d5f020c0>","content_type":"text/plain"}}},"children":[],"key":"RJMedzNOo5"}],"key":"YYg1toJi5F"}],"key":"bCEmBcTOXd"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Measure and display the time required to ingest the data from Zarr into an xarray dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VoLyhpATG5"}],"key":"Xxhy4WlMij"}],"key":"mIQEfJhvGs"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nds_zarr = xr.open_zarr(zarr_path)","key":"amqwYD7dDT"},{"type":"outputs","id":"zDSccHUw6Je11wTy2aHb1","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 17.5 ms, sys: 113 μs, total: 17.6 ms\nWall time: 15.9 ms\n"},"children":[],"key":"ssF89s13F5"}],"key":"tC6iVxFlvQ"}],"key":"m3gtukv7Zu"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Measure and display the time required to apply a dummy algorithm (doubling all values) to the ingested dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yNDsBEivJQ"}],"key":"mGRZVs7tuD"}],"key":"VGrETuF6VF"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nds_processed = ds_zarr + ds_zarr","key":"zrPateDO8o"},{"type":"outputs","id":"yItu3W91Wx3ROGiotFsv9","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 4.36 ms, sys: 28 μs, total: 4.39 ms\nWall time: 4.33 ms\n"},"children":[],"key":"k8tBYIBO9N"}],"key":"cfTzGzhZ4L"}],"key":"Yk47wSsJ6X"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Measure and display the time required to plot the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JFjhDhHEnu"},{"type":"inlineCode","value":"lst","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WCdI4NrKIY"},{"type":"text","value":" variable of the ingested and processed dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sUf0XP7iCE"}],"key":"GyeZWPX8R1"}],"key":"kORGKSuNvS"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"%%time\nds_processed.squeeze().lst.plot.imshow()","key":"oNOyAm4ViG"},{"type":"outputs","id":"NizUt2EgGtnsy8t6S3dKt","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"CPU times: user 287 ms, sys: 125 ms, total: 411 ms\nWall time: 250 ms\n"},"children":[],"key":"ImUvKG4HAG"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e839279e392178b56fd645109a018d52","path":"/cci-toolbox-usage-viewers/build/e839279e392178b56fd645109a018d52.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"lUHS5tePkz"}],"key":"LPyDfnQ6iC"}],"key":"VUmflZYNPr"}],"key":"jUD7VauhQ6"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Failure reporting in the ESA Climate Toolbox","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/advanced-functionality/ect-failure-reporting","group":"Source"},"next":{"title":"Finding Operations","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/using-operations/ect-finding-operations","group":"Source"}}},"domain":"http://localhost:3000"}