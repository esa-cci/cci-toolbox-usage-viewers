{"version":3,"kind":"Notebook","sha256":"03a6349fa0432db570e215e92674c15752b204a5a6f7c7eeaeb6a63e6cb07ae3","slug":"external-notebooks.esa-cci.esa-climate-toolbox.docs.source.notebooks.accessing-data.ect-reading-wms-data","location":"/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","dependencies":[],"frontmatter":{"title":"Access to WMS data","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/Accessing_Data/9-ECT_Reading_WMS_data.ipynb","exports":[{"format":"ipynb","filename":"9-ECT_Reading_WMS_data.ipynb","url":"/cci-toolbox-usage-viewers/build/9-ECT_Reading_WMS_da-48c6c4df827ec6bfef326023e2d90d71.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The CEDA data server at ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UCpvqRHkEv"},{"type":"link","url":"https://data.cci.ceda.ac.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​data​.cci​.ceda​.ac​.uk/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iBWimPiPda"}],"urlSource":"https://data.cci.ceda.ac.uk/","key":"HWEHWws4Bq"},{"type":"text","value":" provides access via the OGC Web Map Service (WMS) to CCI datasets. This notebook demonstrates how to retrieve CCI data via WMS from the CEDA server, using ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YcCwLFtS2s"},{"type":"link","url":"https://www.osgeo.org/projects/owslib/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"OWSLib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZWkdjUVy4r"}],"urlSource":"https://www.osgeo.org/projects/owslib/","key":"YsoMVoAjbP"},{"type":"text","value":" as the client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tQaYLx7UvD"}],"key":"OnStFxQVcm"}],"key":"T9KM09Av3x"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"If ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RiOQqU0uEV"},{"type":"inlineCode","value":"owslib","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bTiNlgJmRq"},{"type":"text","value":" is not already installed in the Python environment, uncomment the following cell to install it with mamba.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iTGeWJKtKN"}],"key":"Sb8AACNnMJ"}],"key":"OC1J6crQai"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ! mamba install --yes owslib","key":"KKKcon8pva"},{"type":"outputs","id":"J05sfVYZ2EghLEbMfXqqE","children":[],"key":"v0U0xTeod4"}],"key":"xTsJkxg9m5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import some required libraries, including OWSLib as the WMS client.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Zp8QKcheVz"}],"key":"nazULYwIJ6"}],"key":"yUNME56ctu"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"from owslib.wms import WebMapService\nfrom esa_climate_toolbox.core import list_ecvs, list_ecv_datasets\nfrom IPython.display import Image","key":"CnqWk1uj32"},{"type":"outputs","id":"NM-1xlLQvJV7pEy0l-oHI","children":[],"key":"YYgQ0hsD1I"}],"key":"rYk1HFWAHR"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available ECVs.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MH5QsDcKBa"}],"key":"qyrDj12r4k"}],"key":"dWpiDqnizp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list_ecvs()","key":"hDAKVkF65w"},{"type":"outputs","id":"RvmfooD2m08RdTeGnFYAd","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"['SEASURFACESALINITY',\n 'BIOMASS',\n 'CLOUD',\n 'AEROSOL',\n 'VEGETATION',\n 'LST',\n 'LC',\n 'FIRE',\n 'LAKES',\n 'PERMAFROST',\n 'SEALEVEL',\n 'OZONE',\n 'WATERVAPOUR',\n 'ICESHEETS',\n 'OC',\n 'SEASTATE',\n 'SOILMOISTURE',\n 'SEAICE',\n 'GHG',\n 'SNOW',\n 'RD',\n 'SST']","content_type":"text/plain"}}},"children":[],"key":"X0SeiU1yiU"}],"key":"cc5sOUgs1P"}],"key":"epDE8L3yI9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the available datasets for the cloud ECV.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fQOaD0Z05U"}],"key":"E1ll9BM5iv"}],"key":"nVsMOuzl3Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"print(\"\\n\".join(map(lambda x: x[0], list_ecv_datasets(\"CLOUD\"))))","key":"uCnK0gjxQs"},{"type":"outputs","id":"_yq-nPcMoiNHWARMzt1J0","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Aqua.MODIS_AQUA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.MODIS.Terra.MODIS_TERRA.2-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-AM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.AVHRR-PM.3-0.r1\nesacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.MERIS-AATSR.2-0.r1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MODIS_AQUA-200208-201412-fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-ATSR2_AATSR-199506-201204-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_AM-199109-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_PM-198201-201612-fv3.0-kr1.1\nESACCI-L3C_CLOUD-CLD_PRODUCTS-MERIS-AATSR_ENVISAT-200301-201112_fv2.0_kr1.0\nESACCI-L3C_CLOUD-CLD_PRODUCTS-AVHRR_NOAA-1982-2016-fv3.0.zarr\n"},"children":[],"key":"Yb2S5280Rf"}],"key":"DVTkHkmMMT"}],"key":"aG4XrctaEa"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select a dataset from the list and store its name in a variable for use in the following steps.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YvHytYatou"}],"key":"LnyEgIf68d"}],"key":"sH98zluaMD"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ds_id = \"esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1\"","key":"WDr6vSsn2B"},{"type":"outputs","id":"OVjh1Cde9gg6TQaI3luwJ","children":[],"key":"rNlx5e72nL"}],"key":"N4hYeXr2mb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a local representation of the WMS service for the selected dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q8AwcAIQfY"}],"key":"reW0FAfjY5"}],"key":"DTsWLsG0rR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms_url = f\"https://data.cci.ceda.ac.uk/thredds/wms/{ds_id}?service=WMS&version=1.3.0\"\nwms = WebMapService(wms_url, version=\"1.3.0\", timeout=600)","key":"FPB2EhTaF5"},{"type":"outputs","id":"H-Lr5sTzPjiR32BcZfEpG","children":[],"key":"wX81XERbNl"}],"key":"hG3mgzaCek"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List the data variables available from this service.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bFgG7lAlTw"}],"key":"xTA6tRKX4B"}],"key":"HgAmUba1Lw"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list(wms.contents)","key":"h1Bp27ARBV"},{"type":"outputs","id":"BndLL1pxNuuSdH0aAYPt3","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/plain":{"content":"['nday',\n 'nday_low',\n 'nday_mid',\n 'nday_hig',\n 'nobs',\n 'nobs_day',\n 'nobs_clear_day',\n 'nobs_cloudy_day',\n 'nobs_clear_night',\n 'nobs_cloudy_night',\n 'nobs_clear_twl',\n 'nobs_cloudy_twl',\n 'nobs_cloudy',\n 'nretr_clear',\n 'nretr_cloudy',\n 'toa_swup',\n 'toa_swdn',\n 'toa_swup_clr',\n 'toa_lwup',\n 'toa_lwup_clr',\n 'toa_swup_low',\n 'toa_swup_mid',\n 'toa_swup_hig',\n 'toa_lwup_low',\n 'toa_lwup_mid',\n 'toa_lwup_hig',\n 'boa_swup',\n 'boa_swup_clr',\n 'boa_lwup',\n 'boa_lwup_clr',\n 'boa_swdn',\n 'boa_swdn_clr',\n 'boa_lwdn',\n 'boa_lwdn_clr',\n 'cee',\n 'cee_corr_unc',\n 'cee_prop_unc',\n 'cee_std',\n 'cee_unc',\n 'cer',\n 'cer_corr_unc',\n 'cer_ice',\n 'cer_ice_corr_unc',\n 'cer_ice_prop_unc',\n 'cer_ice_std',\n 'cer_ice_unc',\n 'cer_liq',\n 'cer_liq_corr_unc',\n 'cer_liq_prop_unc',\n 'cer_liq_std',\n 'cer_liq_unc',\n 'cer_prop_unc',\n 'cer_std',\n 'cer_unc',\n 'cfc',\n 'cfc_corr_unc',\n 'cfc_day',\n 'cfc_high',\n 'cfc_low',\n 'cfc_mid',\n 'cfc_night',\n 'cfc_prop_unc',\n 'cfc_std',\n 'cfc_twl',\n 'cfc_unc',\n 'cla_vis006',\n 'cla_vis006_corr_unc',\n 'cla_vis006_ice',\n 'cla_vis006_ice_std',\n 'cla_vis006_ice_unc',\n 'cla_vis006_liq',\n 'cla_vis006_liq_std',\n 'cla_vis006_liq_unc',\n 'cla_vis006_prop_unc',\n 'cla_vis006_std',\n 'cla_vis006_unc',\n 'cla_vis008',\n 'cla_vis008_corr_unc',\n 'cla_vis008_ice',\n 'cla_vis008_ice_std',\n 'cla_vis008_ice_unc',\n 'cla_vis008_liq',\n 'cla_vis008_liq_std',\n 'cla_vis008_liq_unc',\n 'cla_vis008_prop_unc',\n 'cla_vis008_std',\n 'cla_vis008_unc',\n 'cot',\n 'cot_corr_unc',\n 'cot_ice',\n 'cot_ice_corr_unc',\n 'cot_ice_prop_unc',\n 'cot_ice_std',\n 'cot_ice_unc',\n 'cot_liq',\n 'cot_liq_corr_unc',\n 'cot_liq_prop_unc',\n 'cot_liq_std',\n 'cot_liq_unc',\n 'cot_log',\n 'cot_prop_unc',\n 'cot_std',\n 'cot_unc',\n 'cph',\n 'cph_corr_unc',\n 'cph_day',\n 'cph_day_corr_unc',\n 'cph_day_prop_unc',\n 'cph_day_std',\n 'cph_day_unc',\n 'cph_prop_unc',\n 'cph_std',\n 'cph_unc',\n 'cth',\n 'cth_corr_unc',\n 'cth_corrected',\n 'cth_corrected_corr_unc',\n 'cth_corrected_prop_unc',\n 'cth_corrected_std',\n 'cth_corrected_unc',\n 'cth_prop_unc',\n 'cth_std',\n 'cth_unc',\n 'ctp',\n 'ctp_corr_unc',\n 'ctp_corrected',\n 'ctp_corrected_corr_unc',\n 'ctp_corrected_prop_unc',\n 'ctp_corrected_std',\n 'ctp_corrected_unc',\n 'ctp_log',\n 'ctp_prop_unc',\n 'ctp_std',\n 'ctp_unc',\n 'ctt',\n 'ctt_corr_unc',\n 'ctt_corrected',\n 'ctt_corrected_corr_unc',\n 'ctt_corrected_prop_unc',\n 'ctt_corrected_std',\n 'ctt_corrected_unc',\n 'ctt_prop_unc',\n 'ctt_std',\n 'ctt_unc',\n 'iwp',\n 'iwp_allsky',\n 'iwp_corr_unc',\n 'iwp_prop_unc',\n 'iwp_std',\n 'iwp_unc',\n 'lwp',\n 'lwp_allsky',\n 'lwp_corr_unc',\n 'lwp_prop_unc',\n 'lwp_std',\n 'lwp_unc',\n 'nretr_cloudy_day',\n 'nretr_cloudy_day_ice',\n 'nretr_cloudy_day_liq',\n 'nretr_cloudy_high',\n 'nretr_cloudy_ice',\n 'nretr_cloudy_liq',\n 'nretr_cloudy_low',\n 'nretr_cloudy_mid',\n 'stemp_clear',\n 'stemp_clear_corr_unc',\n 'stemp_clear_prop_unc',\n 'stemp_clear_std',\n 'stemp_clear_unc',\n 'stemp_cloudy',\n 'stemp_cloudy_corr_unc',\n 'stemp_cloudy_prop_unc',\n 'stemp_cloudy_std',\n 'stemp_cloudy_unc']","content_type":"text/plain"}}},"children":[],"key":"EhiK4Af7Go"}],"key":"ASUyXWd4sQ"}],"key":"wBABMZij8k"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DlElKywJwE"},{"type":"inlineCode","value":"iwp","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yofAiM5oZ5"},{"type":"text","value":" (ice water path) variable from the list and store its name in a variable.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fIeJplZoEH"}],"key":"wFPvudXPrx"}],"key":"ECAkTmTd8I"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"data_id = \"iwp\"","key":"snYx6o6b9A"},{"type":"outputs","id":"HIylbDGMlho15dp6-ESxe","children":[],"key":"lklokMpFJM"}],"key":"xD4fwNPMM5"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check the bounding box for the selected dataset and variable; we can see that it is of global extent.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DJxRqmcgua"}],"key":"FtpP9UKGa6"}],"key":"NYyd27d1Ie"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"wms.contents[data_id].boundingBox","key":"tCC8RAZpSz"},{"type":"outputs","id":"3rvIR9psdJWA7vIeFp-yH","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"(-179.75, -89.75, 179.75, 89.75, 'CRS:84')","content_type":"text/plain"}}},"children":[],"key":"WqkUojFAfe"}],"key":"U4WsCMRJDN"}],"key":"SLyQj04SqA"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check what times are available, filtering to the year 2011.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VYFbcXB7aM"}],"key":"FdQjM06jqX"}],"key":"XFdBhUtjtc"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"[t for t in wms[data_id].timepositions if t.startswith(\"2011\")]","key":"AOvbV3wumE"},{"type":"outputs","id":"OKZ1kSQBzZ7tgqVjNlZnU","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"['2011-01-01T00:00:00.000Z',\n '2011-02-01T00:00:00.000Z',\n '2011-03-01T00:00:00.000Z',\n '2011-04-01T00:00:00.000Z',\n '2011-05-01T00:00:00.000Z',\n '2011-06-01T00:00:00.000Z',\n '2011-07-01T00:00:00.000Z',\n '2011-08-01T00:00:00.000Z',\n '2011-09-01T00:00:00.000Z',\n '2011-10-01T00:00:00.000Z',\n '2011-11-01T00:00:00.000Z',\n '2011-12-01T00:00:00.000Z']","content_type":"text/plain"}}},"children":[],"key":"x0pFxNqEdo"}],"key":"vHAR9tWkUS"}],"key":"SccbdAeMqn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Request a map for the chosen dataset and variable from the WMS server, selecting a time from the list above and a bounding box covering latitudes from 80°S to 50°N, then display the map in the notebook.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wvaGc1zQeY"}],"key":"EW3EI8YdWO"}],"key":"g0I99o7r84"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"response = wms.getmap(\n    layers=[\"iwp\"],\n    styles=[\"boxfill/rainbow\"],\n    size=[800, 600],\n    srs=\"EPSG:4326\",\n    bbox=[-180.0, -80.0, 180.0, 50.0],\n    format=\"image/png\",\n    time=\"2011-12-01T00:00:00.000Z\"\n)\n\nImage(response.read())","key":"c95CWcOpO8"},{"type":"outputs","id":"x8oGJ9dfrdK1HclqQNsod","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"79b665e5bca4448c8d46196f43e41822","path":"/cci-toolbox-usage-viewers/build/79b665e5bca4448c8d46196f43e41822.png"},"text/plain":{"content":"<IPython.core.display.Image object>","content_type":"text/plain"}}},"children":[],"key":"pkO4bX8WaO"}],"key":"uIeLHjZ9md"}],"key":"cyNXkaYiPg"}],"key":"obiL9BYPZ2"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Access to WCS data","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-reading-wcs-data","group":"Source"},"next":{"title":"Accessing Obs4MIPs and CMIP Data via ESGF","url":"/external-notebooks/esa-cci/esa-climate-toolbox/docs/source/notebooks/accessing-data/ect-access-esgf","group":"Source"}}},"domain":"http://localhost:3000"}