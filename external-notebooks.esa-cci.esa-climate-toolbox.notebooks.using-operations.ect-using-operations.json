{"version":3,"kind":"Notebook","sha256":"03edfbc172ea64b46aca3f14bb1aad281a4f792a9c29b74d7df97c64853825f8","slug":"external-notebooks.esa-cci.esa-climate-toolbox.notebooks.using-operations.ect-using-operations","location":"/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/2-ECT_Using_Operations.ipynb","dependencies":[],"frontmatter":{"title":"Usage of Operations","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/2-ECT_Using_Operations.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/esa-climate-toolbox/notebooks/Using_Operations/2-ECT_Using_Operations.ipynb","exports":[{"format":"ipynb","filename":"2-ECT_Using_Operations.ipynb","url":"/cci-toolbox-usage-viewers/build/2-ECT_Using_Operatio-f2cfb738e9fff1cd7efc9a3963cd82d3.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This notebook serves to show how operations provided by the toolbox can be applied.\nFor this purpose, the following aspects are covered:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HiGtJpzath"}],"key":"N89v8i1WTp"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Access to ESA CCI Ozone and Cloud data (Atmosphere Mole Content of Ozone and Cloud Cover)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"OQxKlOfAf5"}],"key":"knoEDPLBtl"}],"key":"khwmacjwl9"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Geometric adjustments (coregistration)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"aPUGo5rbXG"}],"key":"oZZ6ZZvIA2"}],"key":"dQnNPzl9fL"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Spatial (point, polygon) and temporal subsetting","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"BPMRbJDGli"}],"key":"aJrHbz7NBg"}],"key":"OTHl53Rwxf"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualisation of time series","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"iZzrznKklG"}],"key":"gaELgAGcxI"}],"key":"xdiHjnZ68n"}],"key":"n2fcbx4CB7"}],"key":"idXr4GqQ4s"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Ingest data and create datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xceTtnJlB7"}],"identifier":"ingest-data-and-create-datasets","label":"Ingest data and create datasets","html_id":"ingest-data-and-create-datasets","implicit":true,"key":"ngLXHNZ2iL"}],"key":"pOUTag9uH7"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from IPython.display import JSON\n\nfrom xcube.core.store import new_data_store\n\nimport esa_climate_toolbox.ops as ops\n\nfrom esa_climate_toolbox.core import get_op\nfrom esa_climate_toolbox.core import get_op_meta_info\nfrom esa_climate_toolbox.util.monitor import ConsoleMonitor","visibility":"show","key":"ZYRWw2FYWJ"},{"type":"outputs","id":"ykxlmcr6A2cBmwpie1Q1K","children":[],"visibility":"show","key":"U0Um3IEqzz"}],"visibility":"show","key":"jYJlhwMOsn"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"First, read in the ESA Climate Data Centre Data Store.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nu6HOHHARE"}],"key":"SFB54CvIxr"}],"key":"jA8fF7nKDK"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"data_store = new_data_store('esa-climate-data-centre')","visibility":"show","key":"dU5vxtfFIg"},{"type":"outputs","id":"niwJl1eAtWppNA_QOlZje","children":[],"visibility":"show","key":"Tm1hI8DGHM"}],"visibility":"show","key":"Nvwsjmlkjr"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open an ozone dataset (see Notebook 1-ECT_General_Data_Access to find which options you have).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sYUc9Ht2LL"}],"key":"aupPcDHsLw"}],"key":"XfJQzWlhWm"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ozone_ds = data_store.open_data('esacci.OZONE.mon.L3.NP.multi-sensor.multi-platform.MERGED.fv0002.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\nozone_ds","visibility":"show","key":"QGgbQg4ABZ"},{"type":"outputs","id":"7G-RYpnC9uH4Utu2Ddugk","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"7e56836534d5811c11fd0be980cc7afb","path":"/cci-toolbox-usage-viewers/build/7e56836534d5811c11fd0be980cc7afb.html"},"text/plain":{"content":"<xarray.Dataset> Size: 160MB\nDimensions:           (time: 6, layers: 16, lat: 180, lon: 360,\n                       air_pressure: 17, bnds: 2)\nCoordinates:\n  * air_pressure      (air_pressure) float32 68B 1.013e+03 446.0 ... 0.05 0.01\n  * lat               (lat) float32 720B -89.5 -88.5 -87.5 ... 87.5 88.5 89.5\n  * layers            (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon               (lon) float32 1kB -179.5 -178.5 -177.5 ... 178.5 179.5\n  * time              (time) datetime64[ns] 48B 2007-01-16T12:00:00 ... 2007-...\n    time_bnds         (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du             (time, layers, lat, lon) float32 25MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\n    O3_du_tot         (time, lat, lon) float32 2MB dask.array<chunksize=(1, 180, 360), meta=np.ndarray>\n    O3_ndens          (time, air_pressure, lat, lon) float32 26MB dask.array<chunksize=(1, 17, 180, 360), meta=np.ndarray>\n    O3_vmr            (time, air_pressure, lat, lon) float32 26MB dask.array<chunksize=(1, 17, 180, 360), meta=np.ndarray>\n    O3e_du            (time, layers, lat, lon) float32 25MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\n    O3e_du_tot        (time, lat, lon) float32 2MB dask.array<chunksize=(1, 180, 360), meta=np.ndarray>\n    O3e_ndens         (time, air_pressure, lat, lon) float32 26MB dask.array<chunksize=(1, 17, 180, 360), meta=np.ndarray>\n    O3e_vmr           (time, air_pressure, lat, lon) float32 26MB dask.array<chunksize=(1, 17, 180, 360), meta=np.ndarray>\n    surface_pressure  (time, lat, lon) float32 2MB dask.array<chunksize=(1, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-12-08T12:14:03.178050\n    processing_level:        L3\n    time_coverage_start:     2007-01-01T00:00:00\n    time_coverage_end:       2007-07-01T00:00:00\n    time_coverage_duration:  P181DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"bEOMn6eXUe"}],"visibility":"show","key":"espO2fFpOG"}],"visibility":"show","key":"o8FHg6CK9v"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open a cloud dataset next.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ymRtNcBvZ2"}],"key":"NmaGpK5woE"}],"key":"F05S7BgElB"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cloud_ds = data_store.open_data('esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.multi-platform.ATSR2-AATSR.3-0.r1',\n                               time_range=['2007-01-01', '2007-06-30'])\ncloud_ds","visibility":"show","key":"eYh5EVPrBi"},{"type":"outputs","id":"C4YdSkmuzesbDWv_ZYl_B","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"51d47368a462478123fedc1956a671cd","path":"/cci-toolbox-usage-viewers/build/51d47368a462478123fedc1956a671cd.html"},"text/plain":{"content":"<xarray.Dataset> Size: 9GB\nDimensions:                       (time: 6, lat: 360, lon: 720, hist_phase: 2,\n                                   hist1d_cer_bin_centre: 11,\n                                   hist1d_cer_bin_border: 12,\n                                   hist1d_cla_vis006_bin_centre: 13,\n                                   hist1d_cla_vis006_bin_border: 14,\n                                   hist1d_cla_vis008_bin_centre: 13,\n                                   ...\n                                   hist1d_cwp_bin_centre: 14,\n                                   hist1d_cwp_bin_border: 15,\n                                   hist2d_cot_bin_border: 14,\n                                   hist2d_cot_bin_centre: 13,\n                                   hist2d_ctp_bin_centre: 15,\n                                   hist2d_ctp_bin_border: 16, bnds: 2)\nCoordinates: (12/23)\n  * hist1d_cer_bin_border         (hist1d_cer_bin_border) float32 48B 0.0 ......\n  * hist1d_cer_bin_centre         (hist1d_cer_bin_centre) float32 44B 1.5 ......\n  * hist1d_cla_vis006_bin_border  (hist1d_cla_vis006_bin_border) float32 56B ...\n  * hist1d_cla_vis006_bin_centre  (hist1d_cla_vis006_bin_centre) float32 52B ...\n  * hist1d_cla_vis008_bin_border  (hist1d_cla_vis008_bin_border) float32 56B ...\n  * hist1d_cla_vis008_bin_centre  (hist1d_cla_vis008_bin_centre) float32 52B ...\n    ...                            ...\n  * hist2d_ctp_bin_centre         (hist2d_ctp_bin_centre) float32 60B 45.5 .....\n  * hist_phase                    (hist_phase) int8 2B 0 1\n  * lat                           (lat) float32 1kB -89.75 -89.25 ... 89.75\n  * lon                           (lon) float32 3kB -179.8 -179.2 ... 179.8\n  * time                          (time) datetime64[ns] 48B 2007-01-16T12:00:...\n    time_bnds                     (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables: (12/182)\n    boa_lwdn                      (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    boa_lwdn_clr                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    boa_lwup                      (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    boa_lwup_clr                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    boa_swdn                      (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    boa_swdn_clr                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    ...                            ...\n    toa_swdn                      (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    toa_swup                      (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    toa_swup_clr                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    toa_swup_hig                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    toa_swup_low                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\n    toa_swup_mid                  (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.m...\n    date_created:            2025-12-08T12:14:16.850587\n    processing_level:        L3C\n    time_coverage_start:     2007-01-01T00:00:00\n    time_coverage_end:       2007-07-01T00:00:00\n    time_coverage_duration:  P181DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"Ja9HlHQFcr"}],"visibility":"show","key":"K9JnIpwwKL"}],"visibility":"show","key":"BWh4PjqcZL"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Filter datasets to select the desired variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ukZZvprdmo"}],"identifier":"filter-datasets-to-select-the-desired-variables","label":"Filter datasets to select the desired variables","html_id":"filter-datasets-to-select-the-desired-variables","implicit":true,"key":"jaII3v7UxF"}],"key":"JEKkejEWoq"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The datasets are rather large, so we opt to make datasets that have only the variable we are interested in. The ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VoOQMDU60S"},{"type":"inlineCode","value":"select_var","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MIel5G3cX2"},{"type":"text","value":" op may be used for that.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XS48ZJ5N6z"}],"key":"KuZqqP8lJC"}],"key":"wDJS4XNW7N"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('select_var'))","visibility":"show","key":"hMfUXttG7L"},{"type":"outputs","id":"vJd_mulB24fWXJMxnpVFY","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"header\":{\"description\":\"Filter the dataset, by leaving only the desired variables in it.\\nThe original dataset information, including original coordinates,\\nis preserved.\",\"tags\":[\"filter\"],\"version\":\"1.0\"},\"inputs\":{\"ds\":{\"data_type\":\"esa_climate_toolbox.core.types.DatasetLike\",\"description\":\"The dataset or dataframe from which to perform selection.\",\"position\":0},\"var\":{\"data_type\":\"esa_climate_toolbox.core.types.VarNamesLike\",\"default_value\":null,\"description\":\"One or more variable names to select and preserve in the dataset. All of these are valid 'var_name' 'var_name1,var_name2,var_name3' ['var_name1', 'var_name2']. One can also use wildcards when doing the selection. E.g., choosing 'var_name*' for selection will select all variables that start with 'var_name'. This can be used to select variables along with their auxiliary variables, to select all uncertainty variables, and so on.\",\"nullable\":true,\"position\":1,\"value_set_source\":\"ds\"}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"A filtered dataset\"}},\"qualified_name\":\"esa_climate_toolbox.ops.select.select_var\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"woqejPvQ1t"}],"visibility":"show","key":"UTPD163I0U"}],"visibility":"show","key":"j0Kb5ONF29"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"svar_op = get_op('select_var')","visibility":"show","key":"jjnkuoDz5W"},{"type":"outputs","id":"-z-KodEg-QjEuw9qjMFq_","children":[],"visibility":"show","key":"KyNbEmfNux"}],"visibility":"show","key":"hmle12EBJF"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We choose the variable ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V36VkcjMGC"},{"type":"inlineCode","value":"cfc","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"b1SuthC7ek"},{"type":"text","value":" (cloud area fraction) from the cloud dataset ...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cZdAHa9EFP"}],"key":"INmIi12Ens"}],"key":"aqWD3CJkjt"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_ds = svar_op(ds=cloud_ds, var='cfc')\ncfc_ds","visibility":"show","key":"HfkneUpg28"},{"type":"outputs","id":"7dSFbf-nnuy-o0POXfX1w","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"e847ea19182fa513ee616f7906cd6c1e","path":"/cci-toolbox-usage-viewers/build/e847ea19182fa513ee616f7906cd6c1e.html"},"text/plain":{"content":"<xarray.Dataset> Size: 12MB\nDimensions:                       (time: 6, lat: 360, lon: 720,\n                                   hist1d_cer_bin_border: 12,\n                                   hist1d_cer_bin_centre: 11,\n                                   hist1d_cla_vis006_bin_border: 14,\n                                   hist1d_cla_vis006_bin_centre: 13,\n                                   hist1d_cla_vis008_bin_border: 14,\n                                   ...\n                                   hist1d_cwp_bin_centre: 14,\n                                   hist2d_cot_bin_border: 14,\n                                   hist2d_cot_bin_centre: 13,\n                                   hist2d_ctp_bin_border: 16,\n                                   hist2d_ctp_bin_centre: 15, hist_phase: 2,\n                                   bnds: 2)\nCoordinates: (12/23)\n  * hist1d_cer_bin_border         (hist1d_cer_bin_border) float32 48B 0.0 ......\n  * hist1d_cer_bin_centre         (hist1d_cer_bin_centre) float32 44B 1.5 ......\n  * hist1d_cla_vis006_bin_border  (hist1d_cla_vis006_bin_border) float32 56B ...\n  * hist1d_cla_vis006_bin_centre  (hist1d_cla_vis006_bin_centre) float32 52B ...\n  * hist1d_cla_vis008_bin_border  (hist1d_cla_vis008_bin_border) float32 56B ...\n  * hist1d_cla_vis008_bin_centre  (hist1d_cla_vis008_bin_centre) float32 52B ...\n    ...                            ...\n  * hist2d_ctp_bin_centre         (hist2d_ctp_bin_centre) float32 60B 45.5 .....\n  * hist_phase                    (hist_phase) int8 2B 0 1\n  * lat                           (lat) float32 1kB -89.75 -89.25 ... 89.75\n  * lon                           (lon) float32 3kB -179.8 -179.2 ... 179.8\n  * time                          (time) datetime64[ns] 48B 2007-01-16T12:00:...\n    time_bnds                     (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    cfc                           (time, lat, lon) float64 12MB dask.array<chunksize=(1, 360, 720), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-sensor.m...\n    date_created:            2025-12-08T12:14:16.850587\n    processing_level:        L3C\n    time_coverage_start:     2007-01-01T00:00:00\n    time_coverage_end:       2007-07-01T00:00:00\n    time_coverage_duration:  P181DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"hP4xDneGvH"}],"visibility":"show","key":"A9N1KfHUSP"}],"visibility":"show","key":"IZKN2MAYCD"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"... and ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KBHaB1ynYg"},{"type":"inlineCode","value":"O3_du_tot","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sJofrvnkUa"},{"type":"text","value":" (the atmosphere mole content of ozone) from the ozone dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sFDjjAEB9g"}],"key":"FBhUxaxoX2"}],"key":"yxPYobMDHT"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ozone_tot_ds = svar_op(ds=ozone_ds, var='O3_du_tot')\nozone_tot_ds","visibility":"show","key":"j82iU3fUUw"},{"type":"outputs","id":"l1R1TXE38SI8eV4RnDaGO","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"4e9021021e4fe98f7a8021c3fdd52b2b","path":"/cci-toolbox-usage-viewers/build/4e9021021e4fe98f7a8021c3fdd52b2b.html"},"text/plain":{"content":"<xarray.Dataset> Size: 2MB\nDimensions:       (time: 6, lat: 180, lon: 360, air_pressure: 17, layers: 16,\n                   bnds: 2)\nCoordinates:\n  * air_pressure  (air_pressure) float32 68B 1.013e+03 446.0 196.4 ... 0.05 0.01\n  * lat           (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers        (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon           (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n  * time          (time) datetime64[ns] 48B 2007-01-16T12:00:00 ... 2007-06-16\n    time_bnds     (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du_tot     (time, lat, lon) float32 2MB dask.array<chunksize=(1, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-12-08T12:14:03.178050\n    processing_level:        L3\n    time_coverage_start:     2007-01-01T00:00:00\n    time_coverage_end:       2007-07-01T00:00:00\n    time_coverage_duration:  P181DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"yU1Rxf8yoJ"}],"visibility":"show","key":"UTnl2J0FPh"}],"visibility":"show","key":"Zqa2isxacm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the first time slices of the datasets","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lMw9pOiIty"}],"key":"tcXe9jnlqh"}],"key":"pF23ANSNOW"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"%matplotlib inline\n\ncfc_ds.cfc.isel(time=0).plot()","visibility":"show","key":"CuiWuIWfxD"},{"type":"outputs","id":"YFAFNiruypueyFY9IuYlk","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"98a42393f9ae8c14d1747c7cd276fdc2","path":"/cci-toolbox-usage-viewers/build/98a42393f9ae8c14d1747c7cd276fdc2.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"PpWQCTc6nZ"}],"visibility":"show","key":"n6ctXBsjjA"}],"visibility":"show","key":"QR8OJU7woF"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ozone_tot_ds.O3_du_tot.isel(time=0).plot()","visibility":"show","key":"I2E7Sr3Q2T"},{"type":"outputs","id":"vkHRzS9IWtlf9VWwJpXtT","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a5333e6efb2f7e69c57a3fd42525cb61","path":"/cci-toolbox-usage-viewers/build/a5333e6efb2f7e69c57a3fd42525cb61.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"WDP6mES3MO"}],"visibility":"show","key":"AHMXJxepP3"}],"visibility":"show","key":"SYjdxtNiNX"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Co-register datasets by resampling","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iv7MH8sb0T"}],"identifier":"co-register-datasets-by-resampling","label":"Co-register datasets by resampling","html_id":"co-register-datasets-by-resampling","implicit":true,"key":"BfG87TIaIS"}],"key":"jaTI7UH9n4"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We see that though both datasets are global, they are in different spatial resolutions:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xnCLdMdMIS"}],"key":"zPdNJINR0t"}],"key":"e3CBHNtDev"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(cfc_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)","visibility":"show","key":"ECRq0CjUhp"},{"type":"outputs","id":"UV2zPSYPq05c7K2IaM6PZ","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"(6, 360, 720)\n(6, 180, 360)\n"},"children":[],"key":"bZLq6dpiIv"}],"visibility":"show","key":"GCXU08Mpdo"}],"visibility":"show","key":"gCC1N9AFmK"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To bring them to the same resolution, we use the ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ngL4P6jch7"},{"type":"inlineCode","value":"coregister","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kKjJxgGdLA"},{"type":"text","value":" function.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZchcGbXQGq"}],"key":"vsJqflvJq5"}],"key":"mBbLGEs11y"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('coregister'))","visibility":"show","key":"yoFZsivWlm"},{"type":"outputs","id":"nCnjHuX_oUjPu5IW9Q1TU","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"has_monitor\":true,\"header\":{\"description\":\"Perform coregistration of two datasets by resampling the replica dataset\\nonto the grid of the primary. If upsampling has to be performed, this is\\nachieved using interpolation, if downsampling has to be performed, the\\npixels of the replica dataset are aggregated to form a coarser grid.\\n\\nThe returned dataset will contain the lat/lon intersection of provided\\nprimary and replica datasets, resampled unto the primary grid frequency.\\n\\nThis operation works on datasets whose spatial dimensions are defined on\\npixel-registered grids that are equidistant in lat/lon coordinates, i.e.,\\ndata points define the middle of a pixel and pixels have the same size\\nacross the dataset.\\n\\nThis operation will resample all variables in a dataset, as the lat/lon\\ngrid is defined per dataset. It works only if all variables in the dataset\\nhave lat and lon as dimensions.\\n\\nFor an overview of downsampling/upsampling methods used in this operation,\\nplease see https://github.com/CAB-LAB/gridtools\\n\\nWhether upsampling or downsampling has to be performed is determined\\nautomatically based on the relationship of the grids of the provided\\ndatasets.\",\"tags\":[\"geometric\",\"coregistration\"],\"version\":\"1.1\"},\"inputs\":{\"ds_primary\":{\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"The dataset whose grid is used for resampling\",\"position\":0},\"ds_replica\":{\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"The dataset that will be resampled\",\"position\":1},\"method_ds\":{\"data_type\":\"str\",\"default_value\":\"mean\",\"description\":\"Interpolation method to use for downsampling.\",\"position\":3,\"value_set\":[\"first\",\"last\",\"mean\",\"mode\",\"var\",\"std\"]},\"method_us\":{\"data_type\":\"str\",\"default_value\":\"linear\",\"description\":\"Interpolation method to use for upsampling.\",\"position\":2,\"value_set\":[\"nearest\",\"linear\"]}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"The replica dataset resampled on the grid of the primary\"}},\"qualified_name\":\"esa_climate_toolbox.ops.coregistration.coregister\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"WdZOsFHYpT"}],"visibility":"show","key":"q7ex4rErBW"}],"visibility":"show","key":"FsAIectAMS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"coregister_op = get_op('coregister')","visibility":"show","key":"yWzlfyyS9C"},{"type":"outputs","id":"-mH2dUZ0TsDz7V7qTNTQl","children":[],"visibility":"show","key":"Ic9PLypQie"}],"visibility":"show","key":"Thljrhk40n"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We get the cloud dataset to the resolution of the ozone dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hOO1KtTqn9"}],"key":"GICtPkXb5h"}],"key":"CVzr5XVTeS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_res_ds = coregister_op(ozone_tot_ds, cfc_ds)","visibility":"show","key":"ks3x2yjH0Z"},{"type":"outputs","id":"5XTdZFEgy3BPu0amfrPxs","children":[],"visibility":"show","key":"N0E6GZ6HxF"}],"visibility":"show","key":"mcnF9mWv4p"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check the variable shapes again to see we were successful:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HYyU4ztF23"}],"key":"jzGJAtgL3q"}],"key":"gOP6URBdHs"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(cfc_res_ds['cfc'].shape)\nprint(ozone_tot_ds['O3_du_tot'].shape)","visibility":"show","key":"bBlewDVVip"},{"type":"outputs","id":"gi2fMVQEnar_TfdoN1mCW","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"(6, 180, 360)\n(6, 180, 360)\n"},"children":[],"key":"J2J3zU4rFn"}],"visibility":"show","key":"q9DeccltNz"}],"visibility":"show","key":"kv0x3V9Anb"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"And plot again:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T3i9oS4aCq"}],"key":"GCr2f57sJN"}],"key":"ZaELD8VQpw"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_res_ds.cfc.isel(time=0).plot()","visibility":"show","key":"PuXFLWTbCI"},{"type":"outputs","id":"V8RbTKixUWzaMMz_l0FPr","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"a5d0e62337b2765d0ec8101fe3223534","path":"/cci-toolbox-usage-viewers/build/a5d0e62337b2765d0ec8101fe3223534.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"mf0It5WDdB"}],"visibility":"show","key":"azvTaQoL1t"}],"visibility":"show","key":"ccClAUFL6Y"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\nfig, axes = plt.subplots(1, 2, figsize=(10, 4))\ncfc_res_ds.cfc.isel(time=0).plot(ax=axes[0])\naxes[0].set_title(\"Cloud Fraction\")\nozone_tot_ds.O3_du_tot.isel(time=0).plot(ax=axes[1])\naxes[1].set_title(\"Ozone Content\")\nplt.tight_layout()\nplt.show()","key":"aRWAJBUxqR"},{"type":"outputs","id":"dPy_gIwVwaMcN8kgaLeqZ","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3771b97c37afbfca02aee771e9d65f49","path":"/cci-toolbox-usage-viewers/build/3771b97c37afbfca02aee771e9d65f49.png"},"text/plain":{"content":"<Figure size 1000x400 with 4 Axes>","content_type":"text/plain"}}},"children":[],"key":"BgV85I4hPn"}],"key":"PPnoDXTiv5"}],"key":"VoqyC2xEY1"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Select the desired spatial region","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LShIGJDnrG"}],"identifier":"select-the-desired-spatial-region","label":"Select the desired spatial region","html_id":"select-the-desired-spatial-region","implicit":true,"key":"XM1hOIQOpH"}],"key":"I5Rr5Rur9E"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We want to continue our analysis with a subset, say, Africa. For this we use ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rEgmuPlIUq"},{"type":"inlineCode","value":"subset_spatial","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jr2MgfKqWR"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"omfex3v330"}],"key":"lFKtcPXVn6"}],"key":"maGwXdHsP0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('subset_spatial'))","visibility":"show","key":"POKPmdFWkg"},{"type":"outputs","id":"nszRYvd0wNXaeFrsrYSDf","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":18,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"has_monitor\":true,\"header\":{\"description\":\"Do a spatial subset of the dataset\",\"tags\":[\"geometric\",\"spatial\",\"subset\"],\"version\":\"1.0\"},\"inputs\":{\"ds\":{\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"Dataset to subset\",\"position\":0},\"mask\":{\"data_type\":\"bool\",\"default_value\":true,\"description\":\"Should values falling in the bounding box of the polygon but not the polygon itself be masked with NaN.\",\"position\":2},\"region\":{\"data_type\":\"esa_climate_toolbox.core.types.PolygonLike\",\"description\":\"Spatial region to subset\",\"position\":1}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"Subset dataset\"}},\"qualified_name\":\"esa_climate_toolbox.ops.subset.subset_spatial\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"vzmZrT78ZO"}],"visibility":"show","key":"EXeUjo2cMG"}],"visibility":"show","key":"LTJzZicHJO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"subset_spatial_op = get_op('subset_spatial')","visibility":"show","key":"swUN1Yxmrc"},{"type":"outputs","id":"eVSfOVpBzo6jBvbji8Hbd","children":[],"visibility":"show","key":"CgrcBPSSYs"}],"visibility":"show","key":"h2sV43XJCJ"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"africa = '-20.0, -40.0, 60.0, 40.0'\n# 'lon_min, lat_min, lon_max, lat_max'\ncfc_africa_res_ds = subset_spatial_op(cfc_res_ds, africa)\nozone_tot_africa_ds = subset_spatial_op(ozone_tot_ds, africa)","visibility":"show","key":"rbCcamfOWH"},{"type":"outputs","id":"_6IoD_8jInMbMKng1pRJW","children":[],"visibility":"show","key":"Hqgr8AbEV5"}],"visibility":"show","key":"JlZScLL9CO"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is a good time to compare the plots of the resampled subset and the original plot to see the effects of our work:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Q2zQ1i56Vf"}],"key":"RQO08feKAD"}],"key":"vwPKoW3yWa"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_africa_res_ds.cfc.isel(time=0).plot()","visibility":"show","key":"Gdf4OJg0fL"},{"type":"outputs","id":"Sx3bqQI2NvE97qqEiD4W6","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3a10a56e315205de3bc1513b537fa728","path":"/cci-toolbox-usage-viewers/build/3a10a56e315205de3bc1513b537fa728.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"fa1oCE2Gnl"}],"visibility":"show","key":"MnM379kXFb"}],"visibility":"show","key":"j9Vu6el1vS"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_ds.cfc.isel(time=0).sel({'lat': slice(-40, 40), 'lon': slice(-20, 60)}).plot()","visibility":"show","key":"UPbity68AY"},{"type":"outputs","id":"Tv7kObyahzXyIgRPac9gH","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"804669f089f017169c6aef5d01f0663c","path":"/cci-toolbox-usage-viewers/build/804669f089f017169c6aef5d01f0663c.png"},"text/plain":{"content":"<Figure size 640x480 with 2 Axes>","content_type":"text/plain"}}},"children":[],"key":"kVXgFUlaWo"}],"visibility":"show","key":"yk3SmnKnMs"}],"visibility":"show","key":"yMDKUqUNyM"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Select the desired temporal region","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o7K8ibQMpI"}],"identifier":"select-the-desired-temporal-region","label":"Select the desired temporal region","html_id":"select-the-desired-temporal-region","implicit":true,"key":"TnuTzMaYYU"}],"key":"bmWqlAij53"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We may also create a temporal subset:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Bd5SqRwpp3"}],"key":"DT37nhEJ1P"}],"key":"UjYSaIS5Cf"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('subset_temporal'))","visibility":"show","key":"bZzInhrAVf"},{"type":"outputs","id":"gFSb4fCMxwtcVci_zU9Um","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":23,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"header\":{\"description\":\"Do a temporal subset of the dataset.\",\"tags\":[\"subset\",\"temporal\",\"filter\"],\"version\":\"1.0\"},\"inputs\":{\"ds\":{\"data_type\":\"esa_climate_toolbox.core.types.DatasetLike\",\"description\":\"Dataset or dataframe to subset\",\"position\":0},\"time_range\":{\"data_type\":\"esa_climate_toolbox.core.types.TimeRangeLike\",\"description\":\"Time range to select\",\"position\":1}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"Subset dataset\"}},\"qualified_name\":\"esa_climate_toolbox.ops.subset.subset_temporal\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"xqqyavwPiX"}],"visibility":"show","key":"KuterGFhC9"}],"visibility":"show","key":"OeYrnwCMCE"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"subset_temporal_op = get_op('subset_temporal')","visibility":"show","key":"QcV0xw3eBO"},{"type":"outputs","id":"E2QCdG8144kggKrOtCYzK","children":[],"visibility":"show","key":"Nqi2LS0ikG"}],"visibility":"show","key":"YqTR2dIKdO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_africa_res_janmar_ds = subset_temporal_op(cfc_africa_res_ds, '2007-01-01, 2007-03-31')\nozone_tot_africa_janmar_ds = subset_temporal_op(ozone_tot_africa_ds, '2007-01-01, 2007-12-31')","visibility":"show","key":"zubZiXwkXo"},{"type":"outputs","id":"FUR8_eXBcsrAdPDWE8OUx","children":[],"visibility":"show","key":"lqOCiia2RG"}],"visibility":"show","key":"FQZcAyTDIk"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(cfc_africa_res_janmar_ds.time)","visibility":"show","key":"gkVOYj2BUI"},{"type":"outputs","id":"a0p6wa9WA02wl9hKkb41p","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"<xarray.DataArray 'time' (time: 3)> Size: 24B\narray(['2007-01-16T12:00:00.000000000', '2007-02-15T00:00:00.000000000',\n       '2007-03-16T12:00:00.000000000'], dtype='datetime64[ns]')\nCoordinates:\n  * time     (time) datetime64[ns] 24B 2007-01-16T12:00:00 ... 2007-03-16T12:...\nAttributes:\n    standard_name:  time\n    bounds:         time_bnds\n"},"children":[],"key":"J4ISri1vrq"}],"visibility":"show","key":"J8WkXbTdpz"}],"visibility":"show","key":"kUfX7uh75M"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(ozone_tot_africa_janmar_ds.time)","visibility":"show","key":"Ez1xYyIX9g"},{"type":"outputs","id":"kYhVcZuLoLUKVaZ-5MSxp","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"<xarray.DataArray 'time' (time: 6)> Size: 48B\narray(['2007-01-16T12:00:00.000000000', '2007-02-15T00:00:00.000000000',\n       '2007-03-16T12:00:00.000000000', '2007-04-16T00:00:00.000000000',\n       '2007-05-16T12:00:00.000000000', '2007-06-16T00:00:00.000000000'],\n      dtype='datetime64[ns]')\nCoordinates:\n  * time     (time) datetime64[ns] 48B 2007-01-16T12:00:00 ... 2007-06-16\nAttributes:\n    standard_name:  time\n    bounds:         time_bnds\n"},"children":[],"key":"Rcb1n8UQS8"}],"visibility":"show","key":"rD4HYeDrzN"}],"visibility":"show","key":"VT3cMa50kA"},{"type":"block","kind":"notebook-content","children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Retrieve and plot timeseries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"L3MIQMulur"}],"identifier":"retrieve-and-plot-timeseries","label":"Retrieve and plot timeseries","html_id":"retrieve-and-plot-timeseries","implicit":true,"key":"mnV3bU5BVK"}],"key":"HyRwqZzoCL"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Finally, we can create time series from these datasets. Operation ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XIdvlaLCHZ"},{"type":"inlineCode","value":"tseries_point","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n67wmmMRMn"},{"type":"text","value":" can be used to get a time series for a given point, ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iYUmkvbIHH"},{"type":"inlineCode","value":"tseries_mean","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"m6fdImfYO8"},{"type":"text","value":" will get the mean and standard deviation across the dataset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p40ukaHW3z"}],"key":"H7kwCUY49Q"}],"key":"qBrCYzzAaH"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('tseries_point'))","visibility":"show","key":"IJ5UHAcHla"},{"type":"outputs","id":"l80a4SAF1vQ6dcHm1IV8Q","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":28,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"header\":{\"description\":\"Extract time-series from *ds* at given *lon*, *lat* position using\\ninterpolation *method* for each *var* given in a comma separated list of\\nvariables.\\n\\nThe operation returns a new timeseries dataset, that contains the point\\ntimeseries for all required variables with original variable\\nmeta-information preserved.\\n\\nIf a variable has more than three dimensions, the resulting timeseries\\nvariable will preserve all other dimensions except for lon/lat.\",\"tags\":[\"timeseries\",\"temporal\",\"filter\",\"point\"],\"version\":\"1.0\"},\"inputs\":{\"ds\":{\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"The dataset from which to perform timeseries extraction.\",\"position\":0},\"method\":{\"data_type\":\"str\",\"default_value\":\"nearest\",\"description\":\"Interpolation method to use.\",\"position\":3,\"value_set\":[\"nearest\",\"ffill\",\"bfill\"]},\"point\":{\"data_type\":\"esa_climate_toolbox.core.types.PointLike\",\"description\":\"Point to extract, e.g. (lon,lat)\",\"position\":1},\"var\":{\"data_type\":\"esa_climate_toolbox.core.types.VarNamesLike\",\"default_value\":null,\"description\":\"Variable(s) for which to perform the timeseries selection if none is given, all variables in the dataset will be used.\",\"nullable\":true,\"position\":2,\"value_set_source\":\"ds\"}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"A timeseries dataset\"}},\"qualified_name\":\"esa_climate_toolbox.ops.timeseries.tseries_point\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"okfmxTUKfJ"}],"visibility":"show","key":"WrsK9mhw4B"}],"visibility":"show","key":"Zh5YeLlx4o"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"JSON(get_op_meta_info('tseries_mean'))","visibility":"show","key":"GVduV1OcAr"},{"type":"outputs","id":"4C8pzPx38DNVBgiNr8cQt","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":29,"metadata":{"application/json":{"expanded":false,"root":"root"}},"data":{"application/json":{"content":"{\"has_monitor\":true,\"header\":{\"description\":\"Extract spatial mean timeseries of the provided variables, return the\\ndataset that in addition to all the information in the given dataset\\ncontains also timeseries data for the provided variables, following\\nnaming convention 'var_name1_ts_mean'. In addition, the standard deviation\\nis computed.\\n\\nIf a data variable with more dimensions than time/lat/lon is provided,\\nthe data will be reduced by taking the mean of all data values at a single\\ntime position resulting in one dimensional timeseries data variable.\",\"tags\":[\"timeseries\",\"temporal\"],\"version\":\"1.1\"},\"inputs\":{\"apply_spatial_weighting\":{\"data_type\":\"bool\",\"default_value\":true,\"description\":\"Whether to apply spatial weighting to cancel the effects of grid cells closer to the equator cover more area than grid cells closer to the poles. Only applicable for datasets with a latitude column named 'lat'. Default is True.\",\"position\":2},\"ds\":{\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"The dataset from which to perform timeseries extraction.\",\"position\":0},\"mean_suffix\":{\"data_type\":\"str\",\"default_value\":\"_mean\",\"description\":\"Mean suffix to use for resulting datasets\",\"position\":3},\"std_suffix\":{\"data_type\":\"str\",\"default_value\":\"_std\",\"description\":\"Std suffix to use for resulting datasets\",\"position\":4},\"var\":{\"data_type\":\"esa_climate_toolbox.core.types.VarNamesLike\",\"default_value\":null,\"description\":\"Variables for which to perform timeseries extraction\",\"nullable\":true,\"position\":1,\"value_set_source\":\"ds\"}},\"outputs\":{\"return\":{\"add_history\":true,\"data_type\":\"xarray.core.dataset.Dataset\",\"description\":\"Dataset with timeseries variables\"}},\"qualified_name\":\"esa_climate_toolbox.ops.timeseries.tseries_mean\"}","content_type":"application/json"},"text/plain":{"content":"<IPython.core.display.JSON object>","content_type":"text/plain"}}},"children":[],"key":"FUxNHVYsOO"}],"visibility":"show","key":"emFLTeu99T"}],"visibility":"show","key":"dhEg0bXGGO"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"tseries_point_op = get_op('tseries_point')\ntseries_mean_op = get_op('tseries_mean')","visibility":"show","key":"qeuSFO74w4"},{"type":"outputs","id":"3EVZgQDZCnYbcETyDNUB7","children":[],"visibility":"show","key":"brgQIfNetQ"}],"visibility":"show","key":"bPEJN7ZJvY"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ozone_ts_point = tseries_point_op(ozone_tot_africa_janmar_ds, point='50, 50')\ncfc_ts_point = tseries_point_op(cfc_africa_res_janmar_ds, point='50, 50')\nozone_ts_mean = tseries_mean_op(ozone_tot_africa_janmar_ds, var='O3_du_tot')\ncfc_ts_mean = tseries_mean_op(cfc_africa_res_janmar_ds, var='cfc')","visibility":"show","key":"D57wURl13i"},{"type":"outputs","id":"p0IJTSX_GeNcmgNvN0ors","children":[],"visibility":"show","key":"mpRT5CMnqg"}],"visibility":"show","key":"gB3IlWGSc0"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(ozone_ts_mean)","visibility":"show","key":"Kg8tN7WYMq"},{"type":"outputs","id":"_SUFUX1fcIXoZC_Ip_yvX","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"<xarray.Dataset> Size: 980B\nDimensions:         (air_pressure: 17, lat: 82, layers: 16, lon: 82, time: 6,\n                     bnds: 2)\nCoordinates:\n  * air_pressure    (air_pressure) float32 68B 1.013e+03 446.0 ... 0.05 0.01\n  * lat             (lat) float32 328B -40.5 -39.5 -38.5 ... 38.5 39.5 40.5\n  * layers          (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon             (lon) float32 328B -20.5 -19.5 -18.5 ... 58.5 59.5 60.5\n  * time            (time) datetime64[ns] 48B 2007-01-16T12:00:00 ... 2007-06-16\n    time_bnds       (time, bnds) datetime64[ns] 96B dask.array<chunksize=(6, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du_tot_mean  (time) float32 24B dask.array<chunksize=(1,), meta=np.ndarray>\n    O3_du_tot_std   (time) float32 24B dask.array<chunksize=(1,), meta=np.ndarray>\nAttributes: (12/19)\n    Conventions:                CF-1.7\n    title:                      esacci.OZONE.mon.L3.NP.multi-sensor.multi-pla...\n    date_created:               2025-12-08T12:14:03.178050\n    processing_level:           L3\n    time_coverage_start:        2007-01-01T00:00:00\n    time_coverage_end:          2007-07-01T00:00:00\n    ...                         ...\n    geospatial_lat_min:         -41.0\n    geospatial_lat_max:         41.0\n    geospatial_lat_units:       degree_north\n    geospatial_bounds_crs:      CRS84\n    geospatial_bounds:          POLYGON((-21.0 -41.0, -21.0 41.0, 61.0 41.0, ...\n    time_coverage_resolution:   P1M\n"},"children":[],"key":"tmI5usfL3F"}],"visibility":"show","key":"SSN3rkjlBp"}],"visibility":"show","key":"TALA4sdb8k"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(cfc_ts_mean)","visibility":"show","key":"n4Gvd6ScQM"},{"type":"outputs","id":"8iVZu3Kw-S_jgxbx5aCWj","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"<xarray.Dataset> Size: 728B\nDimensions:   (lat: 82, lon: 82, time: 3)\nCoordinates:\n  * lat       (lat) float32 328B -40.5 -39.5 -38.5 -37.5 ... 37.5 38.5 39.5 40.5\n  * lon       (lon) float32 328B -20.5 -19.5 -18.5 -17.5 ... 57.5 58.5 59.5 60.5\n  * time      (time) datetime64[ns] 24B 2007-01-16T12:00:00 ... 2007-03-16T12...\nData variables:\n    cfc_mean  (time) float64 24B dask.array<chunksize=(1,), meta=np.ndarray>\n    cfc_std   (time) float64 24B dask.array<chunksize=(1,), meta=np.ndarray>\nAttributes: (12/19)\n    Conventions:                CF-1.7\n    title:                      esacci.CLOUD.mon.L3C.CLD_PRODUCTS.multi-senso...\n    date_created:               2025-12-08T12:14:16.850587\n    processing_level:           L3C\n    time_coverage_start:        2007-01-16T12:00:00\n    time_coverage_end:          2007-03-16T12:00:00\n    ...                         ...\n    geospatial_lat_min:         -41.0\n    geospatial_lat_max:         41.0\n    geospatial_lat_units:       degree_north\n    geospatial_bounds_crs:      CRS84\n    geospatial_bounds:          POLYGON((-21.0 -41.0, -21.0 41.0, 61.0 41.0, ...\n    time_coverage_resolution:   P1M\n"},"children":[],"key":"zsa9Nuj9MP"}],"visibility":"show","key":"txVXZ7ZGrG"}],"visibility":"show","key":"tRBhyyBraG"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"cfc_ts_mean.cfc_mean.plot()","visibility":"show","key":"Npa2mkU3ef"},{"type":"outputs","id":"AQ4vSDqCRCoXZbBsn6lw8","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e7915771bc7e5fbc907c92f1ecca8219","path":"/cci-toolbox-usage-viewers/build/e7915771bc7e5fbc907c92f1ecca8219.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"T8490YD8GT"}],"visibility":"show","key":"dEXsBRTOfV"}],"visibility":"show","key":"Cgel2DKok5"},{"type":"block","kind":"notebook-code","data":{"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ozone_ts_mean.O3_du_tot_mean.plot()","visibility":"show","key":"UQIsaVc5PS"},{"type":"outputs","id":"5hPoz9mXzdDPLEiNYvjPM","children":[{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b538f76aa4c2d486c3cca12af9655a31","path":"/cci-toolbox-usage-viewers/build/b538f76aa4c2d486c3cca12af9655a31.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}},"children":[],"key":"aB0ZS5qcJC"}],"visibility":"show","key":"y0fcdUhxS0"}],"visibility":"show","key":"SEMFSCD6rr"}],"key":"u2dtR7dAQ1"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Finding Operations","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-finding-operations","group":"Using Operations"},"next":{"title":"ESA CCI Toolbox Reproject Dataset","url":"/external-notebooks/esa-cci/esa-climate-toolbox/notebooks/using-operations/ect-reprojecting-data","group":"Using Operations"}}},"domain":"http://localhost:3000"}